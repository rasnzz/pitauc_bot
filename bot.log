2025-12-15 21:34:55,646 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:34:55,646 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 21:34:55,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:34:55,648 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-12-15 21:34:55,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:34:55,649 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 21:34:55,649 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:34:55,650 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-15 21:34:55,650 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:34:55,651 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 21:34:55,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:34:55,652 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-15 21:34:55,652 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:34:55,653 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 21:34:55,653 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:34:55,654 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-15 21:34:55,654 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:34:55,655 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 21:34:55,655 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:34:55,656 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-15 21:34:55,657 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:34:55,658 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	username VARCHAR(100), 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	phone VARCHAR(20), 
	is_confirmed BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id)
)


2025-12-15 21:34:55,660 - sqlalchemy.engine.Engine - INFO - [no key 0.00160s] ()
2025-12-15 21:34:55,666 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_telegram_id ON users (telegram_id)
2025-12-15 21:34:55,666 - sqlalchemy.engine.Engine - INFO - [no key 0.00053s] ()
2025-12-15 21:34:55,672 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_telegram_id ON users (telegram_id)
2025-12-15 21:34:55,672 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-12-15 21:34:55,673 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:35:53,643 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:35:53,643 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 21:35:53,644 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:35:53,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 21:35:53,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:35:53,646 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-15 21:35:53,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:35:53,647 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 21:35:53,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:35:53,648 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-15 21:35:53,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:35:53,649 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 21:35:53,649 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:35:53,650 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-15 21:35:53,651 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:35:53,651 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 21:35:53,652 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:35:53,652 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-15 21:35:53,653 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:35:53,655 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auctions (
	id INTEGER NOT NULL, 
	title VARCHAR(255) NOT NULL, 
	description TEXT, 
	photos TEXT, 
	start_price FLOAT NOT NULL, 
	step_price FLOAT NOT NULL, 
	current_price FLOAT NOT NULL, 
	status VARCHAR(20), 
	winner_id INTEGER, 
	channel_message_id INTEGER, 
	last_bid_time DATETIME, 
	created_at DATETIME, 
	ends_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(winner_id) REFERENCES users (id)
)


2025-12-15 21:35:53,657 - sqlalchemy.engine.Engine - INFO - [no key 0.00205s] ()
2025-12-15 21:35:53,662 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_status ON auctions (status)
2025-12-15 21:35:53,667 - sqlalchemy.engine.Engine - INFO - [no key 0.00519s] ()
2025-12-15 21:35:53,675 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_title ON auctions (title)
2025-12-15 21:35:53,675 - sqlalchemy.engine.Engine - INFO - [no key 0.00068s] ()
2025-12-15 21:35:53,684 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_ends_at ON auctions (ends_at)
2025-12-15 21:35:53,686 - sqlalchemy.engine.Engine - INFO - [no key 0.00181s] ()
2025-12-15 21:35:53,694 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_status ON auctions (status)
2025-12-15 21:35:53,695 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-12-15 21:35:53,695 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:38:41,797 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:38:41,797 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 21:38:41,798 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:38:41,799 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-12-15 21:38:41,799 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:38:41,800 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 21:38:41,800 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:38:41,801 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-15 21:38:41,801 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:38:41,802 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 21:38:41,802 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:38:41,803 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-15 21:38:41,803 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:38:41,804 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 21:38:41,804 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:38:41,805 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-15 21:38:41,805 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:38:41,806 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 21:38:41,806 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:38:41,807 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-15 21:38:41,807 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:38:41,808 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	username VARCHAR(100), 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	phone VARCHAR(20), 
	is_confirmed BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id)
)


2025-12-15 21:38:41,809 - sqlalchemy.engine.Engine - INFO - [no key 0.00092s] ()
2025-12-15 21:38:41,817 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_is_confirmed ON users (is_confirmed)
2025-12-15 21:38:41,818 - sqlalchemy.engine.Engine - INFO - [no key 0.00046s] ()
2025-12-15 21:38:41,822 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_telegram_id ON users (telegram_id)
2025-12-15 21:38:41,822 - sqlalchemy.engine.Engine - INFO - [no key 0.00055s] ()
2025-12-15 21:38:41,828 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_users_telegram_id ON users (telegram_id)
2025-12-15 21:38:41,828 - sqlalchemy.engine.Engine - INFO - [no key 0.00046s] ()
2025-12-15 21:38:41,829 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:40:56,817 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:40:56,818 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 21:40:56,818 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:40:56,819 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-12-15 21:40:56,819 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:40:56,820 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 21:40:56,820 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:40:56,821 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-15 21:40:56,821 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:40:56,822 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 21:40:56,822 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:40:56,823 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-15 21:40:56,823 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:40:56,824 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 21:40:56,824 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:40:56,826 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-15 21:40:56,826 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:40:56,827 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 21:40:56,827 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:40:56,828 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-15 21:40:56,828 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:40:56,829 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	username VARCHAR(100), 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	phone VARCHAR(20), 
	is_confirmed BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id)
)


2025-12-15 21:40:56,830 - sqlalchemy.engine.Engine - INFO - [no key 0.00130s] ()
2025-12-15 21:40:56,838 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_is_confirmed ON users (is_confirmed)
2025-12-15 21:40:56,838 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-12-15 21:40:56,843 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auctions (
	id INTEGER NOT NULL, 
	title VARCHAR(255) NOT NULL, 
	description TEXT, 
	photos TEXT, 
	start_price FLOAT NOT NULL, 
	step_price FLOAT NOT NULL, 
	current_price FLOAT NOT NULL, 
	status VARCHAR(20), 
	winner_id INTEGER, 
	channel_message_id INTEGER, 
	last_bid_time DATETIME, 
	created_at DATETIME, 
	ends_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(winner_id) REFERENCES users (id)
)


2025-12-15 21:40:56,844 - sqlalchemy.engine.Engine - INFO - [no key 0.00129s] ()
2025-12-15 21:40:56,849 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_status ON auctions (status)
2025-12-15 21:40:56,850 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-12-15 21:40:56,854 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_ends_at ON auctions (ends_at)
2025-12-15 21:40:56,854 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-12-15 21:40:56,859 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_title ON auctions (title)
2025-12-15 21:40:56,860 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-12-15 21:40:56,864 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_last_bid_time ON auctions (last_bid_time)
2025-12-15 21:40:56,864 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-12-15 21:40:56,870 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_created_at ON auctions (created_at)
2025-12-15 21:40:56,870 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-12-15 21:40:56,875 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE bids (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	amount FLOAT NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-15 21:40:56,876 - sqlalchemy.engine.Engine - INFO - [no key 0.00123s] ()
2025-12-15 21:40:56,881 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_amount ON bids (amount)
2025-12-15 21:40:56,882 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-12-15 21:40:56,886 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_auction_user ON bids (auction_id, user_id)
2025-12-15 21:40:56,887 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-12-15 21:40:56,893 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_created_at ON bids (created_at)
2025-12-15 21:40:56,893 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-12-15 21:40:56,898 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auction_subscriptions (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-15 21:40:56,899 - sqlalchemy.engine.Engine - INFO - [no key 0.00092s] ()
2025-12-15 21:40:56,904 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_subscriptions_auction_user ON auction_subscriptions (auction_id, user_id)
2025-12-15 21:40:56,904 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-12-15 21:40:56,909 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE notifications (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	message TEXT NOT NULL, 
	is_read BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id)
)


2025-12-15 21:40:56,910 - sqlalchemy.engine.Engine - INFO - [no key 0.00106s] ()
2025-12-15 21:40:56,915 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_created_at ON notifications (created_at)
2025-12-15 21:40:56,915 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-12-15 21:40:56,920 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_user_read ON notifications (user_id, is_read)
2025-12-15 21:40:56,920 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-12-15 21:40:56,925 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:40:56,926 - __main__ - INFO - База данных инициализирована
2025-12-15 21:40:57,010 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:40:57,023 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-15 21:40:57,024 - sqlalchemy.engine.Engine - INFO - [generated in 0.00109s] ('active', '2025-12-15 18:40:57.008538')
2025-12-15 21:40:57,026 - utils.timer - INFO - Восстановлено 0 таймеров
2025-12-15 21:40:57,026 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:40:57,027 - __main__ - INFO - Планировщик таймеров запущен
2025-12-15 21:40:57,027 - __main__ - INFO - Бот запущен
2025-12-15 21:40:57,027 - aiogram.dispatcher - INFO - Start polling
2025-12-15 21:40:57,253 - aiogram.dispatcher - INFO - Run polling for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 21:41:08,480 - aiogram.event - INFO - Update id=558044309 is handled. Duration 313 ms by bot id=8417097922
2025-12-15 21:41:11,495 - aiogram.event - INFO - Update id=558044310 is handled. Duration 250 ms by bot id=8417097922
2025-12-15 21:41:15,770 - aiogram.event - INFO - Update id=558044311 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 21:41:17,791 - aiogram.event - INFO - Update id=558044312 is handled. Duration 140 ms by bot id=8417097922
2025-12-15 21:41:33,772 - aiogram.event - INFO - Update id=558044313 is handled. Duration 250 ms by bot id=8417097922
2025-12-15 21:41:36,690 - aiogram.event - INFO - Update id=558044314 is handled. Duration 140 ms by bot id=8417097922
2025-12-15 21:41:39,603 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:41:39,604 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-15 21:41:39,605 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] ('22', '21321', '["\\u041d\\u0435\\u0442 \\u0444\\u043e\\u0442\\u043e"]', 100.0, 100.0, 100.0, 'active', None, None, '2025-12-15 18:41:39.604692', '2025-12-15 18:41:39.604692', '2025-12-16 02:41:39.601693')
2025-12-15 21:41:39,606 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:41:39,613 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:41:39,615 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-15 21:41:39,615 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] (1,)
2025-12-15 21:41:39,617 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-15 21:41:39,666 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:41:39,667 - aiogram.event - INFO - Update id=558044315 is not handled. Duration 61 ms by bot id=8417097922
2025-12-15 21:41:39,668 - aiogram.event - ERROR - Cause exception while process update id=558044315 by bot id=8417097922
TypeError: can't subtract offset-naive and offset-aware datetimes
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.2\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.2\handlers\admin.py", line 126, in process_step_price
    message_text = format_auction_message(auction)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.2\utils\formatters.py", line 9, in format_auction_message
    time_remaining = format_time_remaining(auction.last_bid_time)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.2\utils\formatters.py", line 156, in format_time_remaining
    diff = now - last_bid_time
           ~~~~^~~~~~~~~~~~~~~
TypeError: can't subtract offset-naive and offset-aware datetimes
2025-12-15 21:42:21,445 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:42:21,445 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-15 21:42:21,446 - sqlalchemy.engine.Engine - INFO - [cached since 41.84s ago] ('22', '21321', '["\\u041d\\u0435\\u0442 \\u0444\\u043e\\u0442\\u043e"]', 100.0, 100.0, 100.0, 'active', None, None, '2025-12-15 18:42:21.445844', '2025-12-15 18:42:21.445844', '2025-12-16 02:42:21.444843')
2025-12-15 21:42:21,448 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:42:21,455 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:42:21,456 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-15 21:42:21,456 - sqlalchemy.engine.Engine - INFO - [cached since 41.84s ago] (2,)
2025-12-15 21:42:21,458 - utils.timer - INFO - Таймер запущен для аукциона #2
2025-12-15 21:42:21,458 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:42:21,460 - aiogram.event - INFO - Update id=558044316 is not handled. Duration 15 ms by bot id=8417097922
2025-12-15 21:42:21,460 - aiogram.event - ERROR - Cause exception while process update id=558044316 by bot id=8417097922
TypeError: can't subtract offset-naive and offset-aware datetimes
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.2\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.2\handlers\admin.py", line 126, in process_step_price
    message_text = format_auction_message(auction)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.2\utils\formatters.py", line 9, in format_auction_message
    time_remaining = format_time_remaining(auction.last_bid_time)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.2\utils\formatters.py", line 156, in format_time_remaining
    diff = now - last_bid_time
           ~~~~^~~~~~~~~~~~~~~
TypeError: can't subtract offset-naive and offset-aware datetimes
2025-12-15 21:42:25,541 - aiogram.dispatcher - INFO - Polling stopped
2025-12-15 21:42:25,794 - utils.timer - INFO - Все таймеры остановлены
2025-12-15 21:42:25,794 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-15 21:42:25,794 - utils.timer - INFO - Таймер для аукциона #2 отменен
2025-12-15 21:42:25,795 - aiogram.dispatcher - INFO - Polling stopped for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 21:45:41,793 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:45:41,793 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 21:45:41,794 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:45:41,795 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 21:45:41,796 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:45:41,796 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 21:45:41,797 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:45:41,797 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 21:45:41,798 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:45:41,798 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 21:45:41,799 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:45:41,800 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:45:41,801 - __main__ - INFO - База данных инициализирована
2025-12-15 21:45:41,847 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:45:41,861 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-15 21:45:41,861 - sqlalchemy.engine.Engine - INFO - [generated in 0.00099s] ('active', '2025-12-15 18:45:41.846204')
2025-12-15 21:45:41,863 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-15 21:45:41,863 - utils.timer - INFO - Таймер запущен для аукциона #2
2025-12-15 21:45:41,863 - utils.timer - INFO - Восстановлено 2 таймеров
2025-12-15 21:45:41,864 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:45:41,864 - __main__ - INFO - Планировщик таймеров запущен
2025-12-15 21:45:41,865 - __main__ - INFO - Бот запущен
2025-12-15 21:45:41,865 - aiogram.dispatcher - INFO - Start polling
2025-12-15 21:45:42,104 - aiogram.dispatcher - INFO - Run polling for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 21:45:42,268 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:45:42,269 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 21:45:42,270 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (8148367074,)
2025-12-15 21:45:42,273 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (telegram_id, username, first_name, last_name, phone, is_confirmed, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-12-15 21:45:42,273 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (8148367074, 'ammuniti0n', 'dark triad', None, None, 0, '2025-12-15 18:45:42.273301')
2025-12-15 21:45:42,275 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:45:42,599 - aiogram.event - INFO - Update id=558044317 is handled. Duration 327 ms by bot id=8417097922
2025-12-15 21:45:45,154 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:45:45,154 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 21:45:45,155 - sqlalchemy.engine.Engine - INFO - [cached since 2.886s ago] (8148367074,)
2025-12-15 21:45:45,157 - sqlalchemy.engine.Engine - INFO - UPDATE users SET is_confirmed=? WHERE users.id = ?
2025-12-15 21:45:45,157 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (1, 1)
2025-12-15 21:45:45,159 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:45:45,374 - aiogram.event - INFO - Update id=558044318 is handled. Duration 217 ms by bot id=8417097922
2025-12-15 21:45:46,685 - aiogram.event - INFO - Update id=558044319 is not handled. Duration 0 ms by bot id=8417097922
2025-12-15 21:45:52,043 - aiogram.event - INFO - Update id=558044320 is handled. Duration 234 ms by bot id=8417097922
2025-12-15 21:45:55,556 - aiogram.event - INFO - Update id=558044321 is handled. Duration 202 ms by bot id=8417097922
2025-12-15 21:45:57,705 - aiogram.event - INFO - Update id=558044322 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 21:45:59,049 - aiogram.event - INFO - Update id=558044323 is handled. Duration 94 ms by bot id=8417097922
2025-12-15 21:46:09,694 - aiogram.event - INFO - Update id=558044324 is handled. Duration 125 ms by bot id=8417097922
2025-12-15 21:46:14,728 - aiogram.event - INFO - Update id=558044325 is handled. Duration 125 ms by bot id=8417097922
2025-12-15 21:46:16,814 - handlers.admin - INFO - Получено сообщение: 100 от пользователя 8148367074
2025-12-15 21:46:16,814 - handlers.admin - INFO - Шаг ставки преобразован: 100.0
2025-12-15 21:46:16,814 - handlers.admin - INFO - Получены данные из состояния: {'title': '43653', 'description': '12421]', 'photos': 'Нет фото', 'start_price': 100.0}
2025-12-15 21:46:16,814 - handlers.admin - INFO - Сессия БД открыта
2025-12-15 21:46:16,814 - handlers.admin - INFO - Создан объект аукциона: 43653
2025-12-15 21:46:16,816 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:46:16,818 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-15 21:46:16,818 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] ('43653', '12421]', '["\\u041d\\u0435\\u0442 \\u0444\\u043e\\u0442\\u043e"]', 100.0, 100.0, 100.0, 'active', None, None, '2025-12-15 18:46:16.818404', '2025-12-15 18:46:16.818404', '2025-12-16 02:46:16.814402')
2025-12-15 21:46:16,821 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:46:16,826 - handlers.admin - INFO - Аукцион сохранен в БД
2025-12-15 21:46:16,828 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:46:16,830 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-15 21:46:16,831 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] (3,)
2025-12-15 21:46:16,832 - handlers.admin - INFO - Аукцион ID: 3
2025-12-15 21:46:16,832 - utils.timer - INFO - Таймер запущен для аукциона #3
2025-12-15 21:46:16,833 - handlers.admin - INFO - Таймер запущен для аукциона #3
2025-12-15 21:46:16,881 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:46:16,882 - handlers.admin - ERROR - Неизвестная ошибка: can't subtract offset-naive and offset-aware datetimes
Traceback (most recent call last):
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.2\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.2\handlers\admin.py", line 140, in process_step_price
    message_text = format_auction_message(auction)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.2\utils\formatters.py", line 9, in format_auction_message
    time_remaining = format_time_remaining(auction.last_bid_time)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.2\utils\formatters.py", line 156, in format_time_remaining
    diff = now - last_bid_time
           ~~~~^~~~~~~~~~~~~~~
TypeError: can't subtract offset-naive and offset-aware datetimes
2025-12-15 21:46:17,006 - aiogram.event - INFO - Update id=558044326 is handled. Duration 203 ms by bot id=8417097922
2025-12-15 21:47:04,613 - aiogram.dispatcher - INFO - Polling stopped
2025-12-15 21:47:04,869 - utils.timer - INFO - Все таймеры остановлены
2025-12-15 21:47:04,869 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-15 21:47:04,869 - utils.timer - INFO - Таймер для аукциона #2 отменен
2025-12-15 21:47:04,869 - utils.timer - INFO - Таймер для аукциона #3 отменен
2025-12-15 21:47:04,870 - aiogram.dispatcher - INFO - Polling stopped for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 21:53:07,806 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:53:07,806 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 21:53:07,806 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:07,808 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-12-15 21:53:07,808 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:07,809 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 21:53:07,809 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:07,810 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-15 21:53:07,810 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:07,811 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 21:53:07,811 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:07,812 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-15 21:53:07,812 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:07,813 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 21:53:07,813 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:07,814 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-15 21:53:07,814 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:07,815 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 21:53:07,815 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:07,816 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-15 21:53:07,816 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:07,818 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	username VARCHAR(100), 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	phone VARCHAR(20), 
	is_confirmed BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id)
)


2025-12-15 21:53:07,819 - sqlalchemy.engine.Engine - INFO - [no key 0.00107s] ()
2025-12-15 21:53:07,825 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_is_confirmed ON users (is_confirmed)
2025-12-15 21:53:07,826 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-12-15 21:53:07,831 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auctions (
	id INTEGER NOT NULL, 
	title VARCHAR(255) NOT NULL, 
	description TEXT, 
	photos TEXT, 
	start_price FLOAT NOT NULL, 
	step_price FLOAT NOT NULL, 
	current_price FLOAT NOT NULL, 
	status VARCHAR(20), 
	winner_id INTEGER, 
	channel_message_id INTEGER, 
	last_bid_time DATETIME, 
	created_at DATETIME, 
	ends_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(winner_id) REFERENCES users (id)
)


2025-12-15 21:53:07,833 - sqlalchemy.engine.Engine - INFO - [no key 0.00161s] ()
2025-12-15 21:53:07,837 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_title ON auctions (title)
2025-12-15 21:53:07,838 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-12-15 21:53:07,844 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_last_bid_time ON auctions (last_bid_time)
2025-12-15 21:53:07,845 - sqlalchemy.engine.Engine - INFO - [no key 0.00058s] ()
2025-12-15 21:53:07,849 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_created_at ON auctions (created_at)
2025-12-15 21:53:07,850 - sqlalchemy.engine.Engine - INFO - [no key 0.00054s] ()
2025-12-15 21:53:07,855 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_status ON auctions (status)
2025-12-15 21:53:07,856 - sqlalchemy.engine.Engine - INFO - [no key 0.00060s] ()
2025-12-15 21:53:07,860 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_ends_at ON auctions (ends_at)
2025-12-15 21:53:07,861 - sqlalchemy.engine.Engine - INFO - [no key 0.00053s] ()
2025-12-15 21:53:07,867 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE bids (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	amount FLOAT NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-15 21:53:07,868 - sqlalchemy.engine.Engine - INFO - [no key 0.00142s] ()
2025-12-15 21:53:07,872 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_amount ON bids (amount)
2025-12-15 21:53:07,873 - sqlalchemy.engine.Engine - INFO - [no key 0.00044s] ()
2025-12-15 21:53:07,878 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_auction_user ON bids (auction_id, user_id)
2025-12-15 21:53:07,879 - sqlalchemy.engine.Engine - INFO - [no key 0.00046s] ()
2025-12-15 21:53:07,883 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_created_at ON bids (created_at)
2025-12-15 21:53:07,884 - sqlalchemy.engine.Engine - INFO - [no key 0.00054s] ()
2025-12-15 21:53:07,890 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auction_subscriptions (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-15 21:53:07,891 - sqlalchemy.engine.Engine - INFO - [no key 0.00135s] ()
2025-12-15 21:53:07,897 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_subscriptions_auction_user ON auction_subscriptions (auction_id, user_id)
2025-12-15 21:53:07,898 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-12-15 21:53:07,903 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE notifications (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	message TEXT NOT NULL, 
	is_read BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id)
)


2025-12-15 21:53:07,904 - sqlalchemy.engine.Engine - INFO - [no key 0.00150s] ()
2025-12-15 21:53:07,909 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_user_read ON notifications (user_id, is_read)
2025-12-15 21:53:07,909 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-12-15 21:53:07,915 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_created_at ON notifications (created_at)
2025-12-15 21:53:07,915 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-12-15 21:53:07,920 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:53:07,921 - __main__ - INFO - База данных инициализирована
2025-12-15 21:53:08,003 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:53:08,016 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-15 21:53:08,017 - sqlalchemy.engine.Engine - INFO - [generated in 0.00097s] ('active', '2025-12-15 18:53:08.001359')
2025-12-15 21:53:08,019 - utils.timer - INFO - Восстановлено 0 таймеров
2025-12-15 21:53:08,019 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:53:08,020 - __main__ - INFO - Планировщик таймеров запущен
2025-12-15 21:53:08,020 - __main__ - INFO - Бот запущен
2025-12-15 21:53:08,020 - aiogram.dispatcher - INFO - Start polling
2025-12-15 21:53:08,323 - aiogram.dispatcher - INFO - Run polling for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 21:53:12,005 - aiogram.dispatcher - INFO - Polling stopped
2025-12-15 21:53:12,263 - utils.timer - INFO - Все таймеры остановлены
2025-12-15 21:53:12,263 - aiogram.dispatcher - INFO - Polling stopped for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 21:53:24,740 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:53:24,741 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 21:53:24,742 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:24,743 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-12-15 21:53:24,743 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:24,744 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 21:53:24,744 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:24,745 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-15 21:53:24,745 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:24,746 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 21:53:24,746 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:24,747 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-15 21:53:24,748 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:24,748 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 21:53:24,749 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:24,750 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-15 21:53:24,750 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:24,751 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 21:53:24,751 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:24,752 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-15 21:53:24,753 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:53:24,754 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	username VARCHAR(100), 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	phone VARCHAR(20), 
	is_confirmed BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id)
)


2025-12-15 21:53:24,755 - sqlalchemy.engine.Engine - INFO - [no key 0.00093s] ()
2025-12-15 21:53:24,761 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_is_confirmed ON users (is_confirmed)
2025-12-15 21:53:24,762 - sqlalchemy.engine.Engine - INFO - [no key 0.00048s] ()
2025-12-15 21:53:24,768 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auctions (
	id INTEGER NOT NULL, 
	title VARCHAR(255) NOT NULL, 
	description TEXT, 
	photos TEXT, 
	start_price FLOAT NOT NULL, 
	step_price FLOAT NOT NULL, 
	current_price FLOAT NOT NULL, 
	status VARCHAR(20), 
	winner_id INTEGER, 
	channel_message_id INTEGER, 
	last_bid_time DATETIME, 
	created_at DATETIME, 
	ends_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(winner_id) REFERENCES users (id)
)


2025-12-15 21:53:24,769 - sqlalchemy.engine.Engine - INFO - [no key 0.00151s] ()
2025-12-15 21:53:24,774 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_title ON auctions (title)
2025-12-15 21:53:24,774 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-12-15 21:53:24,779 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_status ON auctions (status)
2025-12-15 21:53:24,780 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-12-15 21:53:24,784 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_ends_at ON auctions (ends_at)
2025-12-15 21:53:24,785 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-12-15 21:53:24,790 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_last_bid_time ON auctions (last_bid_time)
2025-12-15 21:53:24,791 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-12-15 21:53:24,796 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_created_at ON auctions (created_at)
2025-12-15 21:53:24,797 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-12-15 21:53:24,802 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE bids (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	amount FLOAT NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-15 21:53:24,803 - sqlalchemy.engine.Engine - INFO - [no key 0.00115s] ()
2025-12-15 21:53:24,808 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_auction_user ON bids (auction_id, user_id)
2025-12-15 21:53:24,808 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-12-15 21:53:24,813 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_created_at ON bids (created_at)
2025-12-15 21:53:24,814 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-12-15 21:53:24,818 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_amount ON bids (amount)
2025-12-15 21:53:24,818 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-12-15 21:53:24,823 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auction_subscriptions (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-15 21:53:24,824 - sqlalchemy.engine.Engine - INFO - [no key 0.00092s] ()
2025-12-15 21:53:24,830 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_subscriptions_auction_user ON auction_subscriptions (auction_id, user_id)
2025-12-15 21:53:24,830 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-12-15 21:53:24,835 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE notifications (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	message TEXT NOT NULL, 
	is_read BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id)
)


2025-12-15 21:53:24,836 - sqlalchemy.engine.Engine - INFO - [no key 0.00106s] ()
2025-12-15 21:53:24,840 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_created_at ON notifications (created_at)
2025-12-15 21:53:24,841 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-12-15 21:53:24,846 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_user_read ON notifications (user_id, is_read)
2025-12-15 21:53:24,846 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-12-15 21:53:24,850 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:53:24,851 - __main__ - INFO - База данных инициализирована
2025-12-15 21:53:24,882 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:53:24,896 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-15 21:53:24,897 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ('active', '2025-12-15 18:53:24.880786')
2025-12-15 21:53:24,898 - utils.timer - INFO - Восстановлено 0 таймеров
2025-12-15 21:53:24,899 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:53:24,900 - __main__ - INFO - Планировщик таймеров запущен
2025-12-15 21:53:24,900 - __main__ - INFO - Бот запущен
2025-12-15 21:53:24,900 - aiogram.dispatcher - INFO - Start polling
2025-12-15 21:53:25,131 - aiogram.dispatcher - INFO - Run polling for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 21:53:35,887 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:53:35,889 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 21:53:35,889 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] (8148367074,)
2025-12-15 21:53:35,892 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (telegram_id, username, first_name, last_name, phone, is_confirmed, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-12-15 21:53:35,892 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (8148367074, 'ammuniti0n', 'dark triad', None, None, 0, '2025-12-15 18:53:35.892292')
2025-12-15 21:53:35,894 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:53:36,186 - aiogram.event - INFO - Update id=558044327 is handled. Duration 296 ms by bot id=8417097922
2025-12-15 21:53:37,646 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:53:37,647 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 21:53:37,647 - sqlalchemy.engine.Engine - INFO - [cached since 1.759s ago] (8148367074,)
2025-12-15 21:53:37,649 - sqlalchemy.engine.Engine - INFO - UPDATE users SET is_confirmed=? WHERE users.id = ?
2025-12-15 21:53:37,649 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (1, 1)
2025-12-15 21:53:37,651 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:53:37,857 - aiogram.event - INFO - Update id=558044328 is handled. Duration 219 ms by bot id=8417097922
2025-12-15 21:53:41,121 - aiogram.event - INFO - Update id=558044329 is handled. Duration 125 ms by bot id=8417097922
2025-12-15 21:53:42,696 - aiogram.event - INFO - Update id=558044330 is handled. Duration 203 ms by bot id=8417097922
2025-12-15 21:53:44,493 - aiogram.event - INFO - Update id=558044331 is handled. Duration 125 ms by bot id=8417097922
2025-12-15 21:53:46,959 - aiogram.event - INFO - Update id=558044332 is handled. Duration 171 ms by bot id=8417097922
2025-12-15 21:53:52,092 - aiogram.event - INFO - Update id=558044333 is handled. Duration 233 ms by bot id=8417097922
2025-12-15 21:53:54,709 - aiogram.event - INFO - Update id=558044334 is handled. Duration 125 ms by bot id=8417097922
2025-12-15 21:53:56,622 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:53:56,624 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-15 21:53:56,624 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] ('2343', '24h24', '["\\u041d\\u0435\\u0442 \\u0444\\u043e\\u0442\\u043e"]', 100.0, 1000.0, 100.0, 'active', None, None, '2025-12-15 18:53:56.624388', '2025-12-15 18:53:56.624388', '2025-12-16 02:53:56.620388')
2025-12-15 21:53:56,626 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:53:56,633 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:53:56,635 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-15 21:53:56,636 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] (1,)
2025-12-15 21:53:56,637 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-15 21:53:56,639 - sqlalchemy.engine.Engine - INFO - SELECT bids.id AS bids_id, bids.auction_id AS bids_auction_id, bids.user_id AS bids_user_id, bids.amount AS bids_amount, bids.created_at AS bids_created_at 
FROM bids 
WHERE ? = bids.auction_id ORDER BY bids.amount DESC
2025-12-15 21:53:56,639 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] (1,)
2025-12-15 21:53:56,640 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:53:56,799 - aiogram.event - INFO - Update id=558044335 is handled. Duration 172 ms by bot id=8417097922
2025-12-15 21:55:46,960 - aiogram.dispatcher - INFO - Polling stopped
2025-12-15 21:55:47,217 - utils.timer - INFO - Все таймеры остановлены
2025-12-15 21:55:47,217 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-15 21:55:47,217 - aiogram.dispatcher - INFO - Polling stopped for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 21:58:50,147 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:58:50,148 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 21:58:50,148 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:58:50,150 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 21:58:50,150 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:58:50,151 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 21:58:50,151 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:58:50,152 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 21:58:50,152 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:58:50,153 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 21:58:50,153 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:58:50,155 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:58:50,157 - __main__ - INFO - База данных инициализирована
2025-12-15 21:58:50,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:58:50,218 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-15 21:58:50,218 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] ('active', '2025-12-15 18:58:50.201989')
2025-12-15 21:58:50,220 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-15 21:58:50,220 - utils.timer - INFO - Восстановлено 1 таймеров
2025-12-15 21:58:50,224 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:58:50,225 - __main__ - INFO - Планировщик таймеров запущен
2025-12-15 21:58:50,225 - __main__ - INFO - Бот запущен
2025-12-15 21:58:50,225 - aiogram.dispatcher - INFO - Start polling
2025-12-15 21:58:50,453 - aiogram.dispatcher - INFO - Run polling for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 21:58:52,551 - aiogram.dispatcher - INFO - Polling stopped
2025-12-15 21:58:52,805 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-15 21:58:57,549 - aiogram.dispatcher - INFO - Polling stopped for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 21:59:08,483 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:59:08,484 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 21:59:08,484 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:59:08,485 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-12-15 21:59:08,486 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:59:08,486 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 21:59:08,487 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:59:08,488 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-15 21:59:08,488 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:59:08,489 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 21:59:08,490 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:59:08,491 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-15 21:59:08,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:59:08,492 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 21:59:08,492 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:59:08,493 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-15 21:59:08,493 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:59:08,494 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 21:59:08,495 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:59:08,496 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-15 21:59:08,496 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 21:59:08,497 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	username VARCHAR(100), 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	phone VARCHAR(20), 
	is_confirmed BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id)
)


2025-12-15 21:59:08,499 - sqlalchemy.engine.Engine - INFO - [no key 0.00144s] ()
2025-12-15 21:59:08,507 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_is_confirmed ON users (is_confirmed)
2025-12-15 21:59:08,507 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-12-15 21:59:08,512 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auctions (
	id INTEGER NOT NULL, 
	title VARCHAR(255) NOT NULL, 
	description TEXT, 
	photos TEXT, 
	start_price FLOAT NOT NULL, 
	step_price FLOAT NOT NULL, 
	current_price FLOAT NOT NULL, 
	status VARCHAR(20), 
	winner_id INTEGER, 
	channel_message_id INTEGER, 
	last_bid_time DATETIME, 
	created_at DATETIME, 
	ends_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(winner_id) REFERENCES users (id)
)


2025-12-15 21:59:08,514 - sqlalchemy.engine.Engine - INFO - [no key 0.00158s] ()
2025-12-15 21:59:08,519 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_created_at ON auctions (created_at)
2025-12-15 21:59:08,520 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-12-15 21:59:08,527 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_ends_at ON auctions (ends_at)
2025-12-15 21:59:08,527 - sqlalchemy.engine.Engine - INFO - [no key 0.00064s] ()
2025-12-15 21:59:08,534 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_status ON auctions (status)
2025-12-15 21:59:08,534 - sqlalchemy.engine.Engine - INFO - [no key 0.00046s] ()
2025-12-15 21:59:08,539 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_title ON auctions (title)
2025-12-15 21:59:08,539 - sqlalchemy.engine.Engine - INFO - [no key 0.00054s] ()
2025-12-15 21:59:08,545 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_last_bid_time ON auctions (last_bid_time)
2025-12-15 21:59:08,546 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-12-15 21:59:08,550 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE bids (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	amount FLOAT NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-15 21:59:08,551 - sqlalchemy.engine.Engine - INFO - [no key 0.00124s] ()
2025-12-15 21:59:08,557 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_amount ON bids (amount)
2025-12-15 21:59:08,557 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-12-15 21:59:08,562 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_auction_user ON bids (auction_id, user_id)
2025-12-15 21:59:08,562 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-12-15 21:59:08,568 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_created_at ON bids (created_at)
2025-12-15 21:59:08,568 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-12-15 21:59:08,575 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auction_subscriptions (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-15 21:59:08,576 - sqlalchemy.engine.Engine - INFO - [no key 0.00119s] ()
2025-12-15 21:59:08,582 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_subscriptions_auction_user ON auction_subscriptions (auction_id, user_id)
2025-12-15 21:59:08,582 - sqlalchemy.engine.Engine - INFO - [no key 0.00058s] ()
2025-12-15 21:59:08,587 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE notifications (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	message TEXT NOT NULL, 
	is_read BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id)
)


2025-12-15 21:59:08,591 - sqlalchemy.engine.Engine - INFO - [no key 0.00397s] ()
2025-12-15 21:59:08,597 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_user_read ON notifications (user_id, is_read)
2025-12-15 21:59:08,597 - sqlalchemy.engine.Engine - INFO - [no key 0.00058s] ()
2025-12-15 21:59:08,602 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_created_at ON notifications (created_at)
2025-12-15 21:59:08,602 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-12-15 21:59:08,610 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:59:08,612 - __main__ - INFO - База данных инициализирована
2025-12-15 21:59:08,649 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:59:08,664 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-15 21:59:08,665 - sqlalchemy.engine.Engine - INFO - [generated in 0.00099s] ('active', '2025-12-15 18:59:08.647570')
2025-12-15 21:59:08,667 - utils.timer - INFO - Восстановлено 0 таймеров
2025-12-15 21:59:08,668 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:59:08,668 - __main__ - INFO - Планировщик таймеров запущен
2025-12-15 21:59:08,669 - __main__ - INFO - Бот запущен
2025-12-15 21:59:08,669 - aiogram.dispatcher - INFO - Start polling
2025-12-15 21:59:08,900 - aiogram.dispatcher - INFO - Run polling for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 21:59:17,658 - aiogram.event - INFO - Update id=558044336 is handled. Duration 265 ms by bot id=8417097922
2025-12-15 21:59:21,436 - aiogram.event - INFO - Update id=558044337 is handled. Duration 265 ms by bot id=8417097922
2025-12-15 21:59:24,163 - aiogram.event - INFO - Update id=558044338 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 21:59:26,419 - aiogram.event - INFO - Update id=558044339 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 21:59:31,080 - aiogram.event - INFO - Update id=558044340 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 21:59:33,800 - aiogram.event - INFO - Update id=558044341 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 21:59:35,254 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:59:35,256 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-15 21:59:35,256 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] ('100', 'Aaaa', '["\\u041d\\u0435\\u0442 \\u0444\\u043e\\u0442\\u043e"]', 100.0, 100.0, 100.0, 'active', None, None, '2025-12-15 18:59:35.256445', '2025-12-15 18:59:35.256445', '2025-12-16 02:59:35.253444')
2025-12-15 21:59:35,258 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:59:35,263 - handlers.admin - INFO - Аукцион создан с ID: 1
2025-12-15 21:59:35,264 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-15 21:59:35,265 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:59:35,267 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-15 21:59:35,267 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (1,)
2025-12-15 21:59:35,270 - sqlalchemy.engine.Engine - INFO - SELECT bids.id AS bids_id, bids.auction_id AS bids_auction_id, bids.user_id AS bids_user_id, bids.amount AS bids_amount, bids.created_at AS bids_created_at 
FROM bids 
WHERE ? = bids.auction_id ORDER BY bids.amount DESC
2025-12-15 21:59:35,271 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] (1,)
2025-12-15 21:59:35,272 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:59:35,406 - aiogram.event - INFO - Update id=558044342 is handled. Duration 157 ms by bot id=8417097922
2025-12-15 21:59:55,818 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:59:55,818 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-15 21:59:55,819 - sqlalchemy.engine.Engine - INFO - [cached since 20.56s ago] ('100', 'Aaaa', '["\\u041d\\u0435\\u0442 \\u0444\\u043e\\u0442\\u043e"]', 100.0, 100.0, 100.0, 'active', None, None, '2025-12-15 18:59:55.818586', '2025-12-15 18:59:55.818586', '2025-12-16 02:59:55.817586')
2025-12-15 21:59:55,820 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 21:59:55,826 - handlers.admin - INFO - Аукцион создан с ID: 2
2025-12-15 21:59:55,827 - utils.timer - INFO - Таймер запущен для аукциона #2
2025-12-15 21:59:55,828 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 21:59:55,829 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-15 21:59:55,830 - sqlalchemy.engine.Engine - INFO - [cached since 20.56s ago] (2,)
2025-12-15 21:59:55,831 - sqlalchemy.engine.Engine - INFO - SELECT bids.id AS bids_id, bids.auction_id AS bids_auction_id, bids.user_id AS bids_user_id, bids.amount AS bids_amount, bids.created_at AS bids_created_at 
FROM bids 
WHERE ? = bids.auction_id ORDER BY bids.amount DESC
2025-12-15 21:59:55,831 - sqlalchemy.engine.Engine - INFO - [cached since 20.56s ago] (2,)
2025-12-15 21:59:55,832 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 21:59:56,117 - aiogram.event - INFO - Update id=558044343 is handled. Duration 311 ms by bot id=8417097922
2025-12-15 22:01:35,781 - aiogram.dispatcher - INFO - Polling stopped
2025-12-15 22:01:36,039 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-15 22:01:36,039 - utils.timer - INFO - Таймер для аукциона #2 отменен
2025-12-15 22:01:36,590 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 1] [SSL: APPLICATION_DATA_AFTER_CLOSE_NOTIFY] application data after close notify (_ssl.c:2672)
2025-12-15 22:01:36,590 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8417097922)
2025-12-15 22:01:47,801 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8417097922)
2025-12-15 22:01:52,492 - aiogram.dispatcher - INFO - Polling stopped for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 22:12:55,883 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:12:55,883 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 22:12:55,884 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:12:55,885 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-12-15 22:12:55,885 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:12:55,886 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 22:12:55,886 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:12:55,888 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-15 22:12:55,888 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:12:55,889 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 22:12:55,889 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:12:55,890 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-15 22:12:55,890 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:12:55,891 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 22:12:55,892 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:12:55,892 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-15 22:12:55,893 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:12:55,894 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 22:12:55,894 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:12:55,895 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-15 22:12:55,895 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:12:55,897 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	username VARCHAR(100), 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	phone VARCHAR(20), 
	is_confirmed BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id)
)


2025-12-15 22:12:55,897 - sqlalchemy.engine.Engine - INFO - [no key 0.00095s] ()
2025-12-15 22:12:55,907 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_is_confirmed ON users (is_confirmed)
2025-12-15 22:12:55,907 - sqlalchemy.engine.Engine - INFO - [no key 0.00056s] ()
2025-12-15 22:12:55,912 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auctions (
	id INTEGER NOT NULL, 
	title VARCHAR(255) NOT NULL, 
	description TEXT, 
	photos TEXT, 
	start_price FLOAT NOT NULL, 
	step_price FLOAT NOT NULL, 
	current_price FLOAT NOT NULL, 
	status VARCHAR(20), 
	winner_id INTEGER, 
	channel_message_id INTEGER, 
	last_bid_time DATETIME, 
	created_at DATETIME, 
	ends_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(winner_id) REFERENCES users (id)
)


2025-12-15 22:12:55,913 - sqlalchemy.engine.Engine - INFO - [no key 0.00131s] ()
2025-12-15 22:12:55,918 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_status ON auctions (status)
2025-12-15 22:12:55,919 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-12-15 22:12:55,924 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_ends_at ON auctions (ends_at)
2025-12-15 22:12:55,925 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-12-15 22:12:55,930 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_last_bid_time ON auctions (last_bid_time)
2025-12-15 22:12:55,930 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-12-15 22:12:55,935 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_title ON auctions (title)
2025-12-15 22:12:55,935 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-12-15 22:12:55,940 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_created_at ON auctions (created_at)
2025-12-15 22:12:55,941 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-12-15 22:12:55,945 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE bids (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	amount FLOAT NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-15 22:12:55,946 - sqlalchemy.engine.Engine - INFO - [no key 0.00102s] ()
2025-12-15 22:12:55,951 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_auction_user ON bids (auction_id, user_id)
2025-12-15 22:12:55,952 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-12-15 22:12:55,957 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_created_at ON bids (created_at)
2025-12-15 22:12:55,957 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-12-15 22:12:55,962 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_amount ON bids (amount)
2025-12-15 22:12:55,963 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-12-15 22:12:55,967 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auction_subscriptions (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-15 22:12:55,968 - sqlalchemy.engine.Engine - INFO - [no key 0.00112s] ()
2025-12-15 22:12:55,975 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_subscriptions_auction_user ON auction_subscriptions (auction_id, user_id)
2025-12-15 22:12:55,976 - sqlalchemy.engine.Engine - INFO - [no key 0.00062s] ()
2025-12-15 22:12:55,981 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE notifications (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	message TEXT NOT NULL, 
	is_read BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id)
)


2025-12-15 22:12:55,982 - sqlalchemy.engine.Engine - INFO - [no key 0.00156s] ()
2025-12-15 22:12:55,989 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_created_at ON notifications (created_at)
2025-12-15 22:12:55,989 - sqlalchemy.engine.Engine - INFO - [no key 0.00048s] ()
2025-12-15 22:12:55,994 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_user_read ON notifications (user_id, is_read)
2025-12-15 22:12:55,994 - sqlalchemy.engine.Engine - INFO - [no key 0.00050s] ()
2025-12-15 22:12:55,999 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:12:56,000 - __main__ - INFO - База данных инициализирована
2025-12-15 22:12:56,073 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:12:56,086 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-15 22:12:56,087 - sqlalchemy.engine.Engine - INFO - [generated in 0.00104s] ('active', '2025-12-15 19:12:56.071550')
2025-12-15 22:12:56,089 - utils.timer - INFO - Восстановлено 0 таймеров
2025-12-15 22:12:56,089 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:12:56,090 - __main__ - INFO - Планировщик таймеров запущен
2025-12-15 22:12:56,090 - __main__ - INFO - Бот запущен
2025-12-15 22:12:56,090 - aiogram.dispatcher - INFO - Start polling
2025-12-15 22:12:56,737 - aiogram.dispatcher - INFO - Run polling for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 22:13:00,934 - aiogram.event - INFO - Update id=558044344 is handled. Duration 265 ms by bot id=8417097922
2025-12-15 22:13:01,979 - aiogram.event - INFO - Update id=558044345 is handled. Duration 203 ms by bot id=8417097922
2025-12-15 22:13:04,661 - aiogram.event - INFO - Update id=558044346 is handled. Duration 157 ms by bot id=8417097922
2025-12-15 22:13:06,578 - aiogram.event - INFO - Update id=558044347 is handled. Duration 140 ms by bot id=8417097922
2025-12-15 22:13:12,646 - aiogram.event - INFO - Update id=558044348 is handled. Duration 125 ms by bot id=8417097922
2025-12-15 22:13:15,416 - aiogram.event - INFO - Update id=558044349 is handled. Duration 125 ms by bot id=8417097922
2025-12-15 22:13:16,906 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:13:16,908 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-15 22:13:16,908 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] ('Aeq', 'Aaaa', '["\\u041d\\u0435\\u0442 \\u0444\\u043e\\u0442\\u043e"]', 100.0, 100.0, 100.0, 'active', None, None, '2025-12-15 19:13:16.908540', '2025-12-15 19:13:16.908540', '2025-12-16 03:13:16.905540')
2025-12-15 22:13:16,912 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:13:16,919 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:13:16,920 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-15 22:13:16,921 - sqlalchemy.engine.Engine - INFO - [generated in 0.00097s] ('Aeq', 1, 0)
2025-12-15 22:13:16,923 - handlers.admin - INFO - Аукцион создан с ID: 1
2025-12-15 22:13:16,923 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:13:16,923 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-15 22:13:17,086 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:13:17,087 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-15 22:13:17,087 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] (1,)
2025-12-15 22:13:17,090 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-15 22:13:17,090 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (3, 1)
2025-12-15 22:13:17,091 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:13:17,232 - aiogram.event - INFO - Update id=558044350 is handled. Duration 328 ms by bot id=8417097922
2025-12-15 22:13:25,881 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:13:25,883 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-15 22:13:25,883 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] (1, 'active')
2025-12-15 22:13:25,886 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 22:13:25,886 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (8148367074,)
2025-12-15 22:13:26,025 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:13:26,027 - aiogram.event - INFO - Update id=558044351 is handled. Duration 157 ms by bot id=8417097922
2025-12-15 22:13:47,625 - aiogram.event - INFO - Update id=558044352 is not handled. Duration 0 ms by bot id=8417097922
2025-12-15 22:13:50,619 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:13:50,619 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-15 22:13:50,620 - sqlalchemy.engine.Engine - INFO - [cached since 24.74s ago] (1, 'active')
2025-12-15 22:13:50,621 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 22:13:50,622 - sqlalchemy.engine.Engine - INFO - [cached since 24.74s ago] (8148367074,)
2025-12-15 22:13:50,934 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:13:50,936 - aiogram.event - INFO - Update id=558044353 is handled. Duration 313 ms by bot id=8417097922
2025-12-15 22:13:55,803 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:13:55,804 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 22:13:55,804 - sqlalchemy.engine.Engine - INFO - [cached since 29.92s ago] (8148367074,)
2025-12-15 22:13:55,807 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (telegram_id, username, first_name, last_name, phone, is_confirmed, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-12-15 22:13:55,807 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] (8148367074, 'ammuniti0n', 'dark triad', None, None, 0, '2025-12-15 19:13:55.807044')
2025-12-15 22:13:55,809 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:13:55,920 - aiogram.event - INFO - Update id=558044354 is handled. Duration 125 ms by bot id=8417097922
2025-12-15 22:13:57,312 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:13:57,313 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 22:13:57,313 - sqlalchemy.engine.Engine - INFO - [cached since 31.43s ago] (8148367074,)
2025-12-15 22:13:57,315 - sqlalchemy.engine.Engine - INFO - UPDATE users SET is_confirmed=? WHERE users.id = ?
2025-12-15 22:13:57,315 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] (1, 1)
2025-12-15 22:13:57,317 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:13:57,733 - aiogram.event - INFO - Update id=558044355 is handled. Duration 422 ms by bot id=8417097922
2025-12-15 22:13:59,722 - aiogram.event - INFO - Update id=558044356 is not handled. Duration 0 ms by bot id=8417097922
2025-12-15 22:14:03,838 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:14:03,839 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-15 22:14:03,839 - sqlalchemy.engine.Engine - INFO - [cached since 37.96s ago] (1, 'active')
2025-12-15 22:14:03,841 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 22:14:03,841 - sqlalchemy.engine.Engine - INFO - [cached since 37.96s ago] (8148367074,)
2025-12-15 22:14:03,843 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-15 22:14:03,844 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (1,)
2025-12-15 22:14:03,846 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-15 22:14:03,847 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] (200.0, '2025-12-15 19:14:03.846896', '2025-12-16 03:14:03.846896', 1)
2025-12-15 22:14:03,849 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-15 22:14:03,850 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (1, 1, 200.0, '2025-12-15 19:14:03.849897')
2025-12-15 22:14:03,851 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:14:03,859 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:14:03,863 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-15 22:14:03,864 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] (1, 3, 0)
2025-12-15 22:14:03,868 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-15 22:14:03,868 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (1,)
2025-12-15 22:14:03,871 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-15 22:14:03,871 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] (1,)
2025-12-15 22:14:03,873 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-15 22:14:03,873 - sqlalchemy.engine.Engine - INFO - [cached since 46.79s ago] (1,)
2025-12-15 22:14:03,985 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:14:03,986 - handlers.auction - ERROR - Ошибка при обработке ставки: 'async for' requires an object with __aiter__ method, got _AsyncGeneratorContextManager
Traceback (most recent call last):
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.2\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.2\handlers\auction.py", line 135, in process_bid
    await send_subscription_notification(callback.bot, auction, user, amount)
  File "O:\CODE\TG BOTS\PIT AUC v0.2\utils\notifications.py", line 43, in send_subscription_notification
    async for session in get_db():
TypeError: 'async for' requires an object with __aiter__ method, got _AsyncGeneratorContextManager
2025-12-15 22:14:04,075 - aiogram.event - INFO - Update id=558044357 is handled. Duration 234 ms by bot id=8417097922
2025-12-15 22:14:07,677 - aiogram.event - INFO - Update id=558044358 is not handled. Duration 15 ms by bot id=8417097922
2025-12-15 22:14:16,812 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:14:16,813 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.created_at DESC
 LIMIT ? OFFSET ?
2025-12-15 22:14:16,813 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] (1, 20, 0)
2025-12-15 22:14:16,815 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-15 22:14:16,816 - sqlalchemy.engine.Engine - INFO - [cached since 12.95s ago] (1,)
2025-12-15 22:14:17,043 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:14:17,044 - aiogram.event - INFO - Update id=558044359 is handled. Duration 234 ms by bot id=8417097922
2025-12-15 22:14:30,690 - aiogram.event - INFO - Update id=558044360 is not handled. Duration 0 ms by bot id=8417097922
2025-12-15 22:14:59,659 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:14:59,659 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 22:14:59,660 - sqlalchemy.engine.Engine - INFO - [cached since 93.77s ago] (8148367074,)
2025-12-15 22:14:59,662 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id = ?
2025-12-15 22:14:59,663 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] (1, 1)
2025-12-15 22:14:59,665 - sqlalchemy.engine.Engine - INFO - INSERT INTO auction_subscriptions (auction_id, user_id, created_at) VALUES (?, ?, ?)
2025-12-15 22:14:59,665 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] (1, 1, '2025-12-15 19:14:59.665025')
2025-12-15 22:14:59,667 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:15:00,026 - aiogram.event - INFO - Update id=558044361 is handled. Duration 375 ms by bot id=8417097922
2025-12-15 22:15:05,671 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:15:05,672 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-15 22:15:05,673 - sqlalchemy.engine.Engine - INFO - [cached since 99.79s ago] (1, 'active')
2025-12-15 22:15:05,674 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 22:15:05,675 - sqlalchemy.engine.Engine - INFO - [cached since 99.79s ago] (8148367074,)
2025-12-15 22:15:05,676 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-15 22:15:05,677 - sqlalchemy.engine.Engine - INFO - [cached since 61.83s ago] (1,)
2025-12-15 22:15:05,761 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:15:05,762 - aiogram.event - INFO - Update id=558044362 is handled. Duration 94 ms by bot id=8417097922
2025-12-15 22:15:14,369 - aiogram.event - INFO - Update id=558044363 is not handled. Duration 0 ms by bot id=8417097922
2025-12-15 22:15:17,782 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:15:17,782 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 22:15:17,783 - sqlalchemy.engine.Engine - INFO - [cached since 111.9s ago] (8148367074,)
2025-12-15 22:15:17,887 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:15:17,887 - aiogram.event - INFO - Update id=558044364 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 22:15:18,958 - aiogram.event - INFO - Update id=558044365 is not handled. Duration 0 ms by bot id=8417097922
2025-12-15 22:15:22,457 - aiogram.event - INFO - Update id=558044366 is not handled. Duration 0 ms by bot id=8417097922
2025-12-15 22:15:23,891 - aiogram.event - INFO - Update id=558044367 is not handled. Duration 0 ms by bot id=8417097922
2025-12-15 22:15:26,936 - aiogram.event - INFO - Update id=558044368 is not handled. Duration 0 ms by bot id=8417097922
2025-12-15 22:18:35,834 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:18:35,834 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.created_at DESC
 LIMIT ? OFFSET ?
2025-12-15 22:18:35,835 - sqlalchemy.engine.Engine - INFO - [cached since 259s ago] (1, 20, 0)
2025-12-15 22:18:35,838 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-15 22:18:35,839 - sqlalchemy.engine.Engine - INFO - [cached since 272s ago] (1,)
2025-12-15 22:18:36,243 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:18:36,244 - aiogram.event - INFO - Update id=558044369 is handled. Duration 421 ms by bot id=8417097922
2025-12-15 22:18:39,063 - aiogram.event - INFO - Update id=558044370 is not handled. Duration 0 ms by bot id=8417097922
2025-12-15 22:18:40,507 - aiogram.event - INFO - Update id=558044371 is not handled. Duration 0 ms by bot id=8417097922
2025-12-15 22:19:37,945 - aiogram.dispatcher - INFO - Polling stopped
2025-12-15 22:19:38,207 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-15 22:19:39,932 - aiogram.dispatcher - INFO - Polling stopped for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 22:24:08,643 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:24:08,643 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 22:24:08,643 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:24:08,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 22:24:08,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:24:08,646 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 22:24:08,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:24:08,648 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 22:24:08,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:24:08,649 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 22:24:08,649 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:24:08,650 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:24:08,651 - __main__ - INFO - База данных инициализирована
2025-12-15 22:24:08,692 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:24:08,706 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-15 22:24:08,707 - sqlalchemy.engine.Engine - INFO - [generated in 0.00099s] ('active', '2025-12-15 19:24:08.690254')
2025-12-15 22:24:08,709 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-15 22:24:08,709 - utils.timer - INFO - Восстановлено 1 таймеров
2025-12-15 22:24:08,709 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:24:08,710 - __main__ - INFO - Планировщик таймеров запущен
2025-12-15 22:24:08,710 - __main__ - INFO - Бот запущен
2025-12-15 22:24:08,710 - aiogram.dispatcher - INFO - Start polling
2025-12-15 22:24:08,935 - aiogram.dispatcher - INFO - Run polling for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 22:24:13,031 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:24:13,032 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 22:24:13,033 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] (8148367074,)
2025-12-15 22:24:13,290 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:24:13,292 - aiogram.event - INFO - Update id=558044372 is handled. Duration 265 ms by bot id=8417097922
2025-12-15 22:24:15,165 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:24:15,167 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids JOIN auctions ON auctions.id = bids.auction_id JOIN users ON users.id = auctions.winner_id 
WHERE users.telegram_id = ? ORDER BY bids.created_at DESC
2025-12-15 22:24:15,168 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] (8417097922,)
2025-12-15 22:24:15,279 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:24:15,367 - aiogram.event - INFO - Update id=558044373 is handled. Duration 202 ms by bot id=8417097922
2025-12-15 22:24:16,822 - aiogram.event - INFO - Update id=558044374 is not handled. Duration 0 ms by bot id=8417097922
2025-12-15 22:24:16,822 - aiogram.event - ERROR - Cause exception while process update id=558044374 by bot id=8417097922
AttributeError: type object 'Auction' has no attribute 'ended_at'
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.2\handlers\user.py", line 139, in callback_my_wins
    await show_user_wins(callback.message)
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.2\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.2\handlers\user.py", line 149, in show_user_wins
    ).order_by(desc(Auction.ended_at))
                    ^^^^^^^^^^^^^^^^
AttributeError: type object 'Auction' has no attribute 'ended_at'
2025-12-15 22:24:21,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:24:21,204 - sqlalchemy.engine.Engine - INFO - SELECT notifications.id, notifications.user_id, notifications.auction_id, notifications.message, notifications.is_read, notifications.created_at 
FROM notifications JOIN users ON users.id = notifications.user_id 
WHERE users.telegram_id = ? ORDER BY notifications.created_at DESC
 LIMIT ? OFFSET ?
2025-12-15 22:24:21,204 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (8417097922, 20, 0)
2025-12-15 22:24:21,307 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:24:21,469 - aiogram.event - INFO - Update id=558044375 is handled. Duration 265 ms by bot id=8417097922
2025-12-15 22:24:23,805 - aiogram.event - INFO - Update id=558044376 is handled. Duration 469 ms by bot id=8417097922
2025-12-15 22:24:40,065 - aiogram.event - INFO - Update id=558044377 is handled. Duration 265 ms by bot id=8417097922
2025-12-15 22:24:41,750 - aiogram.event - INFO - Update id=558044378 is handled. Duration 186 ms by bot id=8417097922
2025-12-15 22:24:45,385 - aiogram.event - INFO - Update id=558044379 is handled. Duration 125 ms by bot id=8417097922
2025-12-15 22:24:48,388 - aiogram.event - INFO - Update id=558044380 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 22:24:54,756 - aiogram.event - INFO - Update id=558044381 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 22:24:57,685 - aiogram.event - INFO - Update id=558044382 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 22:25:00,207 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:25:00,209 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-15 22:25:00,209 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] ('qqqwe', 'aaaaaa', '["\\u041d\\u0435\\u0442 \\u0444\\u043e\\u0442\\u043e"]', 100.0, 250.0, 100.0, 'active', None, None, '2025-12-15 19:25:00.209535', '2025-12-15 19:25:00.209535', '2025-12-16 03:25:00.205534')
2025-12-15 22:25:00,211 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:25:00,218 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:25:00,219 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-15 22:25:00,220 - sqlalchemy.engine.Engine - INFO - [generated in 0.00090s] ('qqqwe', 1, 0)
2025-12-15 22:25:00,221 - handlers.admin - INFO - Аукцион создан с ID: 2
2025-12-15 22:25:00,222 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:25:00,222 - utils.timer - INFO - Таймер запущен для аукциона #2
2025-12-15 22:25:00,389 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:25:00,390 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-15 22:25:00,390 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (2,)
2025-12-15 22:25:00,394 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-15 22:25:00,394 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] (6, 2)
2025-12-15 22:25:00,395 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:25:00,529 - aiogram.event - INFO - Update id=558044383 is handled. Duration 328 ms by bot id=8417097922
2025-12-15 22:25:17,458 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:25:17,460 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-15 22:25:17,460 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] (2, 3, 0)
2025-12-15 22:25:17,710 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:25:17,711 - aiogram.event - INFO - Update id=558044384 is handled. Duration 265 ms by bot id=8417097922
2025-12-15 22:25:19,446 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:25:19,447 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.created_at DESC
 LIMIT ? OFFSET ?
2025-12-15 22:25:19,448 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (2, 20, 0)
2025-12-15 22:25:19,625 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:25:19,626 - aiogram.event - INFO - Update id=558044385 is handled. Duration 186 ms by bot id=8417097922
2025-12-15 22:25:21,965 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:25:21,966 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-15 22:25:21,967 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] (2, 'active')
2025-12-15 22:25:21,968 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 22:25:21,969 - sqlalchemy.engine.Engine - INFO - [cached since 68.94s ago] (8148367074,)
2025-12-15 22:25:21,970 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-15 22:25:21,971 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] (2,)
2025-12-15 22:25:21,973 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-15 22:25:21,973 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (350.0, '2025-12-15 19:25:21.972087', '2025-12-16 03:25:21.972087', 2)
2025-12-15 22:25:21,976 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-15 22:25:21,977 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] (2, 1, 350.0, '2025-12-15 19:25:21.976088')
2025-12-15 22:25:21,978 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:25:21,986 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:25:21,987 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-15 22:25:21,987 - sqlalchemy.engine.Engine - INFO - [cached since 4.527s ago] (2, 3, 0)
2025-12-15 22:25:21,990 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-15 22:25:21,990 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (1,)
2025-12-15 22:25:21,994 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-15 22:25:21,995 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] (2,)
2025-12-15 22:25:21,996 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-15 22:25:21,996 - sqlalchemy.engine.Engine - INFO - [cached since 21.61s ago] (2,)
2025-12-15 22:25:22,112 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:25:22,114 - handlers.auction - ERROR - Ошибка при обработке ставки: 'async for' requires an object with __aiter__ method, got _AsyncGeneratorContextManager
Traceback (most recent call last):
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.2\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.2\handlers\auction.py", line 135, in process_bid
    await send_subscription_notification(callback.bot, auction, user, amount)
  File "O:\CODE\TG BOTS\PIT AUC v0.2\utils\notifications.py", line 43, in send_subscription_notification
    async for session in get_db():
TypeError: 'async for' requires an object with __aiter__ method, got _AsyncGeneratorContextManager
2025-12-15 22:25:22,198 - aiogram.event - INFO - Update id=558044386 is handled. Duration 234 ms by bot id=8417097922
2025-12-15 22:25:26,577 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:25:26,577 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-15 22:25:26,578 - sqlalchemy.engine.Engine - INFO - [cached since 9.118s ago] (2, 3, 0)
2025-12-15 22:25:26,579 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-15 22:25:26,580 - sqlalchemy.engine.Engine - INFO - [cached since 4.59s ago] (1,)
2025-12-15 22:25:26,842 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:25:26,843 - aiogram.event - INFO - Update id=558044387 is handled. Duration 265 ms by bot id=8417097922
2025-12-15 22:25:28,722 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:25:28,723 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.created_at DESC
 LIMIT ? OFFSET ?
2025-12-15 22:25:28,723 - sqlalchemy.engine.Engine - INFO - [cached since 9.276s ago] (2, 20, 0)
2025-12-15 22:25:28,725 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-15 22:25:28,726 - sqlalchemy.engine.Engine - INFO - [cached since 6.736s ago] (1,)
2025-12-15 22:25:28,960 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:25:28,961 - aiogram.event - INFO - Update id=558044388 is handled. Duration 250 ms by bot id=8417097922
2025-12-15 22:26:06,019 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:26:06,019 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-15 22:26:06,020 - sqlalchemy.engine.Engine - INFO - [cached since 44.05s ago] (2, 'active')
2025-12-15 22:26:06,022 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-15 22:26:06,022 - sqlalchemy.engine.Engine - INFO - [cached since 113s ago] (8148367074,)
2025-12-15 22:26:06,023 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-15 22:26:06,023 - sqlalchemy.engine.Engine - INFO - [cached since 44.05s ago] (2,)
2025-12-15 22:26:06,265 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:26:06,266 - aiogram.event - INFO - Update id=558044389 is handled. Duration 250 ms by bot id=8417097922
2025-12-15 22:28:22,649 - aiogram.dispatcher - INFO - Polling stopped
2025-12-15 22:28:22,908 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-15 22:28:22,908 - utils.timer - INFO - Таймер для аукциона #2 отменен
2025-12-15 22:28:26,279 - aiogram.dispatcher - INFO - Polling stopped for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 22:34:42,367 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:34:42,367 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 22:34:42,368 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:34:42,369 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 22:34:42,369 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:34:42,370 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 22:34:42,370 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:34:42,371 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 22:34:42,371 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:34:42,372 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 22:34:42,372 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:34:42,373 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:34:42,374 - __main__ - INFO - База данных инициализирована
2025-12-15 22:34:42,439 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:34:42,452 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-15 22:34:42,452 - sqlalchemy.engine.Engine - INFO - [generated in 0.00074s] ('active', '2025-12-15 19:34:42.438116')
2025-12-15 22:34:42,454 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-15 22:34:42,455 - utils.timer - INFO - Таймер запущен для аукциона #2
2025-12-15 22:34:42,455 - utils.timer - INFO - Восстановлено 2 таймеров
2025-12-15 22:34:42,456 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:34:42,456 - __main__ - INFO - Планировщик таймеров запущен
2025-12-15 22:34:42,457 - __main__ - INFO - Бот запущен
2025-12-15 22:34:42,457 - aiogram.dispatcher - INFO - Start polling
2025-12-15 22:34:42,698 - aiogram.dispatcher - INFO - Run polling for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 22:34:50,283 - aiogram.event - INFO - Update id=558044390 is handled. Duration 282 ms by bot id=8417097922
2025-12-15 22:34:51,654 - aiogram.event - INFO - Update id=558044391 is handled. Duration 219 ms by bot id=8417097922
2025-12-15 22:34:53,890 - aiogram.event - INFO - Update id=558044392 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 22:34:55,693 - aiogram.event - INFO - Update id=558044393 is handled. Duration 140 ms by bot id=8417097922
2025-12-15 22:35:04,690 - aiogram.event - INFO - Update id=558044394 is handled. Duration 171 ms by bot id=8417097922
2025-12-15 22:35:07,214 - aiogram.event - INFO - Update id=558044395 is handled. Duration 140 ms by bot id=8417097922
2025-12-15 22:35:09,032 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:35:09,034 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-15 22:35:09,034 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] ('aaaa', 'qwwq', '["AgACAgIAAxkBAAOFaUBgholV4vG2-kBNTqhwAgHfkyEAApYOaxvfEgFKYrZsK2xYtX8BAAMCAAN4AAM2BA"]', 100.0, 324.0, 100.0, 'active', None, None, '2025-12-15 19:35:09.033891', '2025-12-15 19:35:09.033891', '2025-12-16 03:35:09.030891')
2025-12-15 22:35:09,036 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:35:09,043 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:35:09,044 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-15 22:35:09,045 - sqlalchemy.engine.Engine - INFO - [generated in 0.00084s] ('aaaa', 1, 0)
2025-12-15 22:35:09,046 - handlers.admin - INFO - Аукцион создан с ID: 3
2025-12-15 22:35:09,047 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:35:09,047 - utils.timer - INFO - Таймер запущен для аукциона #3
2025-12-15 22:35:09,048 - handlers.admin - ERROR - Ошибка публикации в канал: get_channel_auction_keyboard() takes 1 positional argument but 2 were given
2025-12-15 22:35:09,158 - aiogram.event - INFO - Update id=558044396 is handled. Duration 125 ms by bot id=8417097922
2025-12-15 22:35:33,364 - aiogram.event - INFO - Update id=558044397 is handled. Duration 266 ms by bot id=8417097922
2025-12-15 22:35:34,701 - aiogram.event - INFO - Update id=558044398 is handled. Duration 203 ms by bot id=8417097922
2025-12-15 22:35:36,410 - aiogram.event - INFO - Update id=558044399 is handled. Duration 125 ms by bot id=8417097922
2025-12-15 22:35:37,614 - aiogram.event - INFO - Update id=558044400 is handled. Duration 94 ms by bot id=8417097922
2025-12-15 22:35:39,815 - aiogram.event - INFO - Update id=558044401 is handled. Duration 94 ms by bot id=8417097922
2025-12-15 22:35:41,825 - aiogram.event - INFO - Update id=558044402 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 22:35:43,301 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:35:43,302 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-15 22:35:43,302 - sqlalchemy.engine.Engine - INFO - [cached since 34.27s ago] ('asad', 'asdasg', '[]', 100.0, 399.0, 100.0, 'active', None, None, '2025-12-15 19:35:43.302860', '2025-12-15 19:35:43.302860', '2025-12-16 03:35:43.300861')
2025-12-15 22:35:43,305 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:35:43,312 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:35:43,312 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-15 22:35:43,313 - sqlalchemy.engine.Engine - INFO - [cached since 34.27s ago] ('asad', 1, 0)
2025-12-15 22:35:43,314 - handlers.admin - INFO - Аукцион создан с ID: 4
2025-12-15 22:35:43,314 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:35:43,315 - utils.timer - INFO - Таймер запущен для аукциона #4
2025-12-15 22:35:43,317 - handlers.admin - ERROR - Ошибка публикации в канал: get_channel_auction_keyboard() takes 1 positional argument but 2 were given
2025-12-15 22:35:43,539 - aiogram.event - INFO - Update id=558044403 is handled. Duration 250 ms by bot id=8417097922
2025-12-15 22:36:25,230 - aiogram.dispatcher - INFO - Polling stopped
2025-12-15 22:36:25,488 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-15 22:36:25,488 - utils.timer - INFO - Таймер для аукциона #2 отменен
2025-12-15 22:36:25,488 - utils.timer - INFO - Таймер для аукциона #3 отменен
2025-12-15 22:36:25,489 - utils.timer - INFO - Таймер для аукциона #4 отменен
2025-12-15 22:36:26,700 - aiogram.dispatcher - INFO - Polling stopped for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 22:39:56,845 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:39:56,846 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-15 22:39:56,846 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:39:56,847 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-15 22:39:56,847 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:39:56,848 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-15 22:39:56,848 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:39:56,849 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-15 22:39:56,849 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:39:56,850 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-15 22:39:56,850 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-15 22:39:56,851 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:39:56,852 - __main__ - INFO - База данных инициализирована
2025-12-15 22:39:56,917 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:39:56,932 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-15 22:39:56,932 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] ('active', '2025-12-15 19:39:56.916304')
2025-12-15 22:39:56,934 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-15 22:39:56,934 - utils.timer - INFO - Таймер запущен для аукциона #2
2025-12-15 22:39:56,934 - utils.timer - INFO - Таймер запущен для аукциона #3
2025-12-15 22:39:56,934 - utils.timer - INFO - Таймер запущен для аукциона #4
2025-12-15 22:39:56,935 - utils.timer - INFO - Восстановлено 4 таймеров
2025-12-15 22:39:56,935 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:39:56,936 - __main__ - INFO - Планировщик таймеров запущен
2025-12-15 22:39:56,936 - __main__ - INFO - Бот запущен
2025-12-15 22:39:56,936 - aiogram.dispatcher - INFO - Start polling
2025-12-15 22:39:57,170 - aiogram.dispatcher - INFO - Run polling for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-15 22:40:04,392 - aiogram.event - INFO - Update id=558044404 is handled. Duration 266 ms by bot id=8417097922
2025-12-15 22:40:05,480 - aiogram.event - INFO - Update id=558044405 is handled. Duration 203 ms by bot id=8417097922
2025-12-15 22:40:07,944 - aiogram.event - INFO - Update id=558044406 is handled. Duration 140 ms by bot id=8417097922
2025-12-15 22:40:10,192 - aiogram.event - INFO - Update id=558044407 is handled. Duration 109 ms by bot id=8417097922
2025-12-15 22:40:15,868 - aiogram.event - INFO - Update id=558044408 is handled. Duration 108 ms by bot id=8417097922
2025-12-15 22:40:18,345 - aiogram.event - INFO - Update id=558044409 is handled. Duration 108 ms by bot id=8417097922
2025-12-15 22:40:20,436 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:40:20,437 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-15 22:40:20,438 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] ('aaaa', 'www', '["AgACAgIAAxkBAAOFaUBgholV4vG2-kBNTqhwAgHfkyEAApYOaxvfEgFKYrZsK2xYtX8BAAMCAAN4AAM2BA"]', 100.0, 356.0, 100.0, 'active', None, None, '2025-12-15 19:40:20.437603', '2025-12-15 19:40:20.437603', '2025-12-16 03:40:20.434602')
2025-12-15 22:40:20,440 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-15 22:40:20,449 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-15 22:40:20,450 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-15 22:40:20,450 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ('aaaa', 1, 0)
2025-12-15 22:40:20,452 - handlers.admin - INFO - Аукцион создан с ID: 5
2025-12-15 22:40:20,452 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-15 22:40:20,452 - utils.timer - INFO - Таймер запущен для аукциона #5
2025-12-15 22:40:20,453 - handlers.admin - ERROR - Ошибка публикации в канал: get_channel_auction_keyboard() takes 1 positional argument but 2 were given
2025-12-15 22:40:20,549 - aiogram.event - INFO - Update id=558044410 is handled. Duration 109 ms by bot id=8417097922
2025-12-16 07:11:58,179 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:11:58,179 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 07:11:58,180 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:11:58,181 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-12-16 07:11:58,181 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:11:58,181 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 07:11:58,182 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:11:58,182 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-16 07:11:58,183 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:11:58,183 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 07:11:58,184 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:11:58,184 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-16 07:11:58,185 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:11:58,188 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 07:11:58,188 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:11:58,189 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-16 07:11:58,190 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:11:58,191 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 07:11:58,191 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:11:58,192 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-16 07:11:58,192 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:11:58,194 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	username VARCHAR(100), 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	phone VARCHAR(20), 
	is_confirmed BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id)
)


2025-12-16 07:11:58,195 - sqlalchemy.engine.Engine - INFO - [no key 0.00153s] ()
2025-12-16 07:11:58,203 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_is_confirmed ON users (is_confirmed)
2025-12-16 07:11:58,204 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-12-16 07:11:58,209 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auctions (
	id INTEGER NOT NULL, 
	title VARCHAR(255) NOT NULL, 
	description TEXT, 
	photos TEXT, 
	start_price FLOAT NOT NULL, 
	step_price FLOAT NOT NULL, 
	current_price FLOAT NOT NULL, 
	status VARCHAR(20), 
	winner_id INTEGER, 
	channel_message_id INTEGER, 
	last_bid_time DATETIME, 
	created_at DATETIME, 
	ends_at DATETIME, 
	ended_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(winner_id) REFERENCES users (id)
)


2025-12-16 07:11:58,211 - sqlalchemy.engine.Engine - INFO - [no key 0.00154s] ()
2025-12-16 07:11:58,215 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_status ON auctions (status)
2025-12-16 07:11:58,216 - sqlalchemy.engine.Engine - INFO - [no key 0.00037s] ()
2025-12-16 07:11:58,221 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_ends_at ON auctions (ends_at)
2025-12-16 07:11:58,221 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-12-16 07:11:58,226 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_created_at ON auctions (created_at)
2025-12-16 07:11:58,227 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-12-16 07:11:58,231 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_last_bid_time ON auctions (last_bid_time)
2025-12-16 07:11:58,231 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-12-16 07:11:58,236 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_title ON auctions (title)
2025-12-16 07:11:58,237 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-12-16 07:11:58,241 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE bids (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	amount FLOAT NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-16 07:11:58,242 - sqlalchemy.engine.Engine - INFO - [no key 0.00126s] ()
2025-12-16 07:11:58,247 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_auction_user ON bids (auction_id, user_id)
2025-12-16 07:11:58,248 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-12-16 07:11:58,252 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_created_at ON bids (created_at)
2025-12-16 07:11:58,252 - sqlalchemy.engine.Engine - INFO - [no key 0.00049s] ()
2025-12-16 07:11:58,257 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_amount ON bids (amount)
2025-12-16 07:11:58,258 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-12-16 07:11:58,262 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auction_subscriptions (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-16 07:11:58,264 - sqlalchemy.engine.Engine - INFO - [no key 0.00127s] ()
2025-12-16 07:11:58,269 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_subscriptions_auction_user ON auction_subscriptions (auction_id, user_id)
2025-12-16 07:11:58,269 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-12-16 07:11:58,274 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE notifications (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	message TEXT NOT NULL, 
	is_read BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id)
)


2025-12-16 07:11:58,275 - sqlalchemy.engine.Engine - INFO - [no key 0.00139s] ()
2025-12-16 07:11:58,280 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_user_read ON notifications (user_id, is_read)
2025-12-16 07:11:58,281 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-12-16 07:11:58,286 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_created_at ON notifications (created_at)
2025-12-16 07:11:58,286 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-12-16 07:11:58,291 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:11:58,292 - __main__ - INFO - База данных инициализирована
2025-12-16 07:11:58,343 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:11:58,357 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 07:11:58,357 - sqlalchemy.engine.Engine - INFO - [generated in 0.00078s] ('active', '2025-12-16 04:11:58.342502')
2025-12-16 07:11:58,360 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 07:11:58,360 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] ('active', '2025-12-16 04:11:58.359507')
2025-12-16 07:11:58,361 - utils.timer - INFO - Восстановлено 0 таймеров, завершено 0 аукционов
2025-12-16 07:11:58,362 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 07:11:58,362 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 07:11:58,363 - __main__ - INFO - Бот запущен
2025-12-16 07:11:58,363 - aiogram.dispatcher - INFO - Start polling
2025-12-16 07:11:58,607 - aiogram.dispatcher - INFO - Run polling for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-16 07:12:05,016 - aiogram.event - INFO - Update id=558044412 is handled. Duration 266 ms by bot id=8417097922
2025-12-16 07:12:06,463 - aiogram.event - INFO - Update id=558044413 is handled. Duration 186 ms by bot id=8417097922
2025-12-16 07:12:11,626 - aiogram.event - INFO - Update id=558044414 is handled. Duration 92 ms by bot id=8417097922
2025-12-16 07:12:16,811 - aiogram.event - INFO - Update id=558044415 is handled. Duration 125 ms by bot id=8417097922
2025-12-16 07:12:29,300 - aiogram.event - INFO - Update id=558044416 is handled. Duration 94 ms by bot id=8417097922
2025-12-16 07:12:31,792 - aiogram.event - INFO - Update id=558044417 is handled. Duration 186 ms by bot id=8417097922
2025-12-16 07:12:33,859 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:12:33,860 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at, ended_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-16 07:12:33,861 - sqlalchemy.engine.Engine - INFO - [generated in 0.00074s] ('PIT', 'gaq', '["AgACAgIAAxkBAAO5aUDcLT_xg0ZpJXRk65JVli8QTMMAAiQQaxvfEgFKcmwWgRdKkjYBAAMCAANtAAM2BA"]', 100.0, 100.0, 100.0, 'active', None, None, '2025-12-16 04:12:33.860266', '2025-12-16 04:12:33.860266', '2025-12-16 12:12:33.857266', None)
2025-12-16 07:12:33,863 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:12:33,870 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:12:33,872 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 07:12:33,872 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] ('PIT', 1, 0)
2025-12-16 07:12:33,874 - handlers.admin - INFO - Аукцион создан с ID: 1
2025-12-16 07:12:33,874 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 07:12:33,875 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 07:12:34,058 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:12:34,059 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 07:12:34,059 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] (1,)
2025-12-16 07:12:34,061 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-16 07:12:34,062 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] (9, 1)
2025-12-16 07:12:34,063 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:12:34,177 - aiogram.event - INFO - Update id=558044418 is handled. Duration 311 ms by bot id=8417097922
2025-12-16 07:13:12,231 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:13:12,232 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 07:13:12,232 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (1, 'active')
2025-12-16 07:13:12,234 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 07:13:12,235 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] (8148367074,)
2025-12-16 07:13:12,457 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:13:12,458 - aiogram.event - INFO - Update id=558044419 is handled. Duration 217 ms by bot id=8417097922
2025-12-16 07:13:19,020 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:13:19,021 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 07:13:19,021 - sqlalchemy.engine.Engine - INFO - [cached since 6.786s ago] (8148367074,)
2025-12-16 07:13:19,023 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (telegram_id, username, first_name, last_name, phone, is_confirmed, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-12-16 07:13:19,024 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] (8148367074, 'ammuniti0n', 'dark triad', None, None, 0, '2025-12-16 04:13:19.023219')
2025-12-16 07:13:19,025 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:13:19,121 - aiogram.event - INFO - Update id=558044420 is handled. Duration 108 ms by bot id=8417097922
2025-12-16 07:13:20,802 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:13:20,802 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 07:13:20,802 - sqlalchemy.engine.Engine - INFO - [cached since 8.568s ago] (8148367074,)
2025-12-16 07:13:20,805 - sqlalchemy.engine.Engine - INFO - UPDATE users SET is_confirmed=? WHERE users.id = ?
2025-12-16 07:13:20,806 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] (1, 1)
2025-12-16 07:13:20,807 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:13:20,995 - aiogram.event - INFO - Update id=558044421 is handled. Duration 202 ms by bot id=8417097922
2025-12-16 07:13:33,811 - aiogram.event - INFO - Update id=558044422 is not handled. Duration 0 ms by bot id=8417097922
2025-12-16 07:15:08,644 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:15:08,644 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 07:15:08,645 - sqlalchemy.engine.Engine - INFO - [cached since 116.4s ago] (8148367074,)
2025-12-16 07:15:08,952 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 07:15:08,953 - aiogram.event - INFO - Update id=558044423 is handled. Duration 311 ms by bot id=8417097922
2025-12-16 07:16:55,425 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:16:55,426 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 07:16:55,426 - sqlalchemy.engine.Engine - INFO - [cached since 223.2s ago] (941971937,)
2025-12-16 07:16:55,428 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (telegram_id, username, first_name, last_name, phone, is_confirmed, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-12-16 07:16:55,428 - sqlalchemy.engine.Engine - INFO - [cached since 216.4s ago] (941971937, 'pd56oren', 'Рафаэль', None, None, 0, '2025-12-16 04:16:55.428966')
2025-12-16 07:16:55,430 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:16:55,675 - aiogram.event - INFO - Update id=558044424 is handled. Duration 250 ms by bot id=8417097922
2025-12-16 07:16:57,995 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:16:57,996 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 07:16:57,996 - sqlalchemy.engine.Engine - INFO - [cached since 225.8s ago] (941971937,)
2025-12-16 07:16:57,998 - sqlalchemy.engine.Engine - INFO - UPDATE users SET is_confirmed=? WHERE users.id = ?
2025-12-16 07:16:57,998 - sqlalchemy.engine.Engine - INFO - [cached since 217.2s ago] (1, 2)
2025-12-16 07:16:57,999 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:16:58,292 - aiogram.event - INFO - Update id=558044425 is handled. Duration 297 ms by bot id=8417097922
2025-12-16 07:17:15,084 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:17:15,085 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 07:17:15,085 - sqlalchemy.engine.Engine - INFO - [cached since 242.9s ago] (1, 'active')
2025-12-16 07:17:15,086 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 07:17:15,087 - sqlalchemy.engine.Engine - INFO - [cached since 242.9s ago] (941971937,)
2025-12-16 07:17:15,089 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 07:17:15,089 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] (1,)
2025-12-16 07:17:15,091 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 07:17:15,092 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] (200.0, '2025-12-16 04:17:15.090394', '2025-12-16 12:17:15.090394', 1)
2025-12-16 07:17:15,094 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 07:17:15,094 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] (1, 2, 200.0, '2025-12-16 04:17:15.094394')
2025-12-16 07:17:15,095 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:17:15,104 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:17:15,105 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 07:17:15,106 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] (1, 3, 0)
2025-12-16 07:17:15,109 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 07:17:15,109 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] (2,)
2025-12-16 07:17:15,112 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 07:17:15,112 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] (1,)
2025-12-16 07:17:15,125 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 07:17:15,125 - sqlalchemy.engine.Engine - INFO - [cached since 281.1s ago] (1,)
2025-12-16 07:17:15,379 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:17:15,380 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 07:17:15,380 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] (1, 2)
2025-12-16 07:17:15,382 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:17:15,383 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 07:17:15,470 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:17:15,476 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 07:17:15,590 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 07:17:15,674 - aiogram.event - INFO - Update id=558044426 is handled. Duration 594 ms by bot id=8417097922
2025-12-16 07:17:36,740 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:17:36,741 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids JOIN auctions ON auctions.id = bids.auction_id JOIN users ON users.id = auctions.winner_id 
WHERE users.telegram_id = ? ORDER BY bids.created_at DESC
2025-12-16 07:17:36,742 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] (8417097922,)
2025-12-16 07:17:36,984 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 07:17:37,063 - aiogram.event - INFO - Update id=558044427 is handled. Duration 327 ms by bot id=8417097922
2025-12-16 07:17:49,490 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:17:49,491 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 07:17:49,491 - sqlalchemy.engine.Engine - INFO - [cached since 277.3s ago] (8148367074,)
2025-12-16 07:17:49,713 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 07:17:49,714 - aiogram.event - INFO - Update id=558044428 is handled. Duration 233 ms by bot id=8417097922
2025-12-16 07:18:39,220 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 07:18:39,480 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 07:18:39,480 - aiogram.dispatcher - INFO - Polling stopped for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-16 07:18:39,480 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 07:18:49,695 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:18:49,696 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 07:18:49,696 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:18:49,698 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 07:18:49,698 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:18:49,699 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 07:18:49,699 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:18:49,700 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 07:18:49,700 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:18:49,701 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 07:18:49,701 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 07:18:49,702 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:18:49,702 - __main__ - INFO - База данных инициализирована
2025-12-16 07:18:49,732 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:18:49,746 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 07:18:49,747 - sqlalchemy.engine.Engine - INFO - [generated in 0.00084s] ('active', '2025-12-16 04:18:49.731349')
2025-12-16 07:18:49,749 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 07:18:49,750 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 07:18:49,751 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] ('active', '2025-12-16 04:18:49.749353')
2025-12-16 07:18:49,752 - utils.timer - INFO - Восстановлено 1 таймеров, завершено 0 аукционов
2025-12-16 07:18:49,752 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 07:18:49,753 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 07:18:49,753 - __main__ - INFO - Бот запущен
2025-12-16 07:18:49,753 - aiogram.dispatcher - INFO - Start polling
2025-12-16 07:18:50,068 - aiogram.dispatcher - INFO - Run polling for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-16 07:18:56,902 - aiogram.event - INFO - Update id=558044429 is handled. Duration 250 ms by bot id=8417097922
2025-12-16 07:19:33,363 - aiogram.event - INFO - Update id=558044430 is not handled. Duration 0 ms by bot id=8417097922
2025-12-16 07:19:37,789 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:19:37,790 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions
2025-12-16 07:19:37,791 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] ()
2025-12-16 07:19:37,793 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 07:19:37,793 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] ('active',)
2025-12-16 07:19:37,794 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 07:19:37,794 - sqlalchemy.engine.Engine - INFO - [cached since 0.001893s ago] ('ended',)
2025-12-16 07:19:37,796 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users
2025-12-16 07:19:37,797 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] ()
2025-12-16 07:19:37,798 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users 
WHERE users.is_confirmed = 1
2025-12-16 07:19:37,798 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] ()
2025-12-16 07:19:37,800 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids
2025-12-16 07:19:37,800 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] ()
2025-12-16 07:19:37,802 - sqlalchemy.engine.Engine - INFO - SELECT sum(auctions.current_price) AS sum_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 07:19:37,802 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] ('ended',)
2025-12-16 07:19:38,237 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 07:19:38,238 - aiogram.event - INFO - Update id=558044431 is handled. Duration 453 ms by bot id=8417097922
2025-12-16 07:19:49,228 - aiogram.event - INFO - Update id=558044432 is not handled. Duration 0 ms by bot id=8417097922
2025-12-16 07:19:52,442 - aiogram.event - INFO - Update id=558044433 is not handled. Duration 0 ms by bot id=8417097922
2025-12-16 07:19:53,632 - aiogram.event - INFO - Update id=558044434 is not handled. Duration 16 ms by bot id=8417097922
2025-12-16 07:19:58,053 - aiogram.event - INFO - Update id=558044435 is not handled. Duration 15 ms by bot id=8417097922
2025-12-16 07:20:00,038 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:20:00,039 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 07:20:00,040 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] ('active',)
2025-12-16 07:20:00,053 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 07:20:00,054 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] (1,)
2025-12-16 07:20:00,379 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 07:20:00,380 - aiogram.event - INFO - Update id=558044436 is handled. Duration 342 ms by bot id=8417097922
2025-12-16 07:24:43,885 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:24:43,886 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 07:24:43,886 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (1, 'active')
2025-12-16 07:24:43,889 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 07:24:43,889 - sqlalchemy.engine.Engine - INFO - [generated in 0.00078s] (8148367074,)
2025-12-16 07:24:43,892 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 07:24:43,892 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] (1,)
2025-12-16 07:24:43,897 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 07:24:43,897 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] (300.0, '2025-12-16 04:24:43.894067', '2025-12-16 12:24:43.894067', 1)
2025-12-16 07:24:43,901 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 07:24:43,902 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (1, 1, 300.0, '2025-12-16 04:24:43.901069')
2025-12-16 07:24:43,903 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:24:43,911 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:24:43,913 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 07:24:43,914 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] (1, 3, 0)
2025-12-16 07:24:43,917 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?, ?)
2025-12-16 07:24:43,918 - sqlalchemy.engine.Engine - INFO - [generated in 0.00146s] (1, 2)
2025-12-16 07:24:43,931 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 07:24:43,932 - sqlalchemy.engine.Engine - INFO - [cached since 283.9s ago] (1,)
2025-12-16 07:24:43,933 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 07:24:43,934 - sqlalchemy.engine.Engine - INFO - [generated in 0.00074s] (1,)
2025-12-16 07:24:44,227 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.id = ?
2025-12-16 07:24:44,228 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (2,)
2025-12-16 07:24:44,363 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:24:44,364 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 07:24:44,375 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:24:44,382 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:24:44,384 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 07:24:44,385 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] (1, 1)
2025-12-16 07:24:44,386 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:24:44,387 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 07:24:44,393 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:24:44,397 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 07:24:44,510 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 07:24:44,599 - aiogram.event - INFO - Update id=558044437 is handled. Duration 702 ms by bot id=8417097922
2025-12-16 07:24:50,380 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:24:50,380 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 07:24:50,381 - sqlalchemy.engine.Engine - INFO - [cached since 6.493s ago] (8148367074,)
2025-12-16 07:24:50,382 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id = ?
2025-12-16 07:24:50,383 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] (1, 1)
2025-12-16 07:24:50,385 - sqlalchemy.engine.Engine - INFO - INSERT INTO auction_subscriptions (auction_id, user_id, created_at) VALUES (?, ?, ?)
2025-12-16 07:24:50,385 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] (1, 1, '2025-12-16 04:24:50.385675')
2025-12-16 07:24:50,387 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 07:24:50,474 - aiogram.event - INFO - Update id=558044438 is handled. Duration 110 ms by bot id=8417097922
2025-12-16 07:25:31,217 - aiogram.event - INFO - Update id=558044439 is handled. Duration 233 ms by bot id=8417097922
2025-12-16 07:29:24,207 - aiogram.event - INFO - Update id=558044440 is handled. Duration 265 ms by bot id=8417097922
2025-12-16 07:29:33,521 - aiogram.event - INFO - Update id=558044441 is handled. Duration 219 ms by bot id=8417097922
2025-12-16 07:30:47,747 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:30:47,748 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 07:30:47,748 - sqlalchemy.engine.Engine - INFO - [cached since 363.9s ago] (1, 'active')
2025-12-16 07:30:47,750 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 07:30:47,750 - sqlalchemy.engine.Engine - INFO - [cached since 363.9s ago] (8148367074,)
2025-12-16 07:30:47,751 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 07:30:47,752 - sqlalchemy.engine.Engine - INFO - [cached since 363.9s ago] (1,)
2025-12-16 07:30:47,753 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 07:30:47,754 - handlers.auction - ERROR - Ошибка при обработке ставки: Multiple rows were found when one or none was required
Traceback (most recent call last):
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\auction.py", line 78, in process_bid
    last_bid = result_last_bid.scalar_one_or_none()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 1499, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 810, in _only_one_row
    raise exc.MultipleResultsFound(
sqlalchemy.exc.MultipleResultsFound: Multiple rows were found when one or none was required
2025-12-16 07:30:47,981 - aiogram.event - INFO - Update id=558044442 is handled. Duration 235 ms by bot id=8417097922
2025-12-16 07:30:52,426 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 07:30:52,426 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 07:30:52,427 - sqlalchemy.engine.Engine - INFO - [cached since 368.5s ago] (1, 'active')
2025-12-16 07:30:52,428 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 07:30:52,429 - sqlalchemy.engine.Engine - INFO - [cached since 368.5s ago] (8148367074,)
2025-12-16 07:30:52,430 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 07:30:52,430 - sqlalchemy.engine.Engine - INFO - [cached since 368.5s ago] (1,)
2025-12-16 07:30:52,431 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 07:30:52,432 - handlers.auction - ERROR - Ошибка при обработке ставки: Multiple rows were found when one or none was required
Traceback (most recent call last):
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\auction.py", line 78, in process_bid
    last_bid = result_last_bid.scalar_one_or_none()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 1499, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 810, in _only_one_row
    raise exc.MultipleResultsFound(
sqlalchemy.exc.MultipleResultsFound: Multiple rows were found when one or none was required
2025-12-16 07:30:52,598 - aiogram.event - INFO - Update id=558044443 is handled. Duration 171 ms by bot id=8417097922
2025-12-16 07:32:12,249 - aiogram.event - INFO - Update id=558044444 is not handled. Duration 0 ms by bot id=8417097922
2025-12-16 07:35:58,527 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 07:35:58,781 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 07:35:58,781 - aiogram.dispatcher - INFO - Polling stopped for bot @safbasfasv_bot id=8417097922 - 'aucbottest'
2025-12-16 07:35:58,781 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 18:33:54,415 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:33:54,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 18:33:54,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:33:54,418 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-12-16 18:33:54,418 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:33:54,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 18:33:54,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:33:54,420 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-16 18:33:54,421 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:33:54,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 18:33:54,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:33:54,424 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-16 18:33:54,424 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:33:54,425 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 18:33:54,426 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:33:54,427 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-16 18:33:54,427 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:33:54,429 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 18:33:54,429 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:33:54,431 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-16 18:33:54,431 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:33:54,433 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	username VARCHAR(100), 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	phone VARCHAR(20), 
	is_confirmed BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id)
)


2025-12-16 18:33:54,435 - sqlalchemy.engine.Engine - INFO - [no key 0.00222s] ()
2025-12-16 18:33:54,443 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_is_confirmed ON users (is_confirmed)
2025-12-16 18:33:54,443 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-12-16 18:33:54,449 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auctions (
	id INTEGER NOT NULL, 
	title VARCHAR(255) NOT NULL, 
	description TEXT, 
	photos TEXT, 
	start_price FLOAT NOT NULL, 
	step_price FLOAT NOT NULL, 
	current_price FLOAT NOT NULL, 
	status VARCHAR(20), 
	winner_id INTEGER, 
	channel_message_id INTEGER, 
	last_bid_time DATETIME, 
	created_at DATETIME, 
	ends_at DATETIME, 
	ended_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(winner_id) REFERENCES users (id)
)


2025-12-16 18:33:54,452 - sqlalchemy.engine.Engine - INFO - [no key 0.00236s] ()
2025-12-16 18:33:54,456 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_created_at ON auctions (created_at)
2025-12-16 18:33:54,457 - sqlalchemy.engine.Engine - INFO - [no key 0.00053s] ()
2025-12-16 18:33:54,463 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_status ON auctions (status)
2025-12-16 18:33:54,463 - sqlalchemy.engine.Engine - INFO - [no key 0.00050s] ()
2025-12-16 18:33:54,469 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_ends_at ON auctions (ends_at)
2025-12-16 18:33:54,469 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-12-16 18:33:54,475 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_last_bid_time ON auctions (last_bid_time)
2025-12-16 18:33:54,475 - sqlalchemy.engine.Engine - INFO - [no key 0.00049s] ()
2025-12-16 18:33:54,480 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_title ON auctions (title)
2025-12-16 18:33:54,480 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-12-16 18:33:54,486 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE bids (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	amount FLOAT NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-16 18:33:54,488 - sqlalchemy.engine.Engine - INFO - [no key 0.00134s] ()
2025-12-16 18:33:54,492 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_amount ON bids (amount)
2025-12-16 18:33:54,492 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-12-16 18:33:54,498 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_created_at ON bids (created_at)
2025-12-16 18:33:54,498 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-12-16 18:33:54,504 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_auction_user ON bids (auction_id, user_id)
2025-12-16 18:33:54,505 - sqlalchemy.engine.Engine - INFO - [no key 0.00051s] ()
2025-12-16 18:33:54,511 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auction_subscriptions (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-16 18:33:54,512 - sqlalchemy.engine.Engine - INFO - [no key 0.00186s] ()
2025-12-16 18:33:54,517 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_subscriptions_auction_user ON auction_subscriptions (auction_id, user_id)
2025-12-16 18:33:54,517 - sqlalchemy.engine.Engine - INFO - [no key 0.00060s] ()
2025-12-16 18:33:54,524 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE notifications (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	message TEXT NOT NULL, 
	is_read BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id)
)


2025-12-16 18:33:54,525 - sqlalchemy.engine.Engine - INFO - [no key 0.00116s] ()
2025-12-16 18:33:54,530 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_created_at ON notifications (created_at)
2025-12-16 18:33:54,530 - sqlalchemy.engine.Engine - INFO - [no key 0.00049s] ()
2025-12-16 18:33:54,536 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_user_read ON notifications (user_id, is_read)
2025-12-16 18:33:54,537 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-12-16 18:33:54,541 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:33:54,542 - __main__ - INFO - База данных инициализирована
2025-12-16 18:33:54,542 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 18:33:54,543 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_183354.db
2025-12-16 18:33:54,544 - __main__ - INFO - Резервная копия создана
2025-12-16 18:33:54,674 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:33:54,692 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 18:33:54,693 - sqlalchemy.engine.Engine - INFO - [generated in 0.00106s] ('active', '2025-12-16 15:33:54.673665')
2025-12-16 18:33:54,697 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 18:33:54,698 - sqlalchemy.engine.Engine - INFO - [generated in 0.00092s] ('active', '2025-12-16 15:33:54.696671')
2025-12-16 18:33:54,699 - utils.timer - INFO - Восстановлено 0 таймеров, завершено 0 аукционов
2025-12-16 18:33:54,699 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:33:54,700 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 18:33:54,700 - __main__ - INFO - Бот запущен
2025-12-16 18:33:54,701 - aiogram.dispatcher - INFO - Start polling
2025-12-16 18:33:58,021 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 18:34:09,764 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:34:09,765 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:34:09,766 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] (8148367074,)
2025-12-16 18:34:09,769 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (telegram_id, username, first_name, last_name, phone, is_confirmed, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-12-16 18:34:09,769 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (8148367074, 'ammuniti0n', 'dark triad', None, None, 0, '2025-12-16 15:34:09.769023')
2025-12-16 18:34:09,772 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:34:09,779 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:34:09,780 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:34:09,780 - sqlalchemy.engine.Engine - INFO - [cached since 0.01506s ago] (8148367074,)
2025-12-16 18:34:10,057 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:34:10,058 - aiogram.event - INFO - Update id=188256725 is handled. Duration 296 ms by bot id=8561542425
2025-12-16 18:34:11,699 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:34:11,699 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:34:11,700 - sqlalchemy.engine.Engine - INFO - [cached since 1.936s ago] (8148367074,)
2025-12-16 18:34:11,701 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:34:11,703 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:34:11,703 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:34:11,703 - sqlalchemy.engine.Engine - INFO - [cached since 1.939s ago] (8148367074,)
2025-12-16 18:34:11,706 - sqlalchemy.engine.Engine - INFO - UPDATE users SET is_confirmed=? WHERE users.id = ?
2025-12-16 18:34:11,706 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (1, 1)
2025-12-16 18:34:11,708 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:34:11,916 - aiogram.event - INFO - Update id=188256726 is handled. Duration 219 ms by bot id=8561542425
2025-12-16 18:37:09,852 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 18:37:10,105 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_183710.db
2025-12-16 18:37:10,106 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 18:37:10,106 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 18:37:16,613 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:37:16,613 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 18:37:16,614 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:37:16,615 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 18:37:16,615 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:37:16,616 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 18:37:16,616 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:37:16,617 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 18:37:16,617 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:37:16,618 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 18:37:16,618 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:37:16,619 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:37:16,620 - __main__ - INFO - База данных инициализирована
2025-12-16 18:37:16,620 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 18:37:16,621 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_183716.db
2025-12-16 18:37:16,621 - __main__ - INFO - Резервная копия создана
2025-12-16 18:37:16,660 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:37:16,673 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 18:37:16,674 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] ('active', '2025-12-16 15:37:16.659571')
2025-12-16 18:37:16,676 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 18:37:16,677 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] ('active', '2025-12-16 15:37:16.676575')
2025-12-16 18:37:16,678 - utils.timer - INFO - Восстановлено 0 таймеров, завершено 0 аукционов
2025-12-16 18:37:16,678 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:37:16,679 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 18:37:16,679 - __main__ - INFO - Бот запущен
2025-12-16 18:37:16,680 - aiogram.dispatcher - INFO - Start polling
2025-12-16 18:37:16,987 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 18:37:20,045 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:37:20,046 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:37:20,047 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (8148367074,)
2025-12-16 18:37:20,048 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:37:20,050 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:37:20,050 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:37:20,051 - sqlalchemy.engine.Engine - INFO - [cached since 0.004905s ago] (8148367074,)
2025-12-16 18:37:20,326 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:37:20,327 - aiogram.event - INFO - Update id=188256727 is handled. Duration 280 ms by bot id=8561542425
2025-12-16 18:37:35,124 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 18:37:35,377 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_183735.db
2025-12-16 18:37:35,377 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 18:37:35,378 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 18:37:41,523 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:37:41,524 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 18:37:41,524 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:37:41,525 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 18:37:41,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:37:41,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 18:37:41,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:37:41,527 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 18:37:41,528 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:37:41,529 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 18:37:41,529 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:37:41,530 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:37:41,531 - __main__ - INFO - База данных инициализирована
2025-12-16 18:37:41,531 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 18:37:41,532 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_183741.db
2025-12-16 18:37:41,533 - __main__ - INFO - Резервная копия создана
2025-12-16 18:37:41,569 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:37:41,583 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 18:37:41,584 - sqlalchemy.engine.Engine - INFO - [generated in 0.00081s] ('active', '2025-12-16 15:37:41.568902')
2025-12-16 18:37:41,586 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 18:37:41,587 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] ('active', '2025-12-16 15:37:41.585906')
2025-12-16 18:37:41,588 - utils.timer - INFO - Восстановлено 0 таймеров, завершено 0 аукционов
2025-12-16 18:37:41,588 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:37:41,589 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 18:37:41,589 - __main__ - INFO - Бот запущен
2025-12-16 18:37:41,589 - aiogram.dispatcher - INFO - Start polling
2025-12-16 18:37:41,819 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 18:37:44,587 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:37:44,588 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:37:44,588 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] (8148367074,)
2025-12-16 18:37:44,590 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:37:44,592 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:37:44,592 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:37:44,592 - sqlalchemy.engine.Engine - INFO - [cached since 0.004505s ago] (8148367074,)
2025-12-16 18:37:44,874 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:37:44,875 - aiogram.event - INFO - Update id=188256728 is handled. Duration 280 ms by bot id=8561542425
2025-12-16 18:37:48,621 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:37:48,622 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:37:48,622 - sqlalchemy.engine.Engine - INFO - [cached since 4.035s ago] (8148367074,)
2025-12-16 18:37:48,623 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:37:48,837 - aiogram.event - INFO - Update id=188256729 is handled. Duration 219 ms by bot id=8561542425
2025-12-16 18:38:02,171 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:38:02,171 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:38:02,172 - sqlalchemy.engine.Engine - INFO - [cached since 17.58s ago] (8148367074,)
2025-12-16 18:38:02,173 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:38:02,175 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:38:02,176 - sqlalchemy.engine.Engine - INFO - SELECT notifications.id, notifications.user_id, notifications.auction_id, notifications.message, notifications.is_read, notifications.created_at 
FROM notifications JOIN users ON users.id = notifications.user_id 
WHERE users.telegram_id = ? ORDER BY notifications.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 18:38:02,177 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (8148367074, 20, 0)
2025-12-16 18:38:02,397 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:38:02,398 - aiogram.event - INFO - Update id=188256730 is handled. Duration 234 ms by bot id=8561542425
2025-12-16 18:38:05,206 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:38:05,207 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:38:05,207 - sqlalchemy.engine.Engine - INFO - [cached since 20.62s ago] (8148367074,)
2025-12-16 18:38:05,209 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:38:05,210 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:38:05,211 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions JOIN users ON users.id = auctions.winner_id 
WHERE users.telegram_id = ? AND auctions.status = ? AND auctions.winner_id = users.id ORDER BY auctions.ended_at DESC
2025-12-16 18:38:05,212 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (8148367074, 'ended')
2025-12-16 18:38:05,321 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:38:05,322 - aiogram.event - INFO - Update id=188256731 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 18:38:06,308 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:38:06,308 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:38:06,309 - sqlalchemy.engine.Engine - INFO - [cached since 21.72s ago] (8148367074,)
2025-12-16 18:38:06,310 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:38:06,312 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:38:06,314 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids JOIN auctions ON auctions.id = bids.auction_id JOIN users ON users.id = auctions.winner_id 
WHERE users.telegram_id = ? ORDER BY bids.created_at DESC
2025-12-16 18:38:06,314 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (8148367074,)
2025-12-16 18:38:06,414 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:38:06,415 - aiogram.event - INFO - Update id=188256732 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 18:38:07,985 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:38:07,985 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:38:07,986 - sqlalchemy.engine.Engine - INFO - [cached since 23.4s ago] (8148367074,)
2025-12-16 18:38:07,987 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:38:07,988 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:38:07,989 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 18:38:07,990 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] ('active',)
2025-12-16 18:38:08,124 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:38:08,125 - aiogram.event - INFO - Update id=188256733 is handled. Duration 139 ms by bot id=8561542425
2025-12-16 18:38:47,827 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 18:38:48,084 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_183848.db
2025-12-16 18:38:48,084 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 18:38:48,085 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 18:38:55,207 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:38:55,208 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 18:38:55,208 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:38:55,209 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 18:38:55,210 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:38:55,210 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 18:38:55,211 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:38:55,211 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 18:38:55,212 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:38:55,212 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 18:38:55,213 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:38:55,214 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:38:55,214 - __main__ - INFO - База данных инициализирована
2025-12-16 18:38:55,214 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 18:38:55,215 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_183855.db
2025-12-16 18:38:55,216 - __main__ - INFO - Резервная копия создана
2025-12-16 18:38:55,256 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:38:55,273 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 18:38:55,274 - sqlalchemy.engine.Engine - INFO - [generated in 0.00081s] ('active', '2025-12-16 15:38:55.255924')
2025-12-16 18:38:55,276 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 18:38:55,277 - sqlalchemy.engine.Engine - INFO - [generated in 0.00078s] ('active', '2025-12-16 15:38:55.275929')
2025-12-16 18:38:55,278 - utils.timer - INFO - Восстановлено 0 таймеров, завершено 0 аукционов
2025-12-16 18:38:55,278 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:38:55,279 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 18:38:55,279 - __main__ - INFO - Бот запущен
2025-12-16 18:38:55,279 - aiogram.dispatcher - INFO - Start polling
2025-12-16 18:38:55,510 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 18:38:59,609 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:38:59,611 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:38:59,611 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (8148367074,)
2025-12-16 18:38:59,613 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:38:59,614 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:38:59,615 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:38:59,615 - sqlalchemy.engine.Engine - INFO - [cached since 0.004529s ago] (8148367074,)
2025-12-16 18:38:59,868 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:38:59,870 - aiogram.event - INFO - Update id=188256734 is handled. Duration 264 ms by bot id=8561542425
2025-12-16 18:39:18,198 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:39:18,199 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:39:18,199 - sqlalchemy.engine.Engine - INFO - [cached since 18.59s ago] (8148367074,)
2025-12-16 18:39:18,200 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:39:18,202 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:39:18,203 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 18:39:18,203 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] ('active',)
2025-12-16 18:39:18,205 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:39:18,539 - aiogram.event - INFO - Update id=188256735 is handled. Duration 344 ms by bot id=8561542425
2025-12-16 18:40:03,483 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:40:03,483 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:40:03,484 - sqlalchemy.engine.Engine - INFO - [cached since 63.87s ago] (8148367074,)
2025-12-16 18:40:03,485 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:40:03,486 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:40:03,487 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 18:40:03,487 - sqlalchemy.engine.Engine - INFO - [cached since 45.28s ago] ('active',)
2025-12-16 18:40:03,488 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:40:03,978 - aiogram.event - INFO - Update id=188256736 is handled. Duration 500 ms by bot id=8561542425
2025-12-16 18:40:11,551 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:40:11,551 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:40:11,551 - sqlalchemy.engine.Engine - INFO - [cached since 71.94s ago] (8148367074,)
2025-12-16 18:40:11,553 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:40:11,695 - aiogram.event - INFO - Update id=188256737 is handled. Duration 155 ms by bot id=8561542425
2025-12-16 18:40:19,479 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:40:19,479 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:40:19,480 - sqlalchemy.engine.Engine - INFO - [cached since 79.87s ago] (8148367074,)
2025-12-16 18:40:19,481 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:40:19,586 - aiogram.event - INFO - Update id=188256738 is handled. Duration 108 ms by bot id=8561542425
2025-12-16 18:40:45,976 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:40:45,976 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:40:45,977 - sqlalchemy.engine.Engine - INFO - [cached since 106.4s ago] (8148367074,)
2025-12-16 18:40:45,978 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:40:46,239 - aiogram.event - INFO - Update id=188256739 is handled. Duration 266 ms by bot id=8561542425
2025-12-16 18:40:52,934 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:40:52,934 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:40:52,935 - sqlalchemy.engine.Engine - INFO - [cached since 113.3s ago] (8148367074,)
2025-12-16 18:40:52,936 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:40:53,048 - aiogram.event - INFO - Update id=188256740 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 18:41:00,083 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:41:00,084 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:41:00,084 - sqlalchemy.engine.Engine - INFO - [cached since 120.5s ago] (8148367074,)
2025-12-16 18:41:00,085 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:41:00,087 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:41:00,088 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at, ended_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-16 18:41:00,089 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] ('PWS125', '11111111111111111111111111111111111111111111111', '["AgACAgIAAxkBAAMaaUF9foOKhmLOfypfx1yVsu2Q1UQAAiIPaxvAChFKaEv3Gv8rvyQBAAMCAAN5AAM2BA"]', 1900.0, 150.0, 1900.0, 'active', None, None, '2025-12-16 15:41:00.088960', '2025-12-16 15:41:00.088960', '2025-12-16 19:41:00.086959', None)
2025-12-16 18:41:00,091 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:41:00,098 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:41:00,099 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 18:41:00,100 - sqlalchemy.engine.Engine - INFO - [generated in 0.00081s] ('PWS125', 1, 0)
2025-12-16 18:41:00,101 - handlers.admin - INFO - Аукцион создан с ID: 1
2025-12-16 18:41:00,101 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:41:00,102 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 18:41:00,356 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:41:00,357 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 18:41:00,357 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (1,)
2025-12-16 18:41:00,359 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-16 18:41:00,360 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] (13, 1)
2025-12-16 18:41:00,361 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:41:00,510 - aiogram.event - INFO - Update id=188256741 is handled. Duration 438 ms by bot id=8561542425
2025-12-16 18:41:13,801 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:41:13,802 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:41:13,802 - sqlalchemy.engine.Engine - INFO - [cached since 134.2s ago] (8148367074,)
2025-12-16 18:41:13,804 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:41:13,805 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:41:13,806 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 18:41:13,806 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] (1, 'active')
2025-12-16 18:41:13,808 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:41:13,809 - sqlalchemy.engine.Engine - INFO - [cached since 134.2s ago] (8148367074,)
2025-12-16 18:41:13,811 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 18:41:13,811 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (1,)
2025-12-16 18:41:13,813 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 18:41:13,814 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] (2050.0, '2025-12-16 15:41:13.812826', '2025-12-16 19:41:13.812826', 1)
2025-12-16 18:41:13,816 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 18:41:13,816 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] (1, 1, 2050.0, '2025-12-16 15:41:13.816827')
2025-12-16 18:41:13,817 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:41:13,825 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:41:13,828 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 18:41:13,829 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] (1, 3, 0)
2025-12-16 18:41:13,831 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 18:41:13,832 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] (1,)
2025-12-16 18:41:13,834 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 18:41:13,834 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] (1,)
2025-12-16 18:41:13,836 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 18:41:13,836 - sqlalchemy.engine.Engine - INFO - [cached since 13.48s ago] (1,)
2025-12-16 18:41:13,972 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:41:13,973 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 18:41:13,974 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] (1, 1)
2025-12-16 18:41:13,975 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:41:13,977 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 18:41:14,080 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:41:14,084 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 18:41:14,193 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 18:41:14,283 - aiogram.event - INFO - Update id=188256742 is handled. Duration 484 ms by bot id=8561542425
2025-12-16 18:41:16,504 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:41:16,504 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:41:16,505 - sqlalchemy.engine.Engine - INFO - [cached since 136.9s ago] (8148367074,)
2025-12-16 18:41:16,506 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:41:16,507 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:41:16,508 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:41:16,508 - sqlalchemy.engine.Engine - INFO - [cached since 136.9s ago] (8148367074,)
2025-12-16 18:41:16,512 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id = ?
2025-12-16 18:41:16,512 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] (1, 1)
2025-12-16 18:41:16,514 - sqlalchemy.engine.Engine - INFO - INSERT INTO auction_subscriptions (auction_id, user_id, created_at) VALUES (?, ?, ?)
2025-12-16 18:41:16,514 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] (1, 1, '2025-12-16 15:41:16.514846')
2025-12-16 18:41:16,516 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:41:16,615 - aiogram.event - INFO - Update id=188256743 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 18:42:12,761 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:12,761 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:42:12,762 - sqlalchemy.engine.Engine - INFO - [cached since 193.2s ago] (8148367074,)
2025-12-16 18:42:12,763 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:12,764 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:12,765 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 18:42:12,765 - sqlalchemy.engine.Engine - INFO - [cached since 174.6s ago] ('active',)
2025-12-16 18:42:12,766 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:13,016 - aiogram.event - INFO - Update id=188256744 is handled. Duration 250 ms by bot id=8561542425
2025-12-16 18:42:14,887 - aiogram.event - INFO - Update id=188256745 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 18:42:17,022 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:17,022 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:42:17,023 - sqlalchemy.engine.Engine - INFO - [cached since 197.4s ago] (8148367074,)
2025-12-16 18:42:17,024 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:17,025 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:17,026 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 18:42:17,027 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] ('active',)
2025-12-16 18:42:17,029 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 18:42:17,029 - sqlalchemy.engine.Engine - INFO - [cached since 63.2s ago] (1,)
2025-12-16 18:42:17,221 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:17,222 - aiogram.event - INFO - Update id=188256746 is handled. Duration 202 ms by bot id=8561542425
2025-12-16 18:42:27,768 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:27,768 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:42:27,769 - sqlalchemy.engine.Engine - INFO - [cached since 208.2s ago] (8148367074,)
2025-12-16 18:42:27,770 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:27,772 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:27,772 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 18:42:27,773 - sqlalchemy.engine.Engine - INFO - [cached since 189.6s ago] ('active',)
2025-12-16 18:42:27,776 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.created_at >= ?
2025-12-16 18:42:27,778 - sqlalchemy.engine.Engine - INFO - [generated in 0.00134s] ('2025-12-15 15:42:27.776066',)
2025-12-16 18:42:27,782 - sqlalchemy.engine.Engine - INFO - SELECT avg(count(bids.id)) AS avg_1 
FROM bids JOIN auctions ON auctions.id = bids.auction_id GROUP BY bids.auction_id
2025-12-16 18:42:27,783 - sqlalchemy.engine.Engine - INFO - [generated in 0.00105s] ()
2025-12-16 18:42:27,784 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:27,785 - aiogram.event - INFO - Update id=188256747 is not handled. Duration 15 ms by bot id=8561542425
2025-12-16 18:42:27,785 - aiogram.event - ERROR - Cause exception while process update id=188256747 by bot id=8561542425
OperationalError: (sqlite3.OperationalError) misuse of aggregate function count()
[SQL: SELECT avg(count(bids.id)) AS avg_1 
FROM bids JOIN auctions ON auctions.id = bids.auction_id GROUP BY bids.auction_id]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 146, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 298, in _handle_exception
    raise error
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 128, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 130, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 195, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiosqlite\cursor.py", line 48, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiosqlite\cursor.py", line 40, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiosqlite\core.py", line 132, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiosqlite\core.py", line 115, in run
    result = function()
             ^^^^^^^^^^
sqlite3.OperationalError: misuse of aggregate function count()

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\rate_limit.py", line 23, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\user_check.py", line 34, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\admin.py", line 543, in admin_limits
    result = await session.execute(stmt_avg_bids)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 200, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\sql\elements.py", line 517, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 2344, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 146, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 298, in _handle_exception
    raise error
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 128, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 130, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 195, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiosqlite\cursor.py", line 48, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiosqlite\cursor.py", line 40, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiosqlite\core.py", line 132, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiosqlite\core.py", line 115, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) misuse of aggregate function count()
[SQL: SELECT avg(count(bids.id)) AS avg_1 
FROM bids JOIN auctions ON auctions.id = bids.auction_id GROUP BY bids.auction_id]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-12-16 18:42:29,071 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:29,072 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:42:29,072 - sqlalchemy.engine.Engine - INFO - [cached since 209.5s ago] (8148367074,)
2025-12-16 18:42:29,074 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:29,075 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:29,076 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions
2025-12-16 18:42:29,076 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] ()
2025-12-16 18:42:29,078 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 18:42:29,078 - sqlalchemy.engine.Engine - INFO - [cached since 190.9s ago] ('active',)
2025-12-16 18:42:29,080 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 18:42:29,080 - sqlalchemy.engine.Engine - INFO - [cached since 190.9s ago] ('ended',)
2025-12-16 18:42:29,082 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users
2025-12-16 18:42:29,082 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ()
2025-12-16 18:42:29,084 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users 
WHERE users.is_confirmed = 1
2025-12-16 18:42:29,084 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] ()
2025-12-16 18:42:29,086 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids
2025-12-16 18:42:29,086 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] ()
2025-12-16 18:42:29,088 - sqlalchemy.engine.Engine - INFO - SELECT sum(auctions.current_price) AS sum_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 18:42:29,088 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] ('ended',)
2025-12-16 18:42:29,305 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:29,306 - aiogram.event - INFO - Update id=188256748 is handled. Duration 234 ms by bot id=8561542425
2025-12-16 18:42:31,193 - aiogram.event - INFO - Update id=188256749 is not handled. Duration 15 ms by bot id=8561542425
2025-12-16 18:42:32,135 - aiogram.event - INFO - Update id=188256750 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 18:42:32,953 - aiogram.event - INFO - Update id=188256751 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 18:42:35,163 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:35,164 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:42:35,164 - sqlalchemy.engine.Engine - INFO - [cached since 215.6s ago] (8148367074,)
2025-12-16 18:42:35,165 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:35,167 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:35,167 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 18:42:35,168 - sqlalchemy.engine.Engine - INFO - [cached since 197s ago] ('active',)
2025-12-16 18:42:35,170 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:35,284 - aiogram.event - INFO - Update id=188256752 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 18:42:38,335 - aiogram.event - INFO - Update id=188256753 is not handled. Duration 15 ms by bot id=8561542425
2025-12-16 18:42:39,177 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:39,177 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:42:39,178 - sqlalchemy.engine.Engine - INFO - [cached since 219.6s ago] (8148367074,)
2025-12-16 18:42:39,179 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:39,180 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:39,181 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 18:42:39,181 - sqlalchemy.engine.Engine - INFO - [cached since 201s ago] ('active',)
2025-12-16 18:42:39,182 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:39,292 - aiogram.event - INFO - Update id=188256754 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 18:42:49,205 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:49,205 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:42:49,206 - sqlalchemy.engine.Engine - INFO - [cached since 229.6s ago] (8148367074,)
2025-12-16 18:42:49,207 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:49,209 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:42:49,209 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 18:42:49,209 - sqlalchemy.engine.Engine - INFO - [cached since 32.18s ago] ('active',)
2025-12-16 18:42:49,211 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 18:42:49,211 - sqlalchemy.engine.Engine - INFO - [cached since 95.38s ago] (1,)
2025-12-16 18:42:49,567 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:42:49,568 - aiogram.event - INFO - Update id=188256755 is handled. Duration 359 ms by bot id=8561542425
2025-12-16 18:46:56,467 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 18:46:56,731 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_184656.db
2025-12-16 18:46:56,732 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 18:46:56,733 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 18:46:56,733 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 18:53:06,490 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:53:06,491 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 18:53:06,491 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:53:06,492 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 18:53:06,493 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:53:06,494 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 18:53:06,494 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:53:06,495 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 18:53:06,495 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:53:06,495 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 18:53:06,496 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 18:53:06,497 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:53:06,497 - __main__ - INFO - База данных инициализирована
2025-12-16 18:53:06,497 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 18:53:06,499 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_185306.db
2025-12-16 18:53:06,499 - __main__ - INFO - Резервная копия создана
2025-12-16 18:53:06,552 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:53:06,565 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 18:53:06,566 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ('active', '2025-12-16 15:53:06.551849')
2025-12-16 18:53:06,567 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 18:53:06,568 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:53:06,569 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 18:53:06,570 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] (1, 'active')
2025-12-16 18:53:06,573 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 18:53:06,573 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] (1, 3, 0)
2025-12-16 18:53:06,574 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 18:53:06,575 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:53:06,575 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 18:53:06,577 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 18:53:06,577 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] ('active', '2025-12-16 15:53:06.576856')
2025-12-16 18:53:06,578 - utils.timer - INFO - Восстановлено 1 таймеров, завершено 0 аукционов
2025-12-16 18:53:06,579 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:53:06,579 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 18:53:06,580 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 18:53:06,580 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 18:53:06,580 - __main__ - INFO - Бот запущен
2025-12-16 18:53:06,580 - aiogram.dispatcher - INFO - Start polling
2025-12-16 18:53:06,585 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:53:06,586 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 18:53:06,587 - sqlalchemy.engine.Engine - INFO - [generated in 0.00104s] ('active',)
2025-12-16 18:53:06,589 - utils.periodic_updater - INFO - Периодическое обновление: найдено 1 активных аукционов
2025-12-16 18:53:06,589 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 18:53:06,590 - sqlalchemy.engine.Engine - INFO - [cached since 0.01723s ago] (1, 3, 0)
2025-12-16 18:53:06,591 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 18:53:06,591 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 18:53:06,592 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:53:06,821 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 18:53:13,718 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:53:13,719 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:53:13,719 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] (8148367074,)
2025-12-16 18:53:13,721 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:53:13,723 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:53:13,724 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 18:53:13,724 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ('active',)
2025-12-16 18:53:13,725 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:53:13,978 - aiogram.event - INFO - Update id=188256756 is handled. Duration 266 ms by bot id=8561542425
2025-12-16 18:53:15,298 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:53:15,298 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:53:15,299 - sqlalchemy.engine.Engine - INFO - [cached since 1.581s ago] (8148367074,)
2025-12-16 18:53:15,300 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:53:15,302 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:53:15,302 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 18:53:15,302 - sqlalchemy.engine.Engine - INFO - [cached since 1.579s ago] ('active',)
2025-12-16 18:53:15,304 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:53:15,504 - aiogram.event - INFO - Update id=188256757 is handled. Duration 202 ms by bot id=8561542425
2025-12-16 18:53:22,735 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:53:22,736 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:53:22,736 - sqlalchemy.engine.Engine - INFO - [cached since 9.018s ago] (8148367074,)
2025-12-16 18:53:22,737 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:53:22,902 - aiogram.event - INFO - Update id=188256758 is handled. Duration 171 ms by bot id=8561542425
2025-12-16 18:53:31,216 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:53:31,216 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:53:31,217 - sqlalchemy.engine.Engine - INFO - [cached since 17.5s ago] (8148367074,)
2025-12-16 18:53:31,218 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:53:31,327 - aiogram.event - INFO - Update id=188256759 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 18:53:56,562 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:53:56,563 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:53:56,563 - sqlalchemy.engine.Engine - INFO - [cached since 42.84s ago] (8148367074,)
2025-12-16 18:53:56,564 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:53:56,833 - aiogram.event - INFO - Update id=188256760 is handled. Duration 265 ms by bot id=8561542425
2025-12-16 18:54:03,768 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:54:03,769 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:54:03,769 - sqlalchemy.engine.Engine - INFO - [cached since 50.05s ago] (8148367074,)
2025-12-16 18:54:03,770 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:54:03,884 - aiogram.event - INFO - Update id=188256761 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 18:54:08,366 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:54:08,366 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:54:08,367 - sqlalchemy.engine.Engine - INFO - [cached since 54.65s ago] (8148367074,)
2025-12-16 18:54:08,368 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:54:08,369 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:54:08,371 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at, ended_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-16 18:54:08,371 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] ('PBH42', 'tut opisanie', '["AgACAgIAAxkBAAMwaUGAlM3AgKsbVDD7ImmasnBuxRsAAmsPaxvAChFKqlEGCrPad5cBAAMCAAN5AAM2BA"]', 12000.0, 199.0, 12000.0, 'active', None, None, '2025-12-16 15:54:08.371770', '2025-12-16 15:54:08.371770', '2025-12-16 19:54:08.369770', None)
2025-12-16 18:54:08,373 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:54:08,380 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:54:08,381 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 18:54:08,381 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] ('PBH42', 1, 0)
2025-12-16 18:54:08,384 - handlers.admin - INFO - Аукцион создан с ID: 2
2025-12-16 18:54:08,384 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:54:08,384 - utils.timer - INFO - Таймер запущен для аукциона #2
2025-12-16 18:54:08,385 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:54:08,386 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 18:54:08,386 - sqlalchemy.engine.Engine - INFO - [cached since 61.82s ago] (2, 'active')
2025-12-16 18:54:08,389 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:54:08,580 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:54:08,580 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 18:54:08,581 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] (2,)
2025-12-16 18:54:08,583 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-16 18:54:08,583 - sqlalchemy.engine.Engine - INFO - [generated in 0.00032s] (14, 2)
2025-12-16 18:54:08,584 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:54:08,790 - aiogram.event - INFO - Update id=188256762 is handled. Duration 436 ms by bot id=8561542425
2025-12-16 18:54:25,837 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:54:25,837 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:54:25,838 - sqlalchemy.engine.Engine - INFO - [cached since 72.12s ago] (8148367074,)
2025-12-16 18:54:25,839 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:54:25,841 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:54:25,842 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 18:54:25,842 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] (2, 'active')
2025-12-16 18:54:25,844 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:54:25,844 - sqlalchemy.engine.Engine - INFO - [cached since 72.13s ago] (8148367074,)
2025-12-16 18:54:25,846 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 18:54:25,846 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (2,)
2025-12-16 18:54:25,848 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 18:54:25,848 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] (12199.0, '2025-12-16 15:54:25.847561', '2025-12-16 19:54:25.847561', 2)
2025-12-16 18:54:25,851 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 18:54:25,852 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (2, 1, 12199.0, '2025-12-16 15:54:25.851562')
2025-12-16 18:54:25,853 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:54:25,860 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:54:25,862 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 18:54:25,863 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] (2, 3, 0)
2025-12-16 18:54:25,866 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 18:54:25,866 - sqlalchemy.engine.Engine - INFO - [generated in 0.00093s] (1,)
2025-12-16 18:54:25,868 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 18:54:25,869 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] (2,)
2025-12-16 18:54:25,870 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 18:54:25,870 - sqlalchemy.engine.Engine - INFO - [cached since 17.29s ago] (2,)
2025-12-16 18:54:26,154 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:54:26,155 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 18:54:26,156 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] (2, 1)
2025-12-16 18:54:26,157 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:54:26,159 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 18:54:26,169 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:54:26,174 - utils.timer - INFO - Таймер для аукциона #2 отменен
2025-12-16 18:54:26,281 - utils.timer - INFO - Таймер запущен для аукциона #2
2025-12-16 18:54:26,283 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:54:26,283 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 18:54:26,284 - sqlalchemy.engine.Engine - INFO - [cached since 79.71s ago] (2, 'active')
2025-12-16 18:54:26,285 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 18:54:26,286 - sqlalchemy.engine.Engine - INFO - [cached since 79.71s ago] (2, 3, 0)
2025-12-16 18:54:26,287 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #2: 'Select' object has no attribute 'count'
2025-12-16 18:54:26,287 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:54:26,288 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #2: 'Select' object has no attribute 'count'
2025-12-16 18:54:26,395 - aiogram.event - INFO - Update id=188256763 is handled. Duration 563 ms by bot id=8561542425
2025-12-16 18:55:43,542 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:55:43,543 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:55:43,543 - sqlalchemy.engine.Engine - INFO - [cached since 149.8s ago] (8148367074,)
2025-12-16 18:55:43,544 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 18:55:43,546 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:55:43,546 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 18:55:43,547 - sqlalchemy.engine.Engine - INFO - [cached since 77.7s ago] (2, 'active')
2025-12-16 18:55:43,548 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:55:43,548 - sqlalchemy.engine.Engine - INFO - [cached since 149.8s ago] (8148367074,)
2025-12-16 18:55:43,549 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 18:55:43,550 - sqlalchemy.engine.Engine - INFO - [cached since 77.7s ago] (2,)
2025-12-16 18:55:43,789 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:55:43,790 - aiogram.event - INFO - Update id=188256764 is handled. Duration 250 ms by bot id=8561542425
2025-12-16 18:58:12,824 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:58:12,824 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:58:12,825 - sqlalchemy.engine.Engine - INFO - [cached since 299.1s ago] (689062635,)
2025-12-16 18:58:12,827 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (telegram_id, username, first_name, last_name, phone, is_confirmed, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-12-16 18:58:12,828 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] (689062635, 'kismet1992', 'Нурлан', 'Кисметов', None, 0, '2025-12-16 15:58:12.827217')
2025-12-16 18:58:12,829 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:58:12,835 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 18:58:12,835 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 18:58:12,836 - sqlalchemy.engine.Engine - INFO - [cached since 227s ago] (2, 'active')
2025-12-16 18:58:12,838 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 18:58:12,838 - sqlalchemy.engine.Engine - INFO - [cached since 299.1s ago] (689062635,)
2025-12-16 18:58:13,082 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 18:58:13,083 - aiogram.event - INFO - Update id=188256765 is handled. Duration 250 ms by bot id=8561542425
2025-12-16 19:00:51,727 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:00:51,728 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:00:51,728 - sqlalchemy.engine.Engine - INFO - [cached since 458s ago] (8148367074,)
2025-12-16 19:00:51,729 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:00:51,731 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:00:51,731 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 19:00:51,732 - sqlalchemy.engine.Engine - INFO - [cached since 385.9s ago] (2, 'active')
2025-12-16 19:00:51,733 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:00:51,734 - sqlalchemy.engine.Engine - INFO - [cached since 458s ago] (8148367074,)
2025-12-16 19:00:51,735 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 19:00:51,736 - sqlalchemy.engine.Engine - INFO - [cached since 385.9s ago] (2,)
2025-12-16 19:00:52,836 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 19:00:52,837 - aiogram.event - INFO - Update id=188256766 is handled. Duration 1125 ms by bot id=8561542425
2025-12-16 19:01:09,438 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:01:09,438 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:01:09,439 - sqlalchemy.engine.Engine - INFO - [cached since 475.7s ago] (8148367074,)
2025-12-16 19:01:09,440 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:01:09,441 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:01:09,442 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 19:01:09,442 - sqlalchemy.engine.Engine - INFO - [cached since 475.7s ago] ('active',)
2025-12-16 19:01:09,444 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:01:09,712 - aiogram.event - INFO - Update id=188256767 is handled. Duration 280 ms by bot id=8561542425
2025-12-16 19:01:11,152 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:01:11,152 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:01:11,153 - sqlalchemy.engine.Engine - INFO - [cached since 477.4s ago] (8148367074,)
2025-12-16 19:01:11,154 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:01:11,155 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:01:11,156 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 19:01:11,157 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] ('active',)
2025-12-16 19:01:11,159 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 19:01:11,159 - sqlalchemy.engine.Engine - INFO - [cached since 405.3s ago] (2,)
2025-12-16 19:01:11,161 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 19:01:11,161 - sqlalchemy.engine.Engine - INFO - [cached since 405.3s ago] (1,)
2025-12-16 19:01:11,385 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:01:11,386 - aiogram.event - INFO - Update id=188256768 is handled. Duration 234 ms by bot id=8561542425
2025-12-16 19:02:15,002 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 19:02:15,268 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_190215.db
2025-12-16 19:02:15,268 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 19:02:15,269 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 19:02:15,269 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 19:02:21,247 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 19:02:21,248 - utils.timer - INFO - Таймер для аукциона #2 отменен
2025-12-16 19:02:34,729 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:02:34,729 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 19:02:34,729 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 19:02:34,730 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 19:02:34,731 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 19:02:34,732 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 19:02:34,732 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 19:02:34,733 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 19:02:34,733 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 19:02:34,734 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 19:02:34,734 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 19:02:34,735 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 19:02:34,735 - __main__ - INFO - База данных инициализирована
2025-12-16 19:02:34,736 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 19:02:34,737 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_190234.db
2025-12-16 19:02:34,737 - __main__ - INFO - Резервная копия создана
2025-12-16 19:02:34,760 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:02:34,774 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 19:02:34,775 - sqlalchemy.engine.Engine - INFO - [generated in 0.00079s] ('active', '2025-12-16 16:02:34.759991')
2025-12-16 19:02:34,776 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 19:02:34,778 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:02:34,779 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 19:02:34,779 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (1, 'active')
2025-12-16 19:02:34,782 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 19:02:34,782 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (1, 3, 0)
2025-12-16 19:02:34,784 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 19:02:34,784 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:02:34,785 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 19:02:34,785 - utils.timer - INFO - Таймер запущен для аукциона #2
2025-12-16 19:02:34,786 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:02:34,787 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 19:02:34,787 - sqlalchemy.engine.Engine - INFO - [cached since 0.008596s ago] (2, 'active')
2025-12-16 19:02:34,789 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 19:02:34,790 - sqlalchemy.engine.Engine - INFO - [cached since 0.007878s ago] (2, 3, 0)
2025-12-16 19:02:34,791 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #2: 'Select' object has no attribute 'count'
2025-12-16 19:02:34,791 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:02:34,792 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #2: 'Select' object has no attribute 'count'
2025-12-16 19:02:34,793 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 19:02:34,793 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] ('active', '2025-12-16 16:02:34.793000')
2025-12-16 19:02:34,796 - utils.timer - INFO - Восстановлено 2 таймеров, завершено 0 аукционов
2025-12-16 19:02:34,796 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:02:34,797 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 19:02:34,797 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 19:02:34,797 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 19:02:34,798 - __main__ - INFO - Бот запущен
2025-12-16 19:02:34,798 - aiogram.dispatcher - INFO - Start polling
2025-12-16 19:02:34,802 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:02:34,803 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 19:02:34,804 - sqlalchemy.engine.Engine - INFO - [generated in 0.00098s] ('active',)
2025-12-16 19:02:34,805 - utils.periodic_updater - INFO - Периодическое обновление: найдено 2 активных аукционов
2025-12-16 19:02:34,806 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 19:02:34,807 - sqlalchemy.engine.Engine - INFO - [cached since 0.02385s ago] (1, 3, 0)
2025-12-16 19:02:34,808 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 19:02:34,808 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 19:02:34,809 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 19:02:34,809 - sqlalchemy.engine.Engine - INFO - [cached since 0.02647s ago] (2, 3, 0)
2025-12-16 19:02:34,810 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #2: 'Select' object has no attribute 'count'
2025-12-16 19:02:34,811 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #2: 'Select' object has no attribute 'count'
2025-12-16 19:02:34,811 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:02:35,039 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 19:02:39,165 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:02:39,166 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:02:39,167 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (8148367074,)
2025-12-16 19:02:39,169 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:02:39,170 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:02:39,171 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 19:02:39,172 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ('active',)
2025-12-16 19:02:39,173 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:02:39,551 - aiogram.event - INFO - Update id=188256769 is handled. Duration 375 ms by bot id=8561542425
2025-12-16 19:02:41,007 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:02:41,008 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:02:41,008 - sqlalchemy.engine.Engine - INFO - [cached since 1.842s ago] (8148367074,)
2025-12-16 19:02:41,009 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:02:41,011 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:02:41,012 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 19:02:41,013 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ('active',)
2025-12-16 19:02:41,016 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 19:02:41,016 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (2,)
2025-12-16 19:02:41,018 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 19:02:41,018 - sqlalchemy.engine.Engine - INFO - [cached since 0.002791s ago] (1,)
2025-12-16 19:02:41,235 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:02:41,236 - aiogram.event - INFO - Update id=188256770 is handled. Duration 235 ms by bot id=8561542425
2025-12-16 19:12:34,818 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:12:34,819 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 19:12:34,819 - sqlalchemy.engine.Engine - INFO - [cached since 600s ago] ('active',)
2025-12-16 19:12:34,820 - utils.periodic_updater - INFO - Периодическое обновление: найдено 2 активных аукционов
2025-12-16 19:12:34,821 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 19:12:34,821 - sqlalchemy.engine.Engine - INFO - [cached since 600s ago] (1, 3, 0)
2025-12-16 19:12:34,822 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 19:12:34,822 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 19:12:34,823 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 19:12:34,823 - sqlalchemy.engine.Engine - INFO - [cached since 600s ago] (2, 3, 0)
2025-12-16 19:12:34,824 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #2: 'Select' object has no attribute 'count'
2025-12-16 19:12:34,824 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #2: 'Select' object has no attribute 'count'
2025-12-16 19:12:34,825 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:16:37,441 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 19:16:37,526 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 1] [SSL: APPLICATION_DATA_AFTER_CLOSE_NOTIFY] application data after close notify (_ssl.c:2672)
2025-12-16 19:16:37,526 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8561542425)
2025-12-16 19:16:37,693 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_191637.db
2025-12-16 19:16:37,693 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 19:16:37,694 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 19:16:37,694 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 19:16:37,694 - utils.timer - INFO - Таймер для аукциона #2 отменен
2025-12-16 19:16:40,753 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 19:26:41,536 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:26:41,536 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 19:26:41,536 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 19:26:41,537 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 19:26:41,538 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 19:26:41,538 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 19:26:41,539 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 19:26:41,539 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 19:26:41,540 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 19:26:41,540 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 19:26:41,541 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 19:26:41,542 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 19:26:41,543 - __main__ - INFO - База данных инициализирована
2025-12-16 19:26:41,543 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 19:26:41,544 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_192641.db
2025-12-16 19:26:41,545 - __main__ - INFO - Резервная копия создана
2025-12-16 19:26:41,585 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:26:41,602 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 19:26:41,602 - sqlalchemy.engine.Engine - INFO - [generated in 0.00080s] ('active', '2025-12-16 16:26:41.584172')
2025-12-16 19:26:41,604 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 19:26:41,606 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:26:41,607 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 19:26:41,607 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (1, 'active')
2025-12-16 19:26:41,609 - utils.periodic_updater - INFO - Обновляю аукцион #1, сообщение ID: 13
2025-12-16 19:26:41,610 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 19:26:41,611 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (1, 3, 0)
2025-12-16 19:26:41,612 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 19:26:41,612 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:26:41,613 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 19:26:41,613 - utils.timer - INFO - Таймер запущен для аукциона #2
2025-12-16 19:26:41,615 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:26:41,615 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 19:26:41,616 - sqlalchemy.engine.Engine - INFO - [cached since 0.009278s ago] (2, 'active')
2025-12-16 19:26:41,617 - utils.periodic_updater - INFO - Обновляю аукцион #2, сообщение ID: 14
2025-12-16 19:26:41,618 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 19:26:41,618 - sqlalchemy.engine.Engine - INFO - [cached since 0.008196s ago] (2, 3, 0)
2025-12-16 19:26:41,620 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #2: 'Select' object has no attribute 'count'
2025-12-16 19:26:41,620 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:26:41,621 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #2: 'Select' object has no attribute 'count'
2025-12-16 19:26:41,622 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 19:26:41,623 - sqlalchemy.engine.Engine - INFO - [generated in 0.00074s] ('active', '2025-12-16 16:26:41.621180')
2025-12-16 19:26:41,624 - utils.timer - INFO - Восстановлено 2 таймеров, завершено 0 аукционов
2025-12-16 19:26:41,624 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:26:41,625 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 19:26:41,625 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 19:26:41,625 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 19:26:41,625 - __main__ - INFO - Бот запущен
2025-12-16 19:26:41,626 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 19:26:41,626 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 19:26:41,626 - __main__ - INFO - Бот установлен: True
2025-12-16 19:26:41,626 - aiogram.dispatcher - INFO - Start polling
2025-12-16 19:26:41,630 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:26:41,631 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 19:26:41,632 - sqlalchemy.engine.Engine - INFO - [generated in 0.00074s] ('active',)
2025-12-16 19:26:41,634 - utils.periodic_updater - INFO - Периодическое обновление: найдено 2 активных аукционов
2025-12-16 19:26:41,634 - utils.periodic_updater - INFO - Обновляю аукцион #1, сообщение ID: 13
2025-12-16 19:26:41,634 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 19:26:41,635 - sqlalchemy.engine.Engine - INFO - [cached since 0.02475s ago] (1, 3, 0)
2025-12-16 19:26:41,636 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 19:26:41,636 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #1: 'Select' object has no attribute 'count'
2025-12-16 19:26:41,637 - utils.periodic_updater - INFO - Обновляю аукцион #2, сообщение ID: 14
2025-12-16 19:26:41,637 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 19:26:41,638 - sqlalchemy.engine.Engine - INFO - [cached since 0.02746s ago] (2, 3, 0)
2025-12-16 19:26:41,639 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #2: 'Select' object has no attribute 'count'
2025-12-16 19:26:41,639 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #2: 'Select' object has no attribute 'count'
2025-12-16 19:26:41,639 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:26:41,875 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 19:26:53,523 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:26:53,524 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:26:53,525 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] (8148367074,)
2025-12-16 19:26:53,526 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:26:53,528 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:26:53,529 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 19:26:53,529 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] ('active',)
2025-12-16 19:26:53,531 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:26:53,794 - aiogram.event - INFO - Update id=188256771 is handled. Duration 265 ms by bot id=8561542425
2025-12-16 19:26:55,091 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:26:55,091 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:26:55,092 - sqlalchemy.engine.Engine - INFO - [cached since 1.567s ago] (8148367074,)
2025-12-16 19:26:55,093 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:26:55,095 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:26:55,095 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 19:26:55,096 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] ('active',)
2025-12-16 19:26:55,099 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 19:26:55,099 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] (2,)
2025-12-16 19:26:55,212 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 19:26:55,213 - sqlalchemy.engine.Engine - INFO - [cached since 0.1141s ago] (1,)
2025-12-16 19:26:55,429 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:26:55,430 - aiogram.event - INFO - Update id=188256772 is handled. Duration 344 ms by bot id=8561542425
2025-12-16 19:26:59,054 - aiogram.event - INFO - Update id=188256773 is not handled. Duration 15 ms by bot id=8561542425
2025-12-16 19:27:02,128 - aiogram.event - INFO - Update id=188256774 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 19:27:04,967 - aiogram.event - INFO - Update id=188256775 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 19:27:05,853 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:27:05,854 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:27:05,854 - sqlalchemy.engine.Engine - INFO - [cached since 12.33s ago] (8148367074,)
2025-12-16 19:27:05,855 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:27:05,857 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:27:05,858 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 19:27:05,859 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] (2,)
2025-12-16 19:27:05,861 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 19:27:05,862 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] ('ended', '2025-12-16 16:27:05.860991', 2)
2025-12-16 19:27:05,864 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
2025-12-16 19:27:05,864 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] (2,)
2025-12-16 19:27:05,866 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET winner_id=? WHERE auctions.id = ?
2025-12-16 19:27:05,866 - sqlalchemy.engine.Engine - INFO - [generated in 0.00037s] (1, 2)
2025-12-16 19:27:05,867 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 19:27:05,874 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:27:05,876 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 19:27:05,877 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] (2,)
2025-12-16 19:27:05,879 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 19:27:05,879 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (1,)
2025-12-16 19:27:05,882 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 19:27:05,883 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (2, 3, 0)
2025-12-16 19:27:05,885 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 19:27:05,885 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] (1,)
2025-12-16 19:27:05,887 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 19:27:05,887 - sqlalchemy.engine.Engine - INFO - [cached since 10.79s ago] (2,)
2025-12-16 19:27:06,213 - handlers.admin - INFO - Сообщение в канале для аукциона #2 обновлено (админское завершение)
2025-12-16 19:27:06,214 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:27:06,215 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.id = ?
2025-12-16 19:27:06,216 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (1,)
2025-12-16 19:27:06,354 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 19:27:06,365 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 19:27:06,371 - utils.timer - INFO - Таймер для аукциона #2 отменен
2025-12-16 19:27:06,573 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:27:06,574 - aiogram.event - INFO - Update id=188256776 is handled. Duration 717 ms by bot id=8561542425
2025-12-16 19:27:10,872 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:27:10,873 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:27:10,873 - sqlalchemy.engine.Engine - INFO - [cached since 17.35s ago] (8148367074,)
2025-12-16 19:27:10,874 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:27:10,876 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:27:10,876 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 19:27:10,877 - sqlalchemy.engine.Engine - INFO - [cached since 5.018s ago] (1,)
2025-12-16 19:27:10,878 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 19:27:10,878 - sqlalchemy.engine.Engine - INFO - [cached since 5.017s ago] ('ended', '2025-12-16 16:27:10.878364', 1)
2025-12-16 19:27:10,880 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
2025-12-16 19:27:10,881 - sqlalchemy.engine.Engine - INFO - [cached since 5.016s ago] (1,)
2025-12-16 19:27:10,882 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET winner_id=? WHERE auctions.id = ?
2025-12-16 19:27:10,883 - sqlalchemy.engine.Engine - INFO - [cached since 5.016s ago] (1, 1)
2025-12-16 19:27:10,883 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 19:27:10,890 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:27:10,891 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 19:27:10,891 - sqlalchemy.engine.Engine - INFO - [cached since 5.015s ago] (1,)
2025-12-16 19:27:10,893 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 19:27:10,894 - sqlalchemy.engine.Engine - INFO - [cached since 5.014s ago] (1,)
2025-12-16 19:27:10,895 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 19:27:10,896 - sqlalchemy.engine.Engine - INFO - [cached since 5.013s ago] (1, 3, 0)
2025-12-16 19:27:10,898 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 19:27:10,898 - sqlalchemy.engine.Engine - INFO - [cached since 5.013s ago] (1,)
2025-12-16 19:27:10,900 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 19:27:10,900 - sqlalchemy.engine.Engine - INFO - [cached since 15.8s ago] (1,)
2025-12-16 19:27:11,229 - handlers.admin - INFO - Сообщение в канале для аукциона #1 обновлено (админское завершение)
2025-12-16 19:27:11,230 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:27:11,230 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.id = ?
2025-12-16 19:27:11,231 - sqlalchemy.engine.Engine - INFO - [cached since 5.016s ago] (1,)
2025-12-16 19:27:11,365 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 19:27:11,371 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 19:27:11,377 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 19:27:11,597 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:27:11,598 - aiogram.event - INFO - Update id=188256777 is handled. Duration 719 ms by bot id=8561542425
2025-12-16 19:30:32,256 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:30:32,257 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:30:32,257 - sqlalchemy.engine.Engine - INFO - [cached since 218.7s ago] (8148367074,)
2025-12-16 19:30:32,258 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:30:32,260 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:30:32,261 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:30:32,261 - sqlalchemy.engine.Engine - INFO - [cached since 218.7s ago] (8148367074,)
2025-12-16 19:30:32,603 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:30:32,604 - aiogram.event - INFO - Update id=188256778 is handled. Duration 360 ms by bot id=8561542425
2025-12-16 19:30:41,801 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:30:41,802 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:30:41,802 - sqlalchemy.engine.Engine - INFO - [cached since 228.3s ago] (8148367074,)
2025-12-16 19:30:41,803 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:30:41,805 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:30:41,805 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:30:41,805 - sqlalchemy.engine.Engine - INFO - [cached since 228.3s ago] (8148367074,)
2025-12-16 19:30:41,941 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:30:41,942 - aiogram.event - INFO - Update id=188256779 is handled. Duration 140 ms by bot id=8561542425
2025-12-16 19:36:41,643 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:36:41,644 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 19:36:41,644 - sqlalchemy.engine.Engine - INFO - [cached since 600s ago] ('active',)
2025-12-16 19:36:41,645 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:36:48,491 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:36:48,491 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 19:36:48,492 - sqlalchemy.engine.Engine - INFO - [cached since 595s ago] (8148367074,)
2025-12-16 19:36:48,493 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:36:48,770 - aiogram.event - INFO - Update id=188256780 is handled. Duration 280 ms by bot id=8561542425
2025-12-16 19:46:41,673 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:46:41,673 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 19:46:41,674 - sqlalchemy.engine.Engine - INFO - [cached since 1200s ago] ('active',)
2025-12-16 19:46:41,675 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 19:56:41,689 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 19:56:41,689 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 19:56:41,690 - sqlalchemy.engine.Engine - INFO - [cached since 1800s ago] ('active',)
2025-12-16 19:56:41,691 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:06:41,696 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:06:41,696 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 20:06:41,697 - sqlalchemy.engine.Engine - INFO - [cached since 2400s ago] ('active',)
2025-12-16 20:06:41,698 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:00,568 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:00,568 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:12:00,569 - sqlalchemy.engine.Engine - INFO - [cached since 2707s ago] (8148367074,)
2025-12-16 20:12:00,570 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:00,572 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:00,572 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:12:00,572 - sqlalchemy.engine.Engine - INFO - [cached since 2707s ago] (8148367074,)
2025-12-16 20:12:00,830 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:00,831 - aiogram.event - INFO - Update id=188256781 is handled. Duration 265 ms by bot id=8561542425
2025-12-16 20:12:02,427 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:02,428 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:12:02,428 - sqlalchemy.engine.Engine - INFO - [cached since 2709s ago] (8148367074,)
2025-12-16 20:12:02,429 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:02,431 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:02,432 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids JOIN auctions ON auctions.id = bids.auction_id JOIN users ON users.id = auctions.winner_id 
WHERE users.telegram_id = ? ORDER BY bids.created_at DESC
2025-12-16 20:12:02,433 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] (8561542425,)
2025-12-16 20:12:02,538 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:02,635 - aiogram.event - INFO - Update id=188256782 is handled. Duration 219 ms by bot id=8561542425
2025-12-16 20:12:03,701 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:03,701 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:12:03,702 - sqlalchemy.engine.Engine - INFO - [cached since 2710s ago] (8148367074,)
2025-12-16 20:12:03,703 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:03,705 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:03,706 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions JOIN users ON users.id = auctions.winner_id 
WHERE users.telegram_id = ? AND auctions.status = ? AND auctions.winner_id = users.id ORDER BY auctions.ended_at DESC
2025-12-16 20:12:03,706 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] (8561542425, 'ended')
2025-12-16 20:12:03,829 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:03,963 - aiogram.event - INFO - Update id=188256783 is handled. Duration 265 ms by bot id=8561542425
2025-12-16 20:12:15,982 - aiogram.event - INFO - Update id=188256784 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 20:12:18,956 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:18,956 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:12:18,957 - sqlalchemy.engine.Engine - INFO - [cached since 2725s ago] (8148367074,)
2025-12-16 20:12:18,958 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:18,959 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:18,960 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:12:18,960 - sqlalchemy.engine.Engine - INFO - [cached since 2725s ago] ('active',)
2025-12-16 20:12:18,961 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:19,104 - aiogram.event - INFO - Update id=188256785 is handled. Duration 157 ms by bot id=8561542425
2025-12-16 20:12:20,137 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:20,137 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:12:20,138 - sqlalchemy.engine.Engine - INFO - [cached since 2727s ago] (8148367074,)
2025-12-16 20:12:20,139 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:20,141 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:20,141 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:12:20,142 - sqlalchemy.engine.Engine - INFO - [cached since 2727s ago] ('active',)
2025-12-16 20:12:20,143 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:20,363 - aiogram.event - INFO - Update id=188256786 is handled. Duration 219 ms by bot id=8561542425
2025-12-16 20:12:39,982 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:39,982 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:12:39,983 - sqlalchemy.engine.Engine - INFO - [cached since 2746s ago] (8148367074,)
2025-12-16 20:12:39,984 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:40,250 - aiogram.event - INFO - Update id=188256787 is handled. Duration 264 ms by bot id=8561542425
2025-12-16 20:12:44,288 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:44,289 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:12:44,289 - sqlalchemy.engine.Engine - INFO - [cached since 2751s ago] (8148367074,)
2025-12-16 20:12:44,290 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:44,408 - aiogram.event - INFO - Update id=188256788 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 20:12:49,137 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:12:49,138 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:12:49,138 - sqlalchemy.engine.Engine - INFO - [cached since 2756s ago] (8148367074,)
2025-12-16 20:12:49,140 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:12:49,264 - aiogram.event - INFO - Update id=188256789 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 20:13:02,505 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:13:02,505 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:13:02,506 - sqlalchemy.engine.Engine - INFO - [cached since 2769s ago] (8148367074,)
2025-12-16 20:13:02,507 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:13:02,634 - aiogram.event - INFO - Update id=188256790 is handled. Duration 141 ms by bot id=8561542425
2025-12-16 20:13:07,020 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:13:07,020 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:13:07,021 - sqlalchemy.engine.Engine - INFO - [cached since 2773s ago] (8148367074,)
2025-12-16 20:13:07,022 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:13:07,152 - aiogram.event - INFO - Update id=188256791 is handled. Duration 140 ms by bot id=8561542425
2025-12-16 20:13:12,386 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:13:12,387 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:13:12,387 - sqlalchemy.engine.Engine - INFO - [cached since 2779s ago] (8148367074,)
2025-12-16 20:13:12,388 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:13:12,390 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:13:12,391 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at, ended_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-16 20:13:12,391 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] ('Куры гриль', 'из гриля', '["AgACAgIAAxkBAANYaUGTHoX56d19UlimBsWuSQABbeutAAI-EGsbwAoRSn0tatY0q7ajAQADAgADeQADNgQ"]', 1100.0, 150.0, 1100.0, 'active', None, None, '2025-12-16 17:13:12.391140', '2025-12-16 17:13:12.391140', '2025-12-16 21:13:12.389139', None)
2025-12-16 20:13:12,393 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:13:12,400 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:13:12,401 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 20:13:12,402 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] ('Куры гриль', 1, 0)
2025-12-16 20:13:12,403 - handlers.admin - INFO - Аукцион создан с ID: 3
2025-12-16 20:13:12,403 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:13:12,404 - utils.timer - INFO - Таймер запущен для аукциона #3
2025-12-16 20:13:12,405 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:13:12,405 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:13:12,406 - sqlalchemy.engine.Engine - INFO - [cached since 2791s ago] (3, 'active')
2025-12-16 20:13:12,408 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:13:12,647 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:13:12,648 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:13:12,648 - sqlalchemy.engine.Engine - INFO - [cached since 2767s ago] (3,)
2025-12-16 20:13:12,650 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-16 20:13:12,650 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (16, 3)
2025-12-16 20:13:12,651 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:13:12,950 - aiogram.event - INFO - Update id=188256792 is handled. Duration 561 ms by bot id=8561542425
2025-12-16 20:16:41,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:16:41,709 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 20:16:41,710 - sqlalchemy.engine.Engine - INFO - [cached since 3000s ago] ('active',)
2025-12-16 20:16:41,711 - utils.periodic_updater - INFO - Периодическое обновление: найдено 1 активных аукционов
2025-12-16 20:16:41,711 - utils.periodic_updater - INFO - Обновляю аукцион #3, сообщение ID: 16
2025-12-16 20:16:41,712 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:16:41,712 - sqlalchemy.engine.Engine - INFO - [cached since 3000s ago] (3, 3, 0)
2025-12-16 20:16:41,713 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #3: 'Select' object has no attribute 'count'
2025-12-16 20:16:41,713 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #3: 'Select' object has no attribute 'count'
2025-12-16 20:16:41,714 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:19:02,371 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:19:02,371 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:19:02,372 - sqlalchemy.engine.Engine - INFO - [cached since 3129s ago] (8148367074,)
2025-12-16 20:19:02,373 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:19:02,808 - aiogram.event - INFO - Update id=188256793 is handled. Duration 438 ms by bot id=8561542425
2025-12-16 20:25:22,384 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:22,384 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:25:22,385 - sqlalchemy.engine.Engine - INFO - [cached since 3509s ago] (8148367074,)
2025-12-16 20:25:22,386 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:25:22,387 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:22,388 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:25:22,389 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (3, 'active')
2025-12-16 20:25:22,390 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:25:22,391 - sqlalchemy.engine.Engine - INFO - [cached since 3509s ago] (8148367074,)
2025-12-16 20:25:22,394 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 20:25:22,394 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] (3,)
2025-12-16 20:25:22,396 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 20:25:22,397 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] (1250.0, '2025-12-16 17:25:22.395070', '2025-12-16 21:25:22.395070', 3)
2025-12-16 20:25:22,405 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 20:25:22,406 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] (3, 1, 1250.0, '2025-12-16 17:25:22.405073')
2025-12-16 20:25:22,407 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:25:22,415 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:22,416 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:25:22,416 - sqlalchemy.engine.Engine - INFO - [cached since 3497s ago] (3, 3, 0)
2025-12-16 20:25:22,418 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 20:25:22,418 - sqlalchemy.engine.Engine - INFO - [cached since 3497s ago] (1,)
2025-12-16 20:25:22,420 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:25:22,420 - sqlalchemy.engine.Engine - INFO - [cached since 3507s ago] (3,)
2025-12-16 20:25:22,421 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:25:22,422 - sqlalchemy.engine.Engine - INFO - [cached since 3497s ago] (3,)
2025-12-16 20:25:22,689 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:22,691 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 20:25:22,691 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] (3, 1)
2025-12-16 20:25:22,692 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:25:22,693 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 20:25:22,699 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:25:22,703 - utils.timer - INFO - Таймер для аукциона #3 отменен
2025-12-16 20:25:22,817 - utils.timer - INFO - Таймер запущен для аукциона #3
2025-12-16 20:25:22,819 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:22,819 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:25:22,820 - sqlalchemy.engine.Engine - INFO - [cached since 3521s ago] (3, 'active')
2025-12-16 20:25:22,821 - utils.periodic_updater - INFO - Обновляю аукцион #3, сообщение ID: 16
2025-12-16 20:25:22,822 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:25:22,822 - sqlalchemy.engine.Engine - INFO - [cached since 3521s ago] (3, 3, 0)
2025-12-16 20:25:22,823 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #3: 'Select' object has no attribute 'count'
2025-12-16 20:25:22,823 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:25:22,824 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #3: 'Select' object has no attribute 'count'
2025-12-16 20:25:22,979 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:22,980 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:25:22,981 - sqlalchemy.engine.Engine - INFO - [cached since 3521s ago] (3, 'active')
2025-12-16 20:25:22,982 - utils.periodic_updater - INFO - Обновляю аукцион #3, сообщение ID: 16
2025-12-16 20:25:22,982 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:25:22,983 - sqlalchemy.engine.Engine - INFO - [cached since 3521s ago] (3, 3, 0)
2025-12-16 20:25:22,983 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #3: 'Select' object has no attribute 'count'
2025-12-16 20:25:22,984 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:25:22,984 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #3: 'Select' object has no attribute 'count'
2025-12-16 20:25:22,985 - aiogram.event - INFO - Update id=188256794 is handled. Duration 610 ms by bot id=8561542425
2025-12-16 20:25:39,574 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 20:25:39,823 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_202539.db
2025-12-16 20:25:39,824 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 20:25:39,824 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 20:25:39,825 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 20:25:39,825 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:25:39,825 - utils.timer - INFO - Таймер для аукциона #3 отменен
2025-12-16 20:25:48,851 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:48,852 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 20:25:48,852 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:25:48,853 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 20:25:48,853 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:25:48,854 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 20:25:48,854 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:25:48,855 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 20:25:48,855 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:25:48,856 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 20:25:48,856 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:25:48,857 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:25:48,858 - __main__ - INFO - База данных инициализирована
2025-12-16 20:25:48,858 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 20:25:48,859 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_202548.db
2025-12-16 20:25:48,860 - __main__ - INFO - Резервная копия создана
2025-12-16 20:25:48,882 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:48,895 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 20:25:48,896 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] ('active', '2025-12-16 17:25:48.881140')
2025-12-16 20:25:48,897 - utils.timer - INFO - Таймер запущен для аукциона #3
2025-12-16 20:25:48,898 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:48,899 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:25:48,900 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] (3, 'active')
2025-12-16 20:25:48,901 - utils.periodic_updater - INFO - Обновляю аукцион #3, сообщение ID: 16
2025-12-16 20:25:48,903 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:25:48,903 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (3, 3, 0)
2025-12-16 20:25:48,905 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #3: 'Select' object has no attribute 'count'
2025-12-16 20:25:48,905 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:25:48,906 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #3: 'Select' object has no attribute 'count'
2025-12-16 20:25:48,907 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 20:25:48,907 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] ('active', '2025-12-16 17:25:48.906146')
2025-12-16 20:25:48,909 - utils.timer - INFO - Восстановлено 1 таймеров, завершено 0 аукционов
2025-12-16 20:25:48,909 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:25:48,910 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 20:25:48,910 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 20:25:48,910 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 20:25:48,911 - __main__ - INFO - Бот запущен
2025-12-16 20:25:48,911 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 20:25:48,911 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 20:25:48,911 - __main__ - INFO - Бот установлен: True
2025-12-16 20:25:48,911 - aiogram.dispatcher - INFO - Start polling
2025-12-16 20:25:48,916 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:48,917 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 20:25:48,918 - sqlalchemy.engine.Engine - INFO - [generated in 0.00089s] ('active',)
2025-12-16 20:25:48,919 - utils.periodic_updater - INFO - Периодическое обновление: найдено 1 активных аукционов
2025-12-16 20:25:48,919 - utils.periodic_updater - INFO - Обновляю аукцион #3, сообщение ID: 16
2025-12-16 20:25:48,920 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:25:48,920 - sqlalchemy.engine.Engine - INFO - [cached since 0.01773s ago] (3, 3, 0)
2025-12-16 20:25:48,922 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #3: 'Select' object has no attribute 'count'
2025-12-16 20:25:48,922 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #3: 'Select' object has no attribute 'count'
2025-12-16 20:25:48,922 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:25:49,166 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:25:53,429 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:53,430 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:25:53,431 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (8148367074,)
2025-12-16 20:25:53,432 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:25:53,726 - aiogram.event - INFO - Update id=188256795 is handled. Duration 313 ms by bot id=8561542425
2025-12-16 20:25:56,520 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:56,521 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:25:56,521 - sqlalchemy.engine.Engine - INFO - [cached since 3.092s ago] (8148367074,)
2025-12-16 20:25:56,523 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:25:56,524 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:25:56,524 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:25:56,525 - sqlalchemy.engine.Engine - INFO - [cached since 3.095s ago] (8148367074,)
2025-12-16 20:25:56,642 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:25:56,643 - aiogram.event - INFO - Update id=188256796 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 20:26:03,452 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:03,453 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:26:03,453 - sqlalchemy.engine.Engine - INFO - [cached since 10.02s ago] (8148367074,)
2025-12-16 20:26:03,455 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:03,456 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:03,457 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:26:03,458 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] ('active',)
2025-12-16 20:26:03,459 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:03,729 - aiogram.event - INFO - Update id=188256797 is handled. Duration 282 ms by bot id=8561542425
2025-12-16 20:26:05,174 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:05,175 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:26:05,175 - sqlalchemy.engine.Engine - INFO - [cached since 11.75s ago] (8148367074,)
2025-12-16 20:26:05,176 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:05,178 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:05,179 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 20:26:05,179 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] ('active',)
2025-12-16 20:26:05,181 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:26:05,181 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (3,)
2025-12-16 20:26:05,371 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:05,372 - aiogram.event - INFO - Update id=188256798 is handled. Duration 202 ms by bot id=8561542425
2025-12-16 20:26:07,452 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:07,452 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:26:07,453 - sqlalchemy.engine.Engine - INFO - [cached since 14.02s ago] (8148367074,)
2025-12-16 20:26:07,454 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:07,455 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:07,456 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:26:07,456 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (3,)
2025-12-16 20:26:07,460 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 20:26:07,460 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] ('ended', '2025-12-16 17:26:07.457500', 3)
2025-12-16 20:26:07,462 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
2025-12-16 20:26:07,463 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] (3,)
2025-12-16 20:26:07,464 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET winner_id=? WHERE auctions.id = ?
2025-12-16 20:26:07,465 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] (1, 3)
2025-12-16 20:26:07,466 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:26:07,471 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:07,474 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:26:07,474 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] (3,)
2025-12-16 20:26:07,477 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 20:26:07,478 - sqlalchemy.engine.Engine - INFO - [generated in 0.00082s] (1,)
2025-12-16 20:26:07,480 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:26:07,481 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] (3, 3, 0)
2025-12-16 20:26:07,483 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 20:26:07,483 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (1,)
2025-12-16 20:26:07,485 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:26:07,485 - sqlalchemy.engine.Engine - INFO - [cached since 2.304s ago] (3,)
2025-12-16 20:26:07,604 - handlers.admin - INFO - Сообщение в канале для аукциона #3 обновлено (админское завершение)
2025-12-16 20:26:07,606 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:07,606 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.id = ?
2025-12-16 20:26:07,607 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] (1,)
2025-12-16 20:26:07,717 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 20:26:07,728 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:26:07,733 - utils.timer - INFO - Таймер для аукциона #3 отменен
2025-12-16 20:26:07,920 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:07,921 - aiogram.event - INFO - Update id=188256799 is handled. Duration 469 ms by bot id=8561542425
2025-12-16 20:26:38,627 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:38,628 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:26:38,628 - sqlalchemy.engine.Engine - INFO - [cached since 45.2s ago] (8148367074,)
2025-12-16 20:26:38,629 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:38,631 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:38,631 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:26:38,631 - sqlalchemy.engine.Engine - INFO - [cached since 45.2s ago] (8148367074,)
2025-12-16 20:26:38,902 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:38,903 - aiogram.event - INFO - Update id=188256800 is handled. Duration 282 ms by bot id=8561542425
2025-12-16 20:26:42,595 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:42,596 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:26:42,596 - sqlalchemy.engine.Engine - INFO - [cached since 49.17s ago] (8148367074,)
2025-12-16 20:26:42,597 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:42,599 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:42,599 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:26:42,600 - sqlalchemy.engine.Engine - INFO - [cached since 39.14s ago] ('active',)
2025-12-16 20:26:42,601 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:42,713 - aiogram.event - INFO - Update id=188256801 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 20:26:43,823 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:43,823 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:26:43,824 - sqlalchemy.engine.Engine - INFO - [cached since 50.39s ago] (8148367074,)
2025-12-16 20:26:43,825 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:43,827 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:43,827 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:26:43,827 - sqlalchemy.engine.Engine - INFO - [cached since 40.37s ago] ('active',)
2025-12-16 20:26:43,828 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:44,088 - aiogram.event - INFO - Update id=188256802 is handled. Duration 265 ms by bot id=8561542425
2025-12-16 20:26:53,524 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:53,525 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:26:53,525 - sqlalchemy.engine.Engine - INFO - [cached since 60.09s ago] (8148367074,)
2025-12-16 20:26:53,526 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:53,632 - aiogram.event - INFO - Update id=188256803 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 20:26:55,473 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:26:55,474 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:26:55,474 - sqlalchemy.engine.Engine - INFO - [cached since 62.04s ago] (8148367074,)
2025-12-16 20:26:55,475 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:26:55,581 - aiogram.event - INFO - Update id=188256804 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 20:27:01,638 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:01,639 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:27:01,639 - sqlalchemy.engine.Engine - INFO - [cached since 68.21s ago] (8148367074,)
2025-12-16 20:27:01,640 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:27:01,756 - aiogram.event - INFO - Update id=188256805 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 20:27:04,495 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:04,495 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:27:04,495 - sqlalchemy.engine.Engine - INFO - [cached since 71.07s ago] (8148367074,)
2025-12-16 20:27:04,497 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:27:04,608 - aiogram.event - INFO - Update id=188256806 is handled. Duration 110 ms by bot id=8561542425
2025-12-16 20:27:08,059 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:08,059 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:27:08,060 - sqlalchemy.engine.Engine - INFO - [cached since 74.63s ago] (8148367074,)
2025-12-16 20:27:08,061 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:27:08,063 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:08,064 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at, ended_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-16 20:27:08,064 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] ('не куры тест', 'тест', '["AgACAgIAAxkBAANYaUGTHoX56d19UlimBsWuSQABbeutAAI-EGsbwAoRSn0tatY0q7ajAQADAgADeQADNgQ"]', 2124.0, 901.0, 2124.0, 'active', None, None, '2025-12-16 17:27:08.064302', '2025-12-16 17:27:08.064302', '2025-12-16 21:27:08.062302', None)
2025-12-16 20:27:08,066 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:27:08,073 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:08,074 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 20:27:08,075 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ('не куры тест', 1, 0)
2025-12-16 20:27:08,076 - handlers.admin - INFO - Аукцион создан с ID: 4
2025-12-16 20:27:08,076 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:27:08,076 - utils.timer - INFO - Таймер запущен для аукциона #4
2025-12-16 20:27:08,077 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:08,078 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:27:08,078 - sqlalchemy.engine.Engine - INFO - [cached since 79.18s ago] (4, 'active')
2025-12-16 20:27:08,081 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:27:08,265 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:08,265 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:27:08,266 - sqlalchemy.engine.Engine - INFO - [cached since 60.81s ago] (4,)
2025-12-16 20:27:08,267 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-16 20:27:08,268 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (19, 4)
2025-12-16 20:27:08,269 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:27:08,404 - aiogram.event - INFO - Update id=188256807 is handled. Duration 344 ms by bot id=8561542425
2025-12-16 20:27:15,011 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:15,011 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:27:15,012 - sqlalchemy.engine.Engine - INFO - [cached since 81.58s ago] (941971937,)
2025-12-16 20:27:15,014 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (telegram_id, username, first_name, last_name, phone, is_confirmed, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-12-16 20:27:15,014 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (941971937, 'pd56oren', 'Рафаэль', None, None, 0, '2025-12-16 17:27:15.014230')
2025-12-16 20:27:15,016 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:27:15,023 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:15,024 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:27:15,024 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (4, 'active')
2025-12-16 20:27:15,025 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:27:15,026 - sqlalchemy.engine.Engine - INFO - [cached since 81.6s ago] (941971937,)
2025-12-16 20:27:15,104 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:27:15,105 - aiogram.event - INFO - Update id=188256808 is handled. Duration 94 ms by bot id=8561542425
2025-12-16 20:27:23,365 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:23,366 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:27:23,366 - sqlalchemy.engine.Engine - INFO - [cached since 89.94s ago] (941971937,)
2025-12-16 20:27:23,367 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:27:23,369 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:23,369 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:27:23,369 - sqlalchemy.engine.Engine - INFO - [cached since 89.94s ago] (941971937,)
2025-12-16 20:27:23,607 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:27:23,608 - aiogram.event - INFO - Update id=188256809 is handled. Duration 250 ms by bot id=8561542425
2025-12-16 20:27:36,792 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:36,793 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:27:36,793 - sqlalchemy.engine.Engine - INFO - [cached since 103.4s ago] (941971937,)
2025-12-16 20:27:36,794 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:27:36,796 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:36,796 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:27:36,797 - sqlalchemy.engine.Engine - INFO - [cached since 103.4s ago] (941971937,)
2025-12-16 20:27:36,798 - sqlalchemy.engine.Engine - INFO - UPDATE users SET is_confirmed=? WHERE users.id = ?
2025-12-16 20:27:36,799 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] (1, 3)
2025-12-16 20:27:36,800 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:27:37,149 - aiogram.event - INFO - Update id=188256810 is handled. Duration 359 ms by bot id=8561542425
2025-12-16 20:27:51,817 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:51,817 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:27:51,818 - sqlalchemy.engine.Engine - INFO - [cached since 118.4s ago] (941971937,)
2025-12-16 20:27:51,819 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:27:51,820 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:51,821 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:27:51,821 - sqlalchemy.engine.Engine - INFO - [cached since 36.8s ago] (4, 'active')
2025-12-16 20:27:51,822 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:27:51,823 - sqlalchemy.engine.Engine - INFO - [cached since 118.4s ago] (941971937,)
2025-12-16 20:27:51,825 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 20:27:51,825 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] (4,)
2025-12-16 20:27:51,827 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 20:27:51,827 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] (3025.0, '2025-12-16 17:27:51.826554', '2025-12-16 21:27:51.826554', 4)
2025-12-16 20:27:51,830 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 20:27:51,830 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] (4, 3, 3025.0, '2025-12-16 17:27:51.830555')
2025-12-16 20:27:51,831 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:27:51,839 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:51,839 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:27:51,840 - sqlalchemy.engine.Engine - INFO - [cached since 104.4s ago] (4, 3, 0)
2025-12-16 20:27:51,841 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 20:27:51,842 - sqlalchemy.engine.Engine - INFO - [cached since 104.4s ago] (3,)
2025-12-16 20:27:51,843 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:27:51,843 - sqlalchemy.engine.Engine - INFO - [cached since 106.7s ago] (4,)
2025-12-16 20:27:51,845 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:27:51,846 - sqlalchemy.engine.Engine - INFO - [cached since 104.4s ago] (4,)
2025-12-16 20:27:51,955 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:51,956 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 20:27:51,957 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] (4, 3)
2025-12-16 20:27:51,958 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:27:51,959 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 20:27:51,965 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:27:51,970 - utils.timer - INFO - Таймер для аукциона #4 отменен
2025-12-16 20:27:52,083 - utils.timer - INFO - Таймер запущен для аукциона #4
2025-12-16 20:27:52,085 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:52,085 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:27:52,086 - sqlalchemy.engine.Engine - INFO - [cached since 123.2s ago] (4, 'active')
2025-12-16 20:27:52,087 - utils.periodic_updater - INFO - Обновляю аукцион #4, сообщение ID: 19
2025-12-16 20:27:52,087 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:27:52,088 - sqlalchemy.engine.Engine - INFO - [cached since 123.2s ago] (4, 3, 0)
2025-12-16 20:27:52,089 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:27:52,089 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:27:52,090 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:27:52,175 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:27:52,175 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:27:52,176 - sqlalchemy.engine.Engine - INFO - [cached since 123.3s ago] (4, 'active')
2025-12-16 20:27:52,177 - utils.periodic_updater - INFO - Обновляю аукцион #4, сообщение ID: 19
2025-12-16 20:27:52,177 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:27:52,178 - sqlalchemy.engine.Engine - INFO - [cached since 123.3s ago] (4, 3, 0)
2025-12-16 20:27:52,179 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:27:52,179 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:27:52,180 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:27:52,180 - aiogram.event - INFO - Update id=188256811 is handled. Duration 375 ms by bot id=8561542425
2025-12-16 20:28:36,041 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:28:36,042 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:28:36,042 - sqlalchemy.engine.Engine - INFO - [cached since 162.6s ago] (8148367074,)
2025-12-16 20:28:36,043 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:28:36,045 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:28:36,045 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:28:36,046 - sqlalchemy.engine.Engine - INFO - [cached since 81.02s ago] (4, 'active')
2025-12-16 20:28:36,047 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:28:36,048 - sqlalchemy.engine.Engine - INFO - [cached since 162.6s ago] (8148367074,)
2025-12-16 20:28:36,049 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 20:28:36,049 - sqlalchemy.engine.Engine - INFO - [cached since 44.22s ago] (4,)
2025-12-16 20:28:36,051 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 20:28:36,051 - sqlalchemy.engine.Engine - INFO - [cached since 44.22s ago] (3926.0, '2025-12-16 17:28:36.050416', '2025-12-16 21:28:36.050416', 4)
2025-12-16 20:28:36,054 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 20:28:36,055 - sqlalchemy.engine.Engine - INFO - [cached since 44.22s ago] (4, 1, 3926.0, '2025-12-16 17:28:36.054417')
2025-12-16 20:28:36,055 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:28:36,063 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:28:36,063 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:28:36,064 - sqlalchemy.engine.Engine - INFO - [cached since 148.6s ago] (4, 3, 0)
2025-12-16 20:28:36,066 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?, ?)
2025-12-16 20:28:36,066 - sqlalchemy.engine.Engine - INFO - [cached since 148.6s ago] (1, 3)
2025-12-16 20:28:36,081 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:28:36,082 - sqlalchemy.engine.Engine - INFO - [cached since 150.9s ago] (4,)
2025-12-16 20:28:36,083 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:28:36,084 - sqlalchemy.engine.Engine - INFO - [cached since 148.6s ago] (4,)
2025-12-16 20:28:36,344 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.id = ?
2025-12-16 20:28:36,344 - sqlalchemy.engine.Engine - INFO - [cached since 148.7s ago] (3,)
2025-12-16 20:28:36,479 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:28:36,480 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 20:28:36,486 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:28:36,492 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:28:36,493 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 20:28:36,493 - sqlalchemy.engine.Engine - INFO - [cached since 44.54s ago] (4, 1)
2025-12-16 20:28:36,494 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:28:36,496 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 20:28:36,501 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:28:36,507 - utils.timer - INFO - Таймер запущен для аукциона #4
2025-12-16 20:28:36,509 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:28:36,509 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:28:36,510 - sqlalchemy.engine.Engine - INFO - [cached since 167.6s ago] (4, 'active')
2025-12-16 20:28:36,511 - utils.periodic_updater - INFO - Обновляю аукцион #4, сообщение ID: 19
2025-12-16 20:28:36,511 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:28:36,512 - sqlalchemy.engine.Engine - INFO - [cached since 167.6s ago] (4, 3, 0)
2025-12-16 20:28:36,513 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:28:36,513 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:28:36,514 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:28:36,596 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:28:36,596 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:28:36,597 - sqlalchemy.engine.Engine - INFO - [cached since 167.7s ago] (4, 'active')
2025-12-16 20:28:36,598 - utils.periodic_updater - INFO - Обновляю аукцион #4, сообщение ID: 19
2025-12-16 20:28:36,598 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:28:36,598 - sqlalchemy.engine.Engine - INFO - [cached since 167.7s ago] (4, 3, 0)
2025-12-16 20:28:36,599 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:28:36,600 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:28:36,600 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:28:36,601 - aiogram.event - INFO - Update id=188256812 is handled. Duration 563 ms by bot id=8561542425
2025-12-16 20:29:02,594 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:02,595 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:02,595 - sqlalchemy.engine.Engine - INFO - [cached since 189.2s ago] (689062635,)
2025-12-16 20:29:02,596 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:02,598 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:02,598 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:29:02,599 - sqlalchemy.engine.Engine - INFO - [cached since 107.6s ago] (4, 'active')
2025-12-16 20:29:02,600 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:02,600 - sqlalchemy.engine.Engine - INFO - [cached since 189.2s ago] (689062635,)
2025-12-16 20:29:02,831 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:29:02,832 - aiogram.event - INFO - Update id=188256813 is handled. Duration 234 ms by bot id=8561542425
2025-12-16 20:29:05,898 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:05,899 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:05,899 - sqlalchemy.engine.Engine - INFO - [cached since 192.5s ago] (689062635,)
2025-12-16 20:29:05,900 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:05,902 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:05,902 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:05,903 - sqlalchemy.engine.Engine - INFO - [cached since 192.5s ago] (689062635,)
2025-12-16 20:29:05,904 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id = ?
2025-12-16 20:29:05,905 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] (4, 2)
2025-12-16 20:29:05,907 - sqlalchemy.engine.Engine - INFO - INSERT INTO auction_subscriptions (auction_id, user_id, created_at) VALUES (?, ?, ?)
2025-12-16 20:29:05,907 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] (4, 2, '2025-12-16 17:29:05.906890')
2025-12-16 20:29:05,908 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:29:05,999 - aiogram.event - INFO - Update id=188256814 is handled. Duration 108 ms by bot id=8561542425
2025-12-16 20:29:14,517 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:14,517 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:14,518 - sqlalchemy.engine.Engine - INFO - [cached since 201.1s ago] (689062635,)
2025-12-16 20:29:14,519 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:14,520 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:14,521 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:14,521 - sqlalchemy.engine.Engine - INFO - [cached since 201.1s ago] (689062635,)
2025-12-16 20:29:14,736 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:14,737 - aiogram.event - INFO - Update id=188256815 is handled. Duration 219 ms by bot id=8561542425
2025-12-16 20:29:19,777 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:19,778 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:19,778 - sqlalchemy.engine.Engine - INFO - [cached since 206.3s ago] (689062635,)
2025-12-16 20:29:19,780 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:19,781 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:19,782 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:19,782 - sqlalchemy.engine.Engine - INFO - [cached since 206.4s ago] (689062635,)
2025-12-16 20:29:19,783 - sqlalchemy.engine.Engine - INFO - UPDATE users SET is_confirmed=? WHERE users.id = ?
2025-12-16 20:29:19,784 - sqlalchemy.engine.Engine - INFO - [cached since 103s ago] (1, 2)
2025-12-16 20:29:19,785 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:29:19,966 - aiogram.event - INFO - Update id=188256816 is handled. Duration 186 ms by bot id=8561542425
2025-12-16 20:29:23,283 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:23,283 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:23,284 - sqlalchemy.engine.Engine - INFO - [cached since 209.9s ago] (689062635,)
2025-12-16 20:29:23,285 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:23,286 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:23,289 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids JOIN auctions ON auctions.id = bids.auction_id JOIN users ON users.id = auctions.winner_id 
WHERE users.telegram_id = ? ORDER BY bids.created_at DESC
2025-12-16 20:29:23,290 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] (8561542425,)
2025-12-16 20:29:23,411 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:23,513 - aiogram.event - INFO - Update id=188256817 is handled. Duration 234 ms by bot id=8561542425
2025-12-16 20:29:25,548 - aiogram.event - INFO - Update id=188256818 is handled. Duration 94 ms by bot id=8561542425
2025-12-16 20:29:30,532 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:30,532 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:30,533 - sqlalchemy.engine.Engine - INFO - [cached since 217.1s ago] (689062635,)
2025-12-16 20:29:30,534 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:30,536 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:30,537 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions JOIN users ON users.id = auctions.winner_id 
WHERE users.telegram_id = ? AND auctions.status = ? AND auctions.winner_id = users.id ORDER BY auctions.ended_at DESC
2025-12-16 20:29:30,537 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] (8561542425, 'ended')
2025-12-16 20:29:30,667 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:30,770 - aiogram.event - INFO - Update id=188256819 is handled. Duration 234 ms by bot id=8561542425
2025-12-16 20:29:33,823 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:33,823 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:33,824 - sqlalchemy.engine.Engine - INFO - [cached since 220.4s ago] (689062635,)
2025-12-16 20:29:33,825 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:33,826 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:33,828 - sqlalchemy.engine.Engine - INFO - SELECT notifications.id, notifications.user_id, notifications.auction_id, notifications.message, notifications.is_read, notifications.created_at 
FROM notifications JOIN users ON users.id = notifications.user_id 
WHERE users.telegram_id = ? ORDER BY notifications.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 20:29:33,828 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] (8561542425, 20, 0)
2025-12-16 20:29:33,976 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:34,107 - aiogram.event - INFO - Update id=188256820 is handled. Duration 282 ms by bot id=8561542425
2025-12-16 20:29:36,261 - aiogram.event - INFO - Update id=188256821 is handled. Duration 78 ms by bot id=8561542425
2025-12-16 20:29:39,144 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:39,144 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:39,145 - sqlalchemy.engine.Engine - INFO - [cached since 225.7s ago] (689062635,)
2025-12-16 20:29:39,146 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:39,415 - aiogram.event - INFO - Update id=188256822 is handled. Duration 280 ms by bot id=8561542425
2025-12-16 20:29:47,936 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:47,937 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:47,937 - sqlalchemy.engine.Engine - INFO - [cached since 234.5s ago] (689062635,)
2025-12-16 20:29:47,938 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:47,940 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:47,940 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 20:29:47,941 - sqlalchemy.engine.Engine - INFO - [cached since 222.8s ago] ('active',)
2025-12-16 20:29:47,942 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:29:47,943 - sqlalchemy.engine.Engine - INFO - [cached since 222.8s ago] (4,)
2025-12-16 20:29:48,080 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:48,081 - aiogram.event - INFO - Update id=188256823 is handled. Duration 140 ms by bot id=8561542425
2025-12-16 20:29:54,299 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:54,300 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:54,300 - sqlalchemy.engine.Engine - INFO - [cached since 240.9s ago] (689062635,)
2025-12-16 20:29:54,301 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:54,303 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:54,303 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:29:54,304 - sqlalchemy.engine.Engine - INFO - [cached since 226.8s ago] (4, 3, 0)
2025-12-16 20:29:54,305 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?, ?)
2025-12-16 20:29:54,305 - sqlalchemy.engine.Engine - INFO - [cached since 226.8s ago] (1, 3)
2025-12-16 20:29:54,541 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:54,542 - aiogram.event - INFO - Update id=188256824 is handled. Duration 250 ms by bot id=8561542425
2025-12-16 20:29:59,301 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:59,302 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:59,302 - sqlalchemy.engine.Engine - INFO - [cached since 245.9s ago] (689062635,)
2025-12-16 20:29:59,303 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:59,305 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:29:59,305 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:29:59,305 - sqlalchemy.engine.Engine - INFO - [cached since 164.3s ago] (4, 'active')
2025-12-16 20:29:59,307 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:29:59,307 - sqlalchemy.engine.Engine - INFO - [cached since 245.9s ago] (689062635,)
2025-12-16 20:29:59,308 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 20:29:59,309 - sqlalchemy.engine.Engine - INFO - [cached since 127.5s ago] (4,)
2025-12-16 20:29:59,310 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:29:59,311 - handlers.auction - ERROR - Ошибка при обработке ставки: Multiple rows were found when one or none was required
Traceback (most recent call last):
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\auction.py", line 71, in process_bid
    last_bid = result_last_bid.scalar_one_or_none()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 1499, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 810, in _only_one_row
    raise exc.MultipleResultsFound(
sqlalchemy.exc.MultipleResultsFound: Multiple rows were found when one or none was required
2025-12-16 20:29:59,393 - aiogram.event - INFO - Update id=188256825 is handled. Duration 94 ms by bot id=8561542425
2025-12-16 20:30:04,256 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:30:04,256 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:30:04,257 - sqlalchemy.engine.Engine - INFO - [cached since 250.8s ago] (689062635,)
2025-12-16 20:30:04,258 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:30:04,259 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:30:04,260 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:30:04,260 - sqlalchemy.engine.Engine - INFO - [cached since 169.2s ago] (4, 'active')
2025-12-16 20:30:04,261 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:30:04,262 - sqlalchemy.engine.Engine - INFO - [cached since 250.8s ago] (689062635,)
2025-12-16 20:30:04,263 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 20:30:04,264 - sqlalchemy.engine.Engine - INFO - [cached since 132.4s ago] (4,)
2025-12-16 20:30:04,265 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:30:04,265 - handlers.auction - ERROR - Ошибка при обработке ставки: Multiple rows were found when one or none was required
Traceback (most recent call last):
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\auction.py", line 71, in process_bid
    last_bid = result_last_bid.scalar_one_or_none()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 1499, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 810, in _only_one_row
    raise exc.MultipleResultsFound(
sqlalchemy.exc.MultipleResultsFound: Multiple rows were found when one or none was required
2025-12-16 20:30:04,451 - aiogram.event - INFO - Update id=188256826 is handled. Duration 203 ms by bot id=8561542425
2025-12-16 20:30:08,186 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:30:08,186 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:30:08,187 - sqlalchemy.engine.Engine - INFO - [cached since 254.8s ago] (689062635,)
2025-12-16 20:30:08,188 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:30:08,190 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:30:08,190 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:30:08,190 - sqlalchemy.engine.Engine - INFO - [cached since 254.8s ago] (689062635,)
2025-12-16 20:30:08,193 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id = ?
2025-12-16 20:30:08,193 - sqlalchemy.engine.Engine - INFO - [cached since 62.29s ago] (4, 2)
2025-12-16 20:30:08,276 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:30:08,277 - aiogram.event - INFO - Update id=188256827 is handled. Duration 94 ms by bot id=8561542425
2025-12-16 20:30:15,587 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:30:15,587 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:30:15,588 - sqlalchemy.engine.Engine - INFO - [cached since 262.2s ago] (689062635,)
2025-12-16 20:30:15,589 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:30:15,590 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:30:15,591 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 20:30:15,592 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] (4, 20, 0)
2025-12-16 20:30:15,593 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?, ?)
2025-12-16 20:30:15,594 - sqlalchemy.engine.Engine - INFO - [cached since 248.1s ago] (1, 3)
2025-12-16 20:30:15,949 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:30:15,950 - aiogram.event - INFO - Update id=188256828 is handled. Duration 375 ms by bot id=8561542425
2025-12-16 20:30:20,606 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:30:20,607 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:30:20,607 - sqlalchemy.engine.Engine - INFO - [cached since 267.2s ago] (689062635,)
2025-12-16 20:30:20,609 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:30:20,610 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:30:20,611 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:30:20,612 - sqlalchemy.engine.Engine - INFO - [cached since 185.6s ago] (4, 'active')
2025-12-16 20:30:20,613 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:30:20,614 - sqlalchemy.engine.Engine - INFO - [cached since 267.2s ago] (689062635,)
2025-12-16 20:30:20,615 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 20:30:20,616 - sqlalchemy.engine.Engine - INFO - [cached since 148.8s ago] (4,)
2025-12-16 20:30:20,617 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:30:20,618 - handlers.auction - ERROR - Ошибка при обработке ставки: Multiple rows were found when one or none was required
Traceback (most recent call last):
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\auction.py", line 71, in process_bid
    last_bid = result_last_bid.scalar_one_or_none()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 1499, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 810, in _only_one_row
    raise exc.MultipleResultsFound(
sqlalchemy.exc.MultipleResultsFound: Multiple rows were found when one or none was required
2025-12-16 20:30:20,701 - aiogram.event - INFO - Update id=188256829 is handled. Duration 92 ms by bot id=8561542425
2025-12-16 20:32:47,949 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 20:32:48,202 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_203248.db
2025-12-16 20:32:48,202 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 20:32:48,203 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 20:32:48,203 - utils.timer - INFO - Таймер для аукциона #4 отменен
2025-12-16 20:32:49,726 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:32:49,726 - utils.timer - INFO - Таймер для аукциона #4 отменен
2025-12-16 20:33:00,469 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:00,469 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 20:33:00,470 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:33:00,471 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 20:33:00,471 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:33:00,472 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 20:33:00,473 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:33:00,473 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 20:33:00,474 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:33:00,474 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 20:33:00,475 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:33:00,476 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:33:00,476 - __main__ - INFO - База данных инициализирована
2025-12-16 20:33:00,477 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 20:33:00,478 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_203300.db
2025-12-16 20:33:00,479 - __main__ - INFO - Резервная копия создана
2025-12-16 20:33:00,506 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:00,519 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 20:33:00,519 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] ('active', '2025-12-16 17:33:00.505303')
2025-12-16 20:33:00,521 - utils.timer - INFO - Таймер запущен для аукциона #4
2025-12-16 20:33:00,523 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:00,524 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:33:00,525 - sqlalchemy.engine.Engine - INFO - [generated in 0.00074s] (4, 'active')
2025-12-16 20:33:00,526 - utils.periodic_updater - INFO - Обновляю аукцион #4, сообщение ID: 19
2025-12-16 20:33:00,527 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:33:00,528 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] (4, 3, 0)
2025-12-16 20:33:00,529 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:33:00,530 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:00,530 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:33:00,531 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 20:33:00,532 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] ('active', '2025-12-16 17:33:00.531309')
2025-12-16 20:33:00,533 - utils.timer - INFO - Восстановлено 1 таймеров, завершено 0 аукционов
2025-12-16 20:33:00,534 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:00,534 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 20:33:00,535 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 20:33:00,535 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 20:33:00,535 - __main__ - INFO - Бот запущен
2025-12-16 20:33:00,535 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 20:33:00,535 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 20:33:00,536 - __main__ - INFO - Бот установлен: True
2025-12-16 20:33:00,536 - aiogram.dispatcher - INFO - Start polling
2025-12-16 20:33:00,540 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:00,542 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 20:33:00,542 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ('active',)
2025-12-16 20:33:00,544 - utils.periodic_updater - INFO - Периодическое обновление: найдено 1 активных аукционов
2025-12-16 20:33:00,544 - utils.periodic_updater - INFO - Обновляю аукцион #4, сообщение ID: 19
2025-12-16 20:33:00,545 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:33:00,545 - sqlalchemy.engine.Engine - INFO - [cached since 0.01802s ago] (4, 3, 0)
2025-12-16 20:33:00,547 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:33:00,547 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:33:00,547 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:00,864 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:33:08,664 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:08,665 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:33:08,666 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (8148367074,)
2025-12-16 20:33:08,667 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:08,939 - aiogram.event - INFO - Update id=188256830 is handled. Duration 280 ms by bot id=8561542425
2025-12-16 20:33:14,314 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:14,315 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:33:14,315 - sqlalchemy.engine.Engine - INFO - [cached since 5.651s ago] (8148367074,)
2025-12-16 20:33:14,317 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:14,318 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:14,319 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:33:14,320 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] ('active',)
2025-12-16 20:33:14,321 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:14,428 - aiogram.event - INFO - Update id=188256831 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 20:33:15,574 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:15,574 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:33:15,575 - sqlalchemy.engine.Engine - INFO - [cached since 6.91s ago] (8148367074,)
2025-12-16 20:33:15,576 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:15,578 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:15,579 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 20:33:15,580 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] ('active',)
2025-12-16 20:33:15,581 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:33:15,582 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] (4,)
2025-12-16 20:33:15,829 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:15,830 - aiogram.event - INFO - Update id=188256832 is handled. Duration 250 ms by bot id=8561542425
2025-12-16 20:33:17,240 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:17,240 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:33:17,241 - sqlalchemy.engine.Engine - INFO - [cached since 8.575s ago] (8148367074,)
2025-12-16 20:33:17,242 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:17,243 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:17,244 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:33:17,245 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] (4,)
2025-12-16 20:33:17,247 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 20:33:17,248 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] ('ended', '2025-12-16 17:33:17.246079', 4)
2025-12-16 20:33:17,250 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
2025-12-16 20:33:17,251 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (4,)
2025-12-16 20:33:17,252 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:17,253 - aiogram.event - INFO - Update id=188256833 is not handled. Duration 14 ms by bot id=8561542425
2025-12-16 20:33:17,253 - aiogram.event - ERROR - Cause exception while process update id=188256833 by bot id=8561542425
MultipleResultsFound: Multiple rows were found when one or none was required
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\rate_limit.py", line 23, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\user_check.py", line 34, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\admin.py", line 441, in admin_end_auction
    winner_bid = result_bids.scalar_one_or_none()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 1499, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 810, in _only_one_row
    raise exc.MultipleResultsFound(
sqlalchemy.exc.MultipleResultsFound: Multiple rows were found when one or none was required
2025-12-16 20:33:30,519 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:30,519 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:33:30,520 - sqlalchemy.engine.Engine - INFO - [cached since 21.85s ago] (8148367074,)
2025-12-16 20:33:30,522 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:30,524 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:30,524 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:33:30,525 - sqlalchemy.engine.Engine - INFO - [cached since 16.21s ago] ('active',)
2025-12-16 20:33:30,526 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:30,733 - aiogram.event - INFO - Update id=188256834 is handled. Duration 219 ms by bot id=8561542425
2025-12-16 20:33:34,783 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:34,784 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:33:34,784 - sqlalchemy.engine.Engine - INFO - [cached since 26.12s ago] (8148367074,)
2025-12-16 20:33:34,785 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:34,966 - aiogram.event - INFO - Update id=188256835 is handled. Duration 186 ms by bot id=8561542425
2025-12-16 20:33:36,241 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:36,242 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:33:36,242 - sqlalchemy.engine.Engine - INFO - [cached since 27.58s ago] (8148367074,)
2025-12-16 20:33:36,243 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:36,404 - aiogram.event - INFO - Update id=188256836 is handled. Duration 171 ms by bot id=8561542425
2025-12-16 20:33:46,279 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:46,279 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:33:46,280 - sqlalchemy.engine.Engine - INFO - [cached since 37.61s ago] (8148367074,)
2025-12-16 20:33:46,281 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:46,395 - aiogram.event - INFO - Update id=188256837 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 20:33:49,190 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:49,190 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:33:49,191 - sqlalchemy.engine.Engine - INFO - [cached since 40.53s ago] (8148367074,)
2025-12-16 20:33:49,192 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:49,353 - aiogram.event - INFO - Update id=188256838 is handled. Duration 172 ms by bot id=8561542425
2025-12-16 20:33:50,874 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:50,874 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:33:50,875 - sqlalchemy.engine.Engine - INFO - [cached since 42.21s ago] (8148367074,)
2025-12-16 20:33:50,876 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:50,878 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:50,879 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at, ended_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-16 20:33:50,879 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] ('1231223', '12312412', '["AgACAgIAAxkBAANYaUGTHoX56d19UlimBsWuSQABbeutAAI-EGsbwAoRSn0tatY0q7ajAQADAgADeQADNgQ"]', 10000.0, 1000.0, 10000.0, 'active', None, None, '2025-12-16 17:33:50.879294', '2025-12-16 17:33:50.879294', '2025-12-16 21:33:50.877294', None)
2025-12-16 20:33:50,881 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:33:50,888 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:50,890 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 20:33:50,890 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] ('1231223', 1, 0)
2025-12-16 20:33:50,892 - handlers.admin - INFO - Аукцион создан с ID: 5
2025-12-16 20:33:50,892 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:50,892 - utils.timer - INFO - Таймер запущен для аукциона #5
2025-12-16 20:33:50,893 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:50,894 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:33:50,895 - sqlalchemy.engine.Engine - INFO - [cached since 50.37s ago] (5, 'active')
2025-12-16 20:33:50,897 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:33:51,064 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:33:51,065 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:33:51,066 - sqlalchemy.engine.Engine - INFO - [cached since 33.82s ago] (5,)
2025-12-16 20:33:51,067 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-16 20:33:51,067 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (29, 5)
2025-12-16 20:33:51,069 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:33:51,236 - aiogram.event - INFO - Update id=188256839 is handled. Duration 360 ms by bot id=8561542425
2025-12-16 20:34:18,873 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:18,873 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:34:18,874 - sqlalchemy.engine.Engine - INFO - [cached since 70.21s ago] (689062635,)
2025-12-16 20:34:18,875 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:34:18,877 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:18,877 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:34:18,878 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] (5, 'active')
2025-12-16 20:34:18,879 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:34:18,880 - sqlalchemy.engine.Engine - INFO - [cached since 70.21s ago] (689062635,)
2025-12-16 20:34:18,881 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 20:34:18,882 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] (5,)
2025-12-16 20:34:18,884 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 20:34:18,884 - sqlalchemy.engine.Engine - INFO - [generated in 0.00042s] (11000.0, '2025-12-16 17:34:18.883086', '2025-12-16 21:34:18.883086', 5)
2025-12-16 20:34:18,886 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 20:34:18,886 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] (5, 2, 11000.0, '2025-12-16 17:34:18.886087')
2025-12-16 20:34:18,887 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:34:18,894 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:18,896 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:34:18,897 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (5, 3, 0)
2025-12-16 20:34:18,899 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 20:34:18,900 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] (2,)
2025-12-16 20:34:18,901 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:34:18,902 - sqlalchemy.engine.Engine - INFO - [cached since 63.32s ago] (5,)
2025-12-16 20:34:18,903 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:34:18,903 - sqlalchemy.engine.Engine - INFO - [cached since 61.66s ago] (5,)
2025-12-16 20:34:19,174 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:19,175 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 20:34:19,176 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] (5, 2)
2025-12-16 20:34:19,177 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:34:19,179 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 20:34:19,189 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:34:19,194 - utils.timer - INFO - Таймер для аукциона #5 отменен
2025-12-16 20:34:19,296 - utils.timer - INFO - Таймер запущен для аукциона #5
2025-12-16 20:34:19,298 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:19,298 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:34:19,299 - sqlalchemy.engine.Engine - INFO - [cached since 78.77s ago] (5, 'active')
2025-12-16 20:34:19,300 - utils.periodic_updater - INFO - Обновляю аукцион #5, сообщение ID: 29
2025-12-16 20:34:19,301 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:34:19,301 - sqlalchemy.engine.Engine - INFO - [cached since 78.77s ago] (5, 3, 0)
2025-12-16 20:34:19,302 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #5: 'Select' object has no attribute 'count'
2025-12-16 20:34:19,303 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:34:19,303 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #5: 'Select' object has no attribute 'count'
2025-12-16 20:34:19,403 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:19,403 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:34:19,404 - sqlalchemy.engine.Engine - INFO - [cached since 78.88s ago] (5, 'active')
2025-12-16 20:34:19,405 - utils.periodic_updater - INFO - Обновляю аукцион #5, сообщение ID: 29
2025-12-16 20:34:19,405 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:34:19,406 - sqlalchemy.engine.Engine - INFO - [cached since 78.88s ago] (5, 3, 0)
2025-12-16 20:34:19,407 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #5: 'Select' object has no attribute 'count'
2025-12-16 20:34:19,407 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:34:19,408 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #5: 'Select' object has no attribute 'count'
2025-12-16 20:34:19,408 - aiogram.event - INFO - Update id=188256840 is handled. Duration 532 ms by bot id=8561542425
2025-12-16 20:34:20,232 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:20,232 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:34:20,233 - sqlalchemy.engine.Engine - INFO - [cached since 71.57s ago] (8148367074,)
2025-12-16 20:34:20,234 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:34:20,235 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:20,236 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:34:20,236 - sqlalchemy.engine.Engine - INFO - [cached since 65.92s ago] ('active',)
2025-12-16 20:34:20,237 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:34:20,345 - aiogram.event - INFO - Update id=188256841 is handled. Duration 108 ms by bot id=8561542425
2025-12-16 20:34:30,153 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 20:34:30,322 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 1] [SSL: APPLICATION_DATA_AFTER_CLOSE_NOTIFY] application data after close notify (_ssl.c:2672)
2025-12-16 20:34:30,322 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8561542425)
2025-12-16 20:34:30,410 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_203430.db
2025-12-16 20:34:30,411 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 20:34:30,411 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 20:34:30,411 - utils.timer - INFO - Таймер для аукциона #4 отменен
2025-12-16 20:34:36,351 - utils.timer - INFO - Таймер для аукциона #5 отменен
2025-12-16 20:34:36,352 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:34:45,417 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:45,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 20:34:45,418 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:34:45,419 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 20:34:45,419 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:34:45,420 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 20:34:45,420 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:34:45,421 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 20:34:45,421 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:34:45,422 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 20:34:45,422 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:34:45,423 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:34:45,424 - __main__ - INFO - База данных инициализирована
2025-12-16 20:34:45,424 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 20:34:45,425 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_203445.db
2025-12-16 20:34:45,426 - __main__ - INFO - Резервная копия создана
2025-12-16 20:34:45,451 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:45,466 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 20:34:45,466 - sqlalchemy.engine.Engine - INFO - [generated in 0.00097s] ('active', '2025-12-16 17:34:45.450855')
2025-12-16 20:34:45,468 - utils.timer - INFO - Таймер запущен для аукциона #4
2025-12-16 20:34:45,469 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:45,470 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:34:45,471 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] (4, 'active')
2025-12-16 20:34:45,472 - utils.periodic_updater - INFO - Обновляю аукцион #4, сообщение ID: 19
2025-12-16 20:34:45,474 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:34:45,474 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] (4, 3, 0)
2025-12-16 20:34:45,475 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:34:45,476 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:34:45,476 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:34:45,477 - utils.timer - INFO - Таймер запущен для аукциона #5
2025-12-16 20:34:45,478 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:45,478 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:34:45,479 - sqlalchemy.engine.Engine - INFO - [cached since 0.008578s ago] (5, 'active')
2025-12-16 20:34:45,480 - utils.periodic_updater - INFO - Обновляю аукцион #5, сообщение ID: 29
2025-12-16 20:34:45,481 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:34:45,481 - sqlalchemy.engine.Engine - INFO - [cached since 0.007364s ago] (5, 3, 0)
2025-12-16 20:34:45,482 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #5: 'Select' object has no attribute 'count'
2025-12-16 20:34:45,483 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:34:45,483 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #5: 'Select' object has no attribute 'count'
2025-12-16 20:34:45,485 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 20:34:45,485 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] ('active', '2025-12-16 17:34:45.484863')
2025-12-16 20:34:45,487 - utils.timer - INFO - Восстановлено 2 таймеров, завершено 0 аукционов
2025-12-16 20:34:45,487 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:34:45,488 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 20:34:45,488 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 20:34:45,488 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 20:34:45,488 - __main__ - INFO - Бот запущен
2025-12-16 20:34:45,488 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 20:34:45,489 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 20:34:45,489 - __main__ - INFO - Бот установлен: True
2025-12-16 20:34:45,489 - aiogram.dispatcher - INFO - Start polling
2025-12-16 20:34:45,493 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:34:45,494 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 20:34:45,495 - sqlalchemy.engine.Engine - INFO - [generated in 0.00095s] ('active',)
2025-12-16 20:34:45,496 - utils.periodic_updater - INFO - Периодическое обновление: найдено 2 активных аукционов
2025-12-16 20:34:45,497 - utils.periodic_updater - INFO - Обновляю аукцион #4, сообщение ID: 19
2025-12-16 20:34:45,497 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:34:45,498 - sqlalchemy.engine.Engine - INFO - [cached since 0.02403s ago] (4, 3, 0)
2025-12-16 20:34:45,499 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:34:45,499 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #4: 'Select' object has no attribute 'count'
2025-12-16 20:34:45,500 - utils.periodic_updater - INFO - Обновляю аукцион #5, сообщение ID: 29
2025-12-16 20:34:45,500 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:34:45,501 - sqlalchemy.engine.Engine - INFO - [cached since 0.02693s ago] (5, 3, 0)
2025-12-16 20:34:45,502 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #5: 'Select' object has no attribute 'count'
2025-12-16 20:34:45,502 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #5: 'Select' object has no attribute 'count'
2025-12-16 20:34:45,502 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:34:45,720 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:35:19,589 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:35:19,591 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:35:19,591 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (8148367074,)
2025-12-16 20:35:19,592 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:35:19,594 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:35:19,595 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:35:19,596 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] (5, 'active')
2025-12-16 20:35:19,597 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:35:19,598 - sqlalchemy.engine.Engine - INFO - [cached since 0.007454s ago] (8148367074,)
2025-12-16 20:35:19,600 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 20:35:19,601 - sqlalchemy.engine.Engine - INFO - [generated in 0.00081s] (5,)
2025-12-16 20:35:19,603 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 20:35:19,604 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (12000.0, '2025-12-16 17:35:19.602787', '2025-12-16 21:35:19.602787', 5)
2025-12-16 20:35:19,607 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 20:35:19,607 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] (5, 1, 12000.0, '2025-12-16 17:35:19.607787')
2025-12-16 20:35:19,608 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:35:19,616 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:35:19,619 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:35:19,619 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] (5, 3, 0)
2025-12-16 20:35:19,622 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?, ?)
2025-12-16 20:35:19,623 - sqlalchemy.engine.Engine - INFO - [generated in 0.00104s] (1, 2)
2025-12-16 20:35:19,625 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:35:19,626 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] (5,)
2025-12-16 20:35:19,628 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:35:19,628 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] (5,)
2025-12-16 20:35:19,926 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.id = ?
2025-12-16 20:35:19,926 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] (2,)
2025-12-16 20:35:20,079 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:35:20,080 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 20:35:20,091 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:35:20,097 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:35:20,099 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 20:35:20,099 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (5, 1)
2025-12-16 20:35:20,101 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:35:20,102 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 20:35:20,107 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:35:20,111 - utils.timer - INFO - Таймер для аукциона #5 отменен
2025-12-16 20:35:20,213 - utils.timer - INFO - Таймер запущен для аукциона #5
2025-12-16 20:35:20,215 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:35:20,215 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:35:20,216 - sqlalchemy.engine.Engine - INFO - [cached since 34.75s ago] (5, 'active')
2025-12-16 20:35:20,217 - utils.periodic_updater - INFO - Обновляю аукцион #5, сообщение ID: 29
2025-12-16 20:35:20,217 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:35:20,218 - sqlalchemy.engine.Engine - INFO - [cached since 34.74s ago] (5, 3, 0)
2025-12-16 20:35:20,219 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #5: 'Select' object has no attribute 'count'
2025-12-16 20:35:20,219 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:35:20,220 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #5: 'Select' object has no attribute 'count'
2025-12-16 20:35:20,332 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:35:20,332 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:35:20,333 - sqlalchemy.engine.Engine - INFO - [cached since 34.86s ago] (5, 'active')
2025-12-16 20:35:20,334 - utils.periodic_updater - INFO - Обновляю аукцион #5, сообщение ID: 29
2025-12-16 20:35:20,335 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:35:20,335 - sqlalchemy.engine.Engine - INFO - [cached since 34.86s ago] (5, 3, 0)
2025-12-16 20:35:20,336 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #5: 'Select' object has no attribute 'count'
2025-12-16 20:35:20,336 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:35:20,337 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #5: 'Select' object has no attribute 'count'
2025-12-16 20:35:20,337 - aiogram.event - INFO - Update id=188256842 is handled. Duration 750 ms by bot id=8561542425
2025-12-16 20:36:14,584 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:36:14,585 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:36:14,585 - sqlalchemy.engine.Engine - INFO - [cached since 54.99s ago] (8148367074,)
2025-12-16 20:36:14,586 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:36:14,588 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:36:14,589 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 20:36:14,590 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] ('active',)
2025-12-16 20:36:14,592 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:36:14,592 - sqlalchemy.engine.Engine - INFO - [cached since 54.97s ago] (5,)
2025-12-16 20:36:14,837 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:36:14,838 - sqlalchemy.engine.Engine - INFO - [cached since 55.21s ago] (4,)
2025-12-16 20:36:15,037 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:36:15,038 - aiogram.event - INFO - Update id=188256843 is handled. Duration 469 ms by bot id=8561542425
2025-12-16 20:36:18,911 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:36:18,912 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:36:18,912 - sqlalchemy.engine.Engine - INFO - [cached since 59.32s ago] (8148367074,)
2025-12-16 20:36:18,914 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:36:18,915 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:36:18,916 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:36:18,916 - sqlalchemy.engine.Engine - INFO - [cached since 59.29s ago] (4,)
2025-12-16 20:36:18,918 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 20:36:18,919 - sqlalchemy.engine.Engine - INFO - [generated in 0.00047s] ('ended', '2025-12-16 17:36:18.917966', 4)
2025-12-16 20:36:18,920 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
2025-12-16 20:36:18,921 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (4,)
2025-12-16 20:36:18,922 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:36:18,923 - aiogram.event - INFO - Update id=188256844 is not handled. Duration 15 ms by bot id=8561542425
2025-12-16 20:36:18,924 - aiogram.event - ERROR - Cause exception while process update id=188256844 by bot id=8561542425
MultipleResultsFound: Multiple rows were found when one or none was required
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\rate_limit.py", line 23, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\user_check.py", line 34, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\admin.py", line 441, in admin_end_auction
    winner_bid = result_bids.scalar_one_or_none()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 1499, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 810, in _only_one_row
    raise exc.MultipleResultsFound(
sqlalchemy.exc.MultipleResultsFound: Multiple rows were found when one or none was required
2025-12-16 20:36:22,471 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:36:22,471 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:36:22,472 - sqlalchemy.engine.Engine - INFO - [cached since 62.88s ago] (8148367074,)
2025-12-16 20:36:22,473 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:36:22,474 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:36:22,475 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:36:22,475 - sqlalchemy.engine.Engine - INFO - [cached since 62.85s ago] (5,)
2025-12-16 20:36:22,478 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 20:36:22,478 - sqlalchemy.engine.Engine - INFO - [cached since 3.56s ago] ('ended', '2025-12-16 17:36:22.477774', 5)
2025-12-16 20:36:22,480 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
2025-12-16 20:36:22,481 - sqlalchemy.engine.Engine - INFO - [cached since 3.56s ago] (5,)
2025-12-16 20:36:22,482 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:36:22,483 - aiogram.event - INFO - Update id=188256845 is not handled. Duration 16 ms by bot id=8561542425
2025-12-16 20:36:22,483 - aiogram.event - ERROR - Cause exception while process update id=188256845 by bot id=8561542425
MultipleResultsFound: Multiple rows were found when one or none was required
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\rate_limit.py", line 23, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\user_check.py", line 34, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\admin.py", line 441, in admin_end_auction
    winner_bid = result_bids.scalar_one_or_none()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 1499, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 810, in _only_one_row
    raise exc.MultipleResultsFound(
sqlalchemy.exc.MultipleResultsFound: Multiple rows were found when one or none was required
2025-12-16 20:38:03,969 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:38:03,969 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:38:03,969 - sqlalchemy.engine.Engine - INFO - [cached since 164.4s ago] (8148367074,)
2025-12-16 20:38:03,971 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:38:03,972 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:38:03,973 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:38:03,973 - sqlalchemy.engine.Engine - INFO - [cached since 164.3s ago] (4,)
2025-12-16 20:38:03,975 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 20:38:03,976 - sqlalchemy.engine.Engine - INFO - [cached since 105.1s ago] ('ended', '2025-12-16 17:38:03.974212', 4)
2025-12-16 20:38:03,977 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
2025-12-16 20:38:03,978 - sqlalchemy.engine.Engine - INFO - [cached since 105.1s ago] (4,)
2025-12-16 20:38:03,979 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:38:03,980 - aiogram.event - INFO - Update id=188256846 is not handled. Duration 16 ms by bot id=8561542425
2025-12-16 20:38:03,980 - aiogram.event - ERROR - Cause exception while process update id=188256846 by bot id=8561542425
MultipleResultsFound: Multiple rows were found when one or none was required
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\rate_limit.py", line 23, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\user_check.py", line 34, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\admin.py", line 441, in admin_end_auction
    winner_bid = result_bids.scalar_one_or_none()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 1499, in scalar_one_or_none
    return self._only_one_row(
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\sqlalchemy\engine\result.py", line 810, in _only_one_row
    raise exc.MultipleResultsFound(
sqlalchemy.exc.MultipleResultsFound: Multiple rows were found when one or none was required
2025-12-16 20:38:57,342 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 20:38:57,593 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_203857.db
2025-12-16 20:38:57,594 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 20:38:57,594 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 20:38:57,594 - utils.timer - INFO - Таймер для аукциона #4 отменен
2025-12-16 20:39:04,421 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [Errno 1] [SSL: APPLICATION_DATA_AFTER_CLOSE_NOTIFY] application data after close notify (_ssl.c:2672)
2025-12-16 20:39:04,421 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8561542425)
2025-12-16 20:39:15,719 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 8561542425)
2025-12-16 20:41:55,167 - utils.timer - INFO - Таймер для аукциона #5 отменен
2025-12-16 20:41:55,167 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:42:21,434 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:21,435 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 20:42:21,435 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:42:21,436 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-12-16 20:42:21,436 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:42:21,437 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 20:42:21,437 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:42:21,438 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-16 20:42:21,438 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:42:21,439 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 20:42:21,439 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:42:21,440 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-16 20:42:21,440 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:42:21,441 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 20:42:21,441 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:42:21,442 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-16 20:42:21,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:42:21,443 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 20:42:21,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:42:21,445 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-16 20:42:21,445 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:42:21,446 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	username VARCHAR(100), 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	phone VARCHAR(20), 
	is_confirmed BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id)
)


2025-12-16 20:42:21,448 - sqlalchemy.engine.Engine - INFO - [no key 0.00145s] ()
2025-12-16 20:42:21,454 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_is_confirmed ON users (is_confirmed)
2025-12-16 20:42:21,455 - sqlalchemy.engine.Engine - INFO - [no key 0.00041s] ()
2025-12-16 20:42:21,460 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auctions (
	id INTEGER NOT NULL, 
	title VARCHAR(255) NOT NULL, 
	description TEXT, 
	photos TEXT, 
	start_price FLOAT NOT NULL, 
	step_price FLOAT NOT NULL, 
	current_price FLOAT NOT NULL, 
	status VARCHAR(20), 
	winner_id INTEGER, 
	channel_message_id INTEGER, 
	last_bid_time DATETIME, 
	created_at DATETIME, 
	ends_at DATETIME, 
	ended_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(winner_id) REFERENCES users (id)
)


2025-12-16 20:42:21,462 - sqlalchemy.engine.Engine - INFO - [no key 0.00138s] ()
2025-12-16 20:42:21,466 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_last_bid_time ON auctions (last_bid_time)
2025-12-16 20:42:21,466 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-12-16 20:42:21,471 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_created_at ON auctions (created_at)
2025-12-16 20:42:21,472 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-12-16 20:42:21,476 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_status ON auctions (status)
2025-12-16 20:42:21,477 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-12-16 20:42:21,482 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_title ON auctions (title)
2025-12-16 20:42:21,482 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-12-16 20:42:21,486 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_ends_at ON auctions (ends_at)
2025-12-16 20:42:21,486 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-12-16 20:42:21,492 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE bids (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	amount FLOAT NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-16 20:42:21,493 - sqlalchemy.engine.Engine - INFO - [no key 0.00096s] ()
2025-12-16 20:42:21,497 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_auction_user ON bids (auction_id, user_id)
2025-12-16 20:42:21,497 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-12-16 20:42:21,502 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_created_at ON bids (created_at)
2025-12-16 20:42:21,503 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-12-16 20:42:21,507 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_amount ON bids (amount)
2025-12-16 20:42:21,507 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-12-16 20:42:21,512 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auction_subscriptions (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-16 20:42:21,513 - sqlalchemy.engine.Engine - INFO - [no key 0.00087s] ()
2025-12-16 20:42:21,518 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_subscriptions_auction_user ON auction_subscriptions (auction_id, user_id)
2025-12-16 20:42:21,519 - sqlalchemy.engine.Engine - INFO - [no key 0.00046s] ()
2025-12-16 20:42:21,524 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE notifications (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	message TEXT NOT NULL, 
	is_read BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id)
)


2025-12-16 20:42:21,525 - sqlalchemy.engine.Engine - INFO - [no key 0.00103s] ()
2025-12-16 20:42:21,529 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_created_at ON notifications (created_at)
2025-12-16 20:42:21,530 - sqlalchemy.engine.Engine - INFO - [no key 0.00047s] ()
2025-12-16 20:42:21,535 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_user_read ON notifications (user_id, is_read)
2025-12-16 20:42:21,535 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-12-16 20:42:21,540 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:42:21,541 - __main__ - INFO - База данных инициализирована
2025-12-16 20:42:21,541 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 20:42:21,542 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_204221.db
2025-12-16 20:42:21,543 - __main__ - INFO - Резервная копия создана
2025-12-16 20:42:21,580 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:21,593 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 20:42:21,594 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] ('active', '2025-12-16 17:42:21.579458')
2025-12-16 20:42:21,596 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 20:42:21,597 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] ('active', '2025-12-16 17:42:21.596462')
2025-12-16 20:42:21,598 - utils.timer - INFO - Восстановлено 0 таймеров, завершено 0 аукционов
2025-12-16 20:42:21,598 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:21,599 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 20:42:21,599 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 20:42:21,600 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 20:42:21,600 - __main__ - INFO - Бот запущен
2025-12-16 20:42:21,600 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 20:42:21,600 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 20:42:21,600 - __main__ - INFO - Бот установлен: True
2025-12-16 20:42:21,600 - aiogram.dispatcher - INFO - Start polling
2025-12-16 20:42:21,605 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:21,607 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 20:42:21,607 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] ('active',)
2025-12-16 20:42:21,609 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:21,833 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:42:25,656 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:25,657 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:42:25,658 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] (8148367074,)
2025-12-16 20:42:25,660 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (telegram_id, username, first_name, last_name, phone, is_confirmed, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-12-16 20:42:25,661 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] (8148367074, 'ammuniti0n', 'dark triad', None, None, 0, '2025-12-16 17:42:25.660091')
2025-12-16 20:42:25,662 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:42:25,670 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:25,671 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:42:25,672 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] ('active',)
2025-12-16 20:42:25,674 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:25,971 - aiogram.event - INFO - Update id=188256847 is handled. Duration 311 ms by bot id=8561542425
2025-12-16 20:42:26,894 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:26,894 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:42:26,895 - sqlalchemy.engine.Engine - INFO - [cached since 1.238s ago] (8148367074,)
2025-12-16 20:42:26,896 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:26,898 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:26,898 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:42:26,898 - sqlalchemy.engine.Engine - INFO - [cached since 1.227s ago] ('active',)
2025-12-16 20:42:26,899 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:27,236 - aiogram.event - INFO - Update id=188256848 is handled. Duration 344 ms by bot id=8561542425
2025-12-16 20:42:29,718 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:29,719 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:42:29,719 - sqlalchemy.engine.Engine - INFO - [cached since 4.063s ago] (8148367074,)
2025-12-16 20:42:29,721 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:29,823 - aiogram.event - INFO - Update id=188256849 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 20:42:31,092 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:31,093 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:42:31,093 - sqlalchemy.engine.Engine - INFO - [cached since 5.436s ago] (8148367074,)
2025-12-16 20:42:31,094 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:31,232 - aiogram.event - INFO - Update id=188256850 is handled. Duration 141 ms by bot id=8561542425
2025-12-16 20:42:36,744 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:36,745 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:42:36,745 - sqlalchemy.engine.Engine - INFO - [cached since 11.09s ago] (8148367074,)
2025-12-16 20:42:36,746 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:36,857 - aiogram.event - INFO - Update id=188256851 is handled. Duration 110 ms by bot id=8561542425
2025-12-16 20:42:41,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:41,144 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:42:41,144 - sqlalchemy.engine.Engine - INFO - [cached since 15.49s ago] (8148367074,)
2025-12-16 20:42:41,146 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:41,261 - aiogram.event - INFO - Update id=188256852 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 20:42:42,991 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:42,992 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:42:42,992 - sqlalchemy.engine.Engine - INFO - [cached since 17.34s ago] (8148367074,)
2025-12-16 20:42:42,994 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:43,098 - aiogram.event - INFO - Update id=188256853 is handled. Duration 108 ms by bot id=8561542425
2025-12-16 20:42:48,151 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:48,151 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:42:48,152 - sqlalchemy.engine.Engine - INFO - [cached since 22.49s ago] (8148367074,)
2025-12-16 20:42:48,153 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:48,155 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:48,156 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at, ended_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-16 20:42:48,156 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] ('11111', '11111111', '["AgACAgIAAxkBAANYaUGTHoX56d19UlimBsWuSQABbeutAAI-EGsbwAoRSn0tatY0q7ajAQADAgADeQADNgQ"]', 100000.0, 10000.0, 100000.0, 'active', None, None, '2025-12-16 17:42:48.156064', '2025-12-16 17:42:48.156064', '2025-12-16 21:42:48.154063', None)
2025-12-16 20:42:48,158 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:42:48,165 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:48,166 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 20:42:48,166 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ('11111', 1, 0)
2025-12-16 20:42:48,168 - handlers.admin - INFO - Аукцион создан с ID: 1
2025-12-16 20:42:48,168 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:48,169 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 20:42:48,170 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:48,171 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:42:48,172 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] (1, 'active')
2025-12-16 20:42:48,174 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:48,341 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:48,342 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:42:48,343 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (1,)
2025-12-16 20:42:48,345 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-16 20:42:48,345 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (32, 1)
2025-12-16 20:42:48,346 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:42:48,510 - aiogram.event - INFO - Update id=188256854 is handled. Duration 359 ms by bot id=8561542425
2025-12-16 20:42:52,390 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:52,391 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:42:52,391 - sqlalchemy.engine.Engine - INFO - [cached since 26.73s ago] (8148367074,)
2025-12-16 20:42:52,392 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:42:52,394 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:42:52,395 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:42:52,395 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (1, 'active')
2025-12-16 20:42:52,397 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:42:52,397 - sqlalchemy.engine.Engine - INFO - [cached since 26.74s ago] (8148367074,)
2025-12-16 20:42:52,530 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:42:52,531 - aiogram.event - INFO - Update id=188256855 is handled. Duration 140 ms by bot id=8561542425
2025-12-16 20:43:03,767 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:43:03,767 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:43:03,768 - sqlalchemy.engine.Engine - INFO - [cached since 38.11s ago] (8148367074,)
2025-12-16 20:43:03,769 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:43:03,770 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:43:03,771 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:43:03,771 - sqlalchemy.engine.Engine - INFO - [cached since 38.1s ago] ('active',)
2025-12-16 20:43:03,772 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:43:03,891 - aiogram.event - INFO - Update id=188256856 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 20:43:06,863 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:43:06,863 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:43:06,864 - sqlalchemy.engine.Engine - INFO - [cached since 41.21s ago] (8148367074,)
2025-12-16 20:43:06,865 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:43:06,866 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:43:06,867 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 20:43:06,868 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] ('active',)
2025-12-16 20:43:06,870 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:43:06,870 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] (1,)
2025-12-16 20:43:07,139 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:43:07,140 - aiogram.event - INFO - Update id=188256857 is handled. Duration 280 ms by bot id=8561542425
2025-12-16 20:43:08,026 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:43:08,026 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:43:08,027 - sqlalchemy.engine.Engine - INFO - [cached since 42.37s ago] (8148367074,)
2025-12-16 20:43:08,028 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:43:08,029 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:43:08,030 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:43:08,030 - sqlalchemy.engine.Engine - INFO - [cached since 19.69s ago] (1,)
2025-12-16 20:43:08,031 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:43:08,032 - aiogram.event - INFO - Update id=188256858 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 20:43:08,033 - aiogram.event - ERROR - Cause exception while process update id=188256858 by bot id=8561542425
AttributeError: 'Auction' object has no attribute 'limit'
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\rate_limit.py", line 23, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\user_check.py", line 34, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\admin.py", line 426, in admin_end_auction
    auction = result.scalar_one_or_none().limit(1)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Auction' object has no attribute 'limit'
2025-12-16 20:43:35,232 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:43:35,232 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:43:35,233 - sqlalchemy.engine.Engine - INFO - [cached since 69.58s ago] (8148367074,)
2025-12-16 20:43:35,234 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:43:35,236 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:43:35,236 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:43:35,237 - sqlalchemy.engine.Engine - INFO - [cached since 46.89s ago] (1,)
2025-12-16 20:43:35,238 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:43:35,239 - aiogram.event - INFO - Update id=188256859 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 20:43:35,239 - aiogram.event - ERROR - Cause exception while process update id=188256859 by bot id=8561542425
AttributeError: 'Auction' object has no attribute 'limit'
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\rate_limit.py", line 23, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\user_check.py", line 34, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\admin.py", line 426, in admin_end_auction
    auction = result.scalar_one_or_none().limit(1)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Auction' object has no attribute 'limit'
2025-12-16 20:43:39,916 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 20:43:40,168 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_204340.db
2025-12-16 20:43:40,169 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 20:43:40,169 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 20:43:40,169 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 20:43:41,248 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:44:53,997 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:44:53,997 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 20:44:53,997 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:44:53,999 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 20:44:53,999 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:44:54,000 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 20:44:54,000 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:44:54,001 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 20:44:54,001 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:44:54,002 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 20:44:54,002 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:44:54,003 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:44:54,003 - __main__ - INFO - База данных инициализирована
2025-12-16 20:44:54,004 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 20:44:54,004 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_204454.db
2025-12-16 20:44:54,006 - __main__ - INFO - Резервная копия создана
2025-12-16 20:44:54,044 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:44:54,058 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 20:44:54,058 - sqlalchemy.engine.Engine - INFO - [generated in 0.00086s] ('active', '2025-12-16 17:44:54.043278')
2025-12-16 20:44:54,060 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 20:44:54,061 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:44:54,062 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:44:54,063 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] (1, 'active')
2025-12-16 20:44:54,065 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:44:54,066 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (1, 3, 0)
2025-12-16 20:44:54,068 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:44:54,068 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] (1,)
2025-12-16 20:44:54,582 - utils.periodic_updater - INFO - Принудительно обновлен аукцион #1
2025-12-16 20:44:54,583 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:44:54,585 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 20:44:54,585 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] ('active', '2025-12-16 17:44:54.584633')
2025-12-16 20:44:54,586 - utils.timer - INFO - Восстановлено 1 таймеров, завершено 0 аукционов
2025-12-16 20:44:54,586 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:44:54,587 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 20:44:54,587 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 20:44:54,588 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 20:44:54,588 - __main__ - INFO - Бот запущен
2025-12-16 20:44:54,588 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 20:44:54,588 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 20:44:54,588 - __main__ - INFO - Бот установлен: True
2025-12-16 20:44:54,588 - aiogram.dispatcher - INFO - Start polling
2025-12-16 20:44:54,590 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:44:54,591 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 20:44:54,592 - sqlalchemy.engine.Engine - INFO - [generated in 0.00083s] ('active',)
2025-12-16 20:44:54,593 - utils.periodic_updater - INFO - Периодическое обновление: найдено 1 активных аукционов
2025-12-16 20:44:54,594 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:44:54,594 - sqlalchemy.engine.Engine - INFO - [cached since 0.5295s ago] (1, 3, 0)
2025-12-16 20:44:54,595 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:44:54,596 - sqlalchemy.engine.Engine - INFO - [cached since 0.5281s ago] (1,)
2025-12-16 20:44:54,665 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:44:54,894 - utils.periodic_updater - WARNING - Не удалось обновить сообщение для аукциона #1: Telegram server says - Bad Request: there is no text in the message to edit
2025-12-16 20:44:54,895 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:08,025 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:08,026 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:45:08,027 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (8148367074,)
2025-12-16 20:45:08,028 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:08,029 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:08,030 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:45:08,031 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] (1,)
2025-12-16 20:45:08,033 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 20:45:08,034 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] ('ended', '2025-12-16 17:45:08.032598', 1)
2025-12-16 20:45:08,037 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:45:08,038 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] (1, 1, 0)
2025-12-16 20:45:08,039 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:08,040 - aiogram.event - INFO - Update id=188256860 is not handled. Duration 15 ms by bot id=8561542425
2025-12-16 20:45:08,040 - aiogram.event - ERROR - Cause exception while process update id=188256860 by bot id=8561542425
AttributeError: 'NoneType' object has no attribute 'limit'
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\rate_limit.py", line 23, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\user_check.py", line 34, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\admin.py", line 441, in admin_end_auction
    winner_bid = result_bids.scalar_one_or_none().limit(1)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'limit'
2025-12-16 20:45:19,351 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 20:45:19,619 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_204519.db
2025-12-16 20:45:19,621 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 20:45:19,621 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 20:45:19,621 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 20:45:26,353 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:45:37,638 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:37,638 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 20:45:37,639 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:45:37,640 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-12-16 20:45:37,640 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:45:37,641 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 20:45:37,641 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:45:37,642 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-16 20:45:37,642 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:45:37,643 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 20:45:37,643 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:45:37,644 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-16 20:45:37,644 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:45:37,645 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 20:45:37,645 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:45:37,646 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-16 20:45:37,646 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:45:37,647 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 20:45:37,647 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:45:37,648 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-16 20:45:37,648 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:45:37,649 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	username VARCHAR(100), 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	phone VARCHAR(20), 
	is_confirmed BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id)
)


2025-12-16 20:45:37,650 - sqlalchemy.engine.Engine - INFO - [no key 0.00091s] ()
2025-12-16 20:45:37,657 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_is_confirmed ON users (is_confirmed)
2025-12-16 20:45:37,658 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-12-16 20:45:37,662 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auctions (
	id INTEGER NOT NULL, 
	title VARCHAR(255) NOT NULL, 
	description TEXT, 
	photos TEXT, 
	start_price FLOAT NOT NULL, 
	step_price FLOAT NOT NULL, 
	current_price FLOAT NOT NULL, 
	status VARCHAR(20), 
	winner_id INTEGER, 
	channel_message_id INTEGER, 
	last_bid_time DATETIME, 
	created_at DATETIME, 
	ends_at DATETIME, 
	ended_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(winner_id) REFERENCES users (id)
)


2025-12-16 20:45:37,664 - sqlalchemy.engine.Engine - INFO - [no key 0.00171s] ()
2025-12-16 20:45:37,669 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_ends_at ON auctions (ends_at)
2025-12-16 20:45:37,670 - sqlalchemy.engine.Engine - INFO - [no key 0.00044s] ()
2025-12-16 20:45:37,674 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_last_bid_time ON auctions (last_bid_time)
2025-12-16 20:45:37,674 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-12-16 20:45:37,680 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_created_at ON auctions (created_at)
2025-12-16 20:45:37,680 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-12-16 20:45:37,684 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_title ON auctions (title)
2025-12-16 20:45:37,684 - sqlalchemy.engine.Engine - INFO - [no key 0.00034s] ()
2025-12-16 20:45:37,690 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_status ON auctions (status)
2025-12-16 20:45:37,690 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-12-16 20:45:37,695 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE bids (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	amount FLOAT NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-16 20:45:37,697 - sqlalchemy.engine.Engine - INFO - [no key 0.00132s] ()
2025-12-16 20:45:37,701 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_auction_user ON bids (auction_id, user_id)
2025-12-16 20:45:37,701 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-12-16 20:45:37,706 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_created_at ON bids (created_at)
2025-12-16 20:45:37,707 - sqlalchemy.engine.Engine - INFO - [no key 0.00038s] ()
2025-12-16 20:45:37,711 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_amount ON bids (amount)
2025-12-16 20:45:37,711 - sqlalchemy.engine.Engine - INFO - [no key 0.00039s] ()
2025-12-16 20:45:37,717 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auction_subscriptions (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-16 20:45:37,718 - sqlalchemy.engine.Engine - INFO - [no key 0.00090s] ()
2025-12-16 20:45:37,722 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_subscriptions_auction_user ON auction_subscriptions (auction_id, user_id)
2025-12-16 20:45:37,722 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-12-16 20:45:37,727 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE notifications (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	message TEXT NOT NULL, 
	is_read BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id)
)


2025-12-16 20:45:37,729 - sqlalchemy.engine.Engine - INFO - [no key 0.00142s] ()
2025-12-16 20:45:37,733 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_created_at ON notifications (created_at)
2025-12-16 20:45:37,734 - sqlalchemy.engine.Engine - INFO - [no key 0.00053s] ()
2025-12-16 20:45:37,739 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_user_read ON notifications (user_id, is_read)
2025-12-16 20:45:37,740 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-12-16 20:45:37,744 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:45:37,745 - __main__ - INFO - База данных инициализирована
2025-12-16 20:45:37,745 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 20:45:37,747 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_204537.db
2025-12-16 20:45:37,748 - __main__ - INFO - Резервная копия создана
2025-12-16 20:45:37,774 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:37,787 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 20:45:37,788 - sqlalchemy.engine.Engine - INFO - [generated in 0.00074s] ('active', '2025-12-16 17:45:37.773096')
2025-12-16 20:45:37,790 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 20:45:37,791 - sqlalchemy.engine.Engine - INFO - [generated in 0.00087s] ('active', '2025-12-16 17:45:37.790100')
2025-12-16 20:45:37,792 - utils.timer - INFO - Восстановлено 0 таймеров, завершено 0 аукционов
2025-12-16 20:45:37,792 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:37,793 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 20:45:37,794 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 20:45:37,794 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 20:45:37,794 - __main__ - INFO - Бот запущен
2025-12-16 20:45:37,794 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 20:45:37,794 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 20:45:37,794 - __main__ - INFO - Бот установлен: True
2025-12-16 20:45:37,794 - aiogram.dispatcher - INFO - Start polling
2025-12-16 20:45:37,799 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:37,800 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 20:45:37,801 - sqlalchemy.engine.Engine - INFO - [generated in 0.00108s] ('active',)
2025-12-16 20:45:37,802 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:38,030 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:45:38,357 - aiogram.event - INFO - Update id=188256861 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 20:45:40,015 - aiogram.event - INFO - Update id=188256862 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 20:45:46,349 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:46,350 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:45:46,351 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (8148367074,)
2025-12-16 20:45:46,353 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (telegram_id, username, first_name, last_name, phone, is_confirmed, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-12-16 20:45:46,354 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] (8148367074, 'ammuniti0n', 'dark triad', None, None, 0, '2025-12-16 17:45:46.353015')
2025-12-16 20:45:46,355 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:45:46,362 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:46,363 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:45:46,364 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] ('active',)
2025-12-16 20:45:46,365 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:46,626 - aiogram.event - INFO - Update id=188256863 is handled. Duration 280 ms by bot id=8561542425
2025-12-16 20:45:47,462 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:47,463 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:45:47,463 - sqlalchemy.engine.Engine - INFO - [cached since 1.113s ago] (8148367074,)
2025-12-16 20:45:47,464 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:47,466 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:47,466 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:45:47,466 - sqlalchemy.engine.Engine - INFO - [cached since 1.103s ago] ('active',)
2025-12-16 20:45:47,467 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:47,692 - aiogram.event - INFO - Update id=188256864 is handled. Duration 219 ms by bot id=8561542425
2025-12-16 20:45:49,517 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:49,517 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:45:49,517 - sqlalchemy.engine.Engine - INFO - [cached since 3.168s ago] (8148367074,)
2025-12-16 20:45:49,519 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:49,656 - aiogram.event - INFO - Update id=188256865 is handled. Duration 140 ms by bot id=8561542425
2025-12-16 20:45:50,611 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:50,611 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:45:50,612 - sqlalchemy.engine.Engine - INFO - [cached since 4.262s ago] (8148367074,)
2025-12-16 20:45:50,613 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:50,730 - aiogram.event - INFO - Update id=188256866 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 20:45:52,535 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:52,535 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:45:52,536 - sqlalchemy.engine.Engine - INFO - [cached since 6.186s ago] (8148367074,)
2025-12-16 20:45:52,537 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:52,649 - aiogram.event - INFO - Update id=188256867 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 20:45:54,319 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:54,320 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:45:54,320 - sqlalchemy.engine.Engine - INFO - [cached since 7.97s ago] (8148367074,)
2025-12-16 20:45:54,321 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:54,449 - aiogram.event - INFO - Update id=188256868 is handled. Duration 140 ms by bot id=8561542425
2025-12-16 20:45:56,305 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:56,305 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:45:56,305 - sqlalchemy.engine.Engine - INFO - [cached since 9.955s ago] (8148367074,)
2025-12-16 20:45:56,307 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:56,309 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:56,310 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at, ended_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-16 20:45:56,310 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] ('qfahsdafsh', 'fsagfsagafsg', '[]', 100.0, 10.0, 100.0, 'active', None, None, '2025-12-16 17:45:56.310273', '2025-12-16 17:45:56.310273', '2025-12-16 21:45:56.308273', None)
2025-12-16 20:45:56,312 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:45:56,318 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:56,319 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 20:45:56,320 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] ('qfahsdafsh', 1, 0)
2025-12-16 20:45:56,321 - handlers.admin - INFO - Аукцион создан с ID: 1
2025-12-16 20:45:56,322 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:56,322 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 20:45:56,323 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:56,325 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:45:56,326 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (1, 'active')
2025-12-16 20:45:56,328 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:45:56,694 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:45:56,695 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:45:56,695 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (1,)
2025-12-16 20:45:56,697 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-16 20:45:56,698 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (33, 1)
2025-12-16 20:45:56,699 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:45:56,945 - aiogram.event - INFO - Update id=188256869 is handled. Duration 655 ms by bot id=8561542425
2025-12-16 20:46:04,422 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:04,423 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:04,423 - sqlalchemy.engine.Engine - INFO - [cached since 18.07s ago] (8148367074,)
2025-12-16 20:46:04,424 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:04,426 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:04,426 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:46:04,427 - sqlalchemy.engine.Engine - INFO - [cached since 18.06s ago] ('active',)
2025-12-16 20:46:04,428 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:04,537 - aiogram.event - INFO - Update id=188256870 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 20:46:08,003 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:08,003 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:08,004 - sqlalchemy.engine.Engine - INFO - [cached since 21.65s ago] (8148367074,)
2025-12-16 20:46:08,005 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:08,006 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:08,007 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 20:46:08,008 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] ('active',)
2025-12-16 20:46:08,010 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:46:08,011 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] (1,)
2025-12-16 20:46:08,238 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:08,239 - aiogram.event - INFO - Update id=188256871 is handled. Duration 235 ms by bot id=8561542425
2025-12-16 20:46:09,530 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:09,531 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:09,532 - sqlalchemy.engine.Engine - INFO - [cached since 23.18s ago] (8148367074,)
2025-12-16 20:46:09,533 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:09,534 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:09,535 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:46:09,535 - sqlalchemy.engine.Engine - INFO - [cached since 12.84s ago] (1,)
2025-12-16 20:46:09,537 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 20:46:09,537 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] ('ended', '2025-12-16 17:46:09.536205', 1)
2025-12-16 20:46:09,540 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:46:09,540 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (1, 1, 0)
2025-12-16 20:46:09,541 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:09,542 - aiogram.event - INFO - Update id=188256872 is not handled. Duration 15 ms by bot id=8561542425
2025-12-16 20:46:09,542 - aiogram.event - ERROR - Cause exception while process update id=188256872 by bot id=8561542425
AttributeError: 'NoneType' object has no attribute 'limit'
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\rate_limit.py", line 23, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\user_check.py", line 34, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\admin.py", line 441, in admin_end_auction
    winner_bid = result_bids.scalar_one_or_none().limit(1)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'limit'
2025-12-16 20:46:41,621 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:41,622 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:41,622 - sqlalchemy.engine.Engine - INFO - [cached since 55.27s ago] (8148367074,)
2025-12-16 20:46:41,623 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:41,625 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:41,626 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:46:41,627 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] (1, 'active')
2025-12-16 20:46:41,629 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:41,629 - sqlalchemy.engine.Engine - INFO - [cached since 55.28s ago] (8148367074,)
2025-12-16 20:46:41,883 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:46:41,884 - aiogram.event - INFO - Update id=188256873 is handled. Duration 266 ms by bot id=8561542425
2025-12-16 20:46:45,460 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:45,460 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:45,461 - sqlalchemy.engine.Engine - INFO - [cached since 59.11s ago] (8148367074,)
2025-12-16 20:46:45,462 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:45,463 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:45,464 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:45,464 - sqlalchemy.engine.Engine - INFO - [cached since 59.11s ago] (8148367074,)
2025-12-16 20:46:46,037 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:46,039 - aiogram.event - INFO - Update id=188256874 is handled. Duration 578 ms by bot id=8561542425
2025-12-16 20:46:47,620 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:47,620 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:47,621 - sqlalchemy.engine.Engine - INFO - [cached since 61.27s ago] (8148367074,)
2025-12-16 20:46:47,622 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:47,623 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:47,624 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:47,624 - sqlalchemy.engine.Engine - INFO - [cached since 61.27s ago] (8148367074,)
2025-12-16 20:46:47,627 - sqlalchemy.engine.Engine - INFO - UPDATE users SET is_confirmed=? WHERE users.id = ?
2025-12-16 20:46:47,627 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] (1, 1)
2025-12-16 20:46:47,630 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:46:47,830 - aiogram.event - INFO - Update id=188256875 is handled. Duration 203 ms by bot id=8561542425
2025-12-16 20:46:50,503 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:50,503 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:50,504 - sqlalchemy.engine.Engine - INFO - [cached since 64.15s ago] (8148367074,)
2025-12-16 20:46:50,505 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:50,506 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:50,507 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:46:50,507 - sqlalchemy.engine.Engine - INFO - [cached since 8.881s ago] (1, 'active')
2025-12-16 20:46:50,509 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:50,510 - sqlalchemy.engine.Engine - INFO - [cached since 64.16s ago] (8148367074,)
2025-12-16 20:46:50,511 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 20:46:50,512 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (1,)
2025-12-16 20:46:50,514 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 20:46:50,514 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] (110.0, '2025-12-16 17:46:50.513737', '2025-12-16 21:46:50.513737', 1)
2025-12-16 20:46:50,516 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 20:46:50,517 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (1, 1, 110.0, '2025-12-16 17:46:50.516737')
2025-12-16 20:46:50,518 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:46:50,527 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:50,528 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:46:50,529 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] (1, 3, 0)
2025-12-16 20:46:50,532 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 20:46:50,532 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] (1,)
2025-12-16 20:46:50,534 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:46:50,535 - sqlalchemy.engine.Engine - INFO - [cached since 42.52s ago] (1,)
2025-12-16 20:46:50,536 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:46:50,536 - sqlalchemy.engine.Engine - INFO - [cached since 53.84s ago] (1,)
2025-12-16 20:46:50,751 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:50,752 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 20:46:50,752 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] (1, 1)
2025-12-16 20:46:50,753 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:46:50,755 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 20:46:50,766 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:46:50,770 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 20:46:50,883 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 20:46:50,885 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:50,885 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:46:50,886 - sqlalchemy.engine.Engine - INFO - [cached since 54.56s ago] (1, 'active')
2025-12-16 20:46:50,888 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:46:50,888 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] (1, 3, 0)
2025-12-16 20:46:50,890 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:46:50,890 - sqlalchemy.engine.Engine - INFO - [cached since 42.88s ago] (1,)
2025-12-16 20:46:50,892 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id = ?
2025-12-16 20:46:50,893 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] (1,)
2025-12-16 20:46:50,893 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #1: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 20:46:50,893 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:50,894 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #1: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 20:46:50,980 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:50,980 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:46:50,981 - sqlalchemy.engine.Engine - INFO - [cached since 54.66s ago] (1, 'active')
2025-12-16 20:46:50,982 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:46:50,983 - sqlalchemy.engine.Engine - INFO - [cached since 0.09517s ago] (1, 3, 0)
2025-12-16 20:46:50,984 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:46:50,984 - sqlalchemy.engine.Engine - INFO - [cached since 42.97s ago] (1,)
2025-12-16 20:46:50,985 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id = ?
2025-12-16 20:46:50,986 - sqlalchemy.engine.Engine - INFO - [cached since 0.09393s ago] (1,)
2025-12-16 20:46:50,986 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #1: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 20:46:50,986 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:50,987 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #1: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 20:46:50,988 - aiogram.event - INFO - Update id=188256876 is handled. Duration 485 ms by bot id=8561542425
2025-12-16 20:46:55,297 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:55,297 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:55,298 - sqlalchemy.engine.Engine - INFO - [cached since 68.95s ago] (8148367074,)
2025-12-16 20:46:55,299 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:55,300 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:55,301 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:46:55,301 - sqlalchemy.engine.Engine - INFO - [cached since 68.94s ago] ('active',)
2025-12-16 20:46:55,302 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:55,454 - aiogram.event - INFO - Update id=188256877 is handled. Duration 155 ms by bot id=8561542425
2025-12-16 20:46:57,264 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:57,265 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:57,265 - sqlalchemy.engine.Engine - INFO - [cached since 70.92s ago] (8148367074,)
2025-12-16 20:46:57,266 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:57,268 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:57,268 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 20:46:57,269 - sqlalchemy.engine.Engine - INFO - [cached since 49.26s ago] ('active',)
2025-12-16 20:46:57,270 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:46:57,270 - sqlalchemy.engine.Engine - INFO - [cached since 49.26s ago] (1,)
2025-12-16 20:46:57,570 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:57,571 - aiogram.event - INFO - Update id=188256878 is handled. Duration 311 ms by bot id=8561542425
2025-12-16 20:46:58,346 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:58,346 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:46:58,347 - sqlalchemy.engine.Engine - INFO - [cached since 72s ago] (8148367074,)
2025-12-16 20:46:58,348 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:58,350 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:46:58,350 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:46:58,351 - sqlalchemy.engine.Engine - INFO - [cached since 61.66s ago] (1,)
2025-12-16 20:46:58,352 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 20:46:58,352 - sqlalchemy.engine.Engine - INFO - [cached since 48.82s ago] ('ended', '2025-12-16 17:46:58.352667', 1)
2025-12-16 20:46:58,354 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:46:58,355 - sqlalchemy.engine.Engine - INFO - [cached since 48.82s ago] (1, 1, 0)
2025-12-16 20:46:58,356 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:46:58,357 - aiogram.event - INFO - Update id=188256879 is not handled. Duration 16 ms by bot id=8561542425
2025-12-16 20:46:58,357 - aiogram.event - ERROR - Cause exception while process update id=188256879 by bot id=8561542425
AttributeError: 'Bid' object has no attribute 'limit'
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\rate_limit.py", line 23, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\user_check.py", line 34, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\admin.py", line 441, in admin_end_auction
    winner_bid = result_bids.scalar_one_or_none().limit(1)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Bid' object has no attribute 'limit'
2025-12-16 20:47:31,213 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 20:47:31,466 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_204731.db
2025-12-16 20:47:31,467 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 20:47:31,467 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 20:47:31,467 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 20:47:31,468 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:47:31,468 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 20:48:22,523 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:22,524 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 20:48:22,524 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:48:22,525 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 20:48:22,525 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:48:22,526 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 20:48:22,526 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:48:22,527 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 20:48:22,527 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:48:22,528 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 20:48:22,528 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 20:48:22,529 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:48:22,530 - __main__ - INFO - База данных инициализирована
2025-12-16 20:48:22,530 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 20:48:22,531 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_204822.db
2025-12-16 20:48:22,533 - __main__ - INFO - Резервная копия создана
2025-12-16 20:48:22,572 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:22,585 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 20:48:22,586 - sqlalchemy.engine.Engine - INFO - [generated in 0.00083s] ('active', '2025-12-16 17:48:22.571185')
2025-12-16 20:48:22,587 - utils.timer - INFO - Таймер запущен для аукциона #1
2025-12-16 20:48:22,589 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:22,590 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:48:22,590 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (1, 'active')
2025-12-16 20:48:22,593 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:48:22,594 - sqlalchemy.engine.Engine - INFO - [generated in 0.00082s] (1, 3, 0)
2025-12-16 20:48:22,597 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:48:22,597 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] (1,)
2025-12-16 20:48:22,601 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id = ?
2025-12-16 20:48:22,601 - sqlalchemy.engine.Engine - INFO - [generated in 0.00069s] (1,)
2025-12-16 20:48:22,602 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #1: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 20:48:22,602 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:22,603 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #1: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 20:48:22,604 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 20:48:22,604 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] ('active', '2025-12-16 17:48:22.603192')
2025-12-16 20:48:22,606 - utils.timer - INFO - Восстановлено 1 таймеров, завершено 0 аукционов
2025-12-16 20:48:22,606 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:22,607 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 20:48:22,607 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 20:48:22,607 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 20:48:22,607 - __main__ - INFO - Бот запущен
2025-12-16 20:48:22,608 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 20:48:22,608 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 20:48:22,608 - __main__ - INFO - Бот установлен: True
2025-12-16 20:48:22,608 - aiogram.dispatcher - INFO - Start polling
2025-12-16 20:48:22,612 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:22,614 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 20:48:22,614 - sqlalchemy.engine.Engine - INFO - [generated in 0.00095s] ('active',)
2025-12-16 20:48:22,616 - utils.periodic_updater - INFO - Периодическое обновление: найдено 1 активных аукционов
2025-12-16 20:48:22,616 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:48:22,617 - sqlalchemy.engine.Engine - INFO - [cached since 0.02367s ago] (1, 3, 0)
2025-12-16 20:48:22,619 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:48:22,619 - sqlalchemy.engine.Engine - INFO - [cached since 0.02279s ago] (1,)
2025-12-16 20:48:22,621 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id = ?
2025-12-16 20:48:22,622 - sqlalchemy.engine.Engine - INFO - [cached since 0.02107s ago] (1,)
2025-12-16 20:48:22,622 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #1: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 20:48:22,622 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #1: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 20:48:22,623 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:22,843 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 20:48:25,395 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:25,396 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:25,397 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (8148367074,)
2025-12-16 20:48:25,398 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:25,400 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:25,402 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:48:25,403 - sqlalchemy.engine.Engine - INFO - [generated in 0.00084s] (1,)
2025-12-16 20:48:25,406 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 20:48:25,407 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] ('ended', '2025-12-16 17:48:25.404823', 1)
2025-12-16 20:48:25,410 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:48:25,411 - sqlalchemy.engine.Engine - INFO - [generated in 0.00087s] (1, 1, 0)
2025-12-16 20:48:25,413 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET winner_id=? WHERE auctions.id = ?
2025-12-16 20:48:25,413 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] (1, 1)
2025-12-16 20:48:25,414 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:48:25,420 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:25,423 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:48:25,423 - sqlalchemy.engine.Engine - INFO - [generated in 0.00064s] (1,)
2025-12-16 20:48:25,425 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 20:48:25,426 - sqlalchemy.engine.Engine - INFO - [generated in 0.00101s] (1,)
2025-12-16 20:48:25,430 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:48:25,431 - sqlalchemy.engine.Engine - INFO - [generated in 0.00105s] (1, 3, 0)
2025-12-16 20:48:25,433 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 20:48:25,434 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] (1,)
2025-12-16 20:48:25,436 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:48:25,436 - sqlalchemy.engine.Engine - INFO - [cached since 2.84s ago] (1,)
2025-12-16 20:48:25,800 - handlers.admin - INFO - Сообщение в канале для аукциона #1 обновлено (админское завершение)
2025-12-16 20:48:25,802 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:25,803 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.id = ?
2025-12-16 20:48:25,803 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] (1,)
2025-12-16 20:48:25,804 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:25,805 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:25,806 - aiogram.event - INFO - Update id=188256880 is not handled. Duration 421 ms by bot id=8561542425
2025-12-16 20:48:25,807 - aiogram.event - ERROR - Cause exception while process update id=188256880 by bot id=8561542425
AttributeError: 'User' object has no attribute 'limit'
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\rate_limit.py", line 23, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\user_check.py", line 34, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\admin.py", line 499, in admin_end_auction
    winner = result_winner.scalar_one_or_none().limit(1)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'User' object has no attribute 'limit'
2025-12-16 20:48:41,081 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:41,082 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:41,083 - sqlalchemy.engine.Engine - INFO - [cached since 15.69s ago] (8148367074,)
2025-12-16 20:48:41,084 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:41,085 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:41,086 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:48:41,087 - sqlalchemy.engine.Engine - INFO - [generated in 0.00044s] ('active',)
2025-12-16 20:48:41,088 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:41,335 - aiogram.event - INFO - Update id=188256881 is handled. Duration 265 ms by bot id=8561542425
2025-12-16 20:48:42,393 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:42,394 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:42,394 - sqlalchemy.engine.Engine - INFO - [cached since 17s ago] (8148367074,)
2025-12-16 20:48:42,395 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:42,397 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:42,398 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 20:48:42,398 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] ('active',)
2025-12-16 20:48:42,585 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:42,586 - aiogram.event - INFO - Update id=188256882 is handled. Duration 202 ms by bot id=8561542425
2025-12-16 20:48:43,608 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:43,609 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:43,609 - sqlalchemy.engine.Engine - INFO - [cached since 18.21s ago] (8148367074,)
2025-12-16 20:48:43,610 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:43,612 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:43,612 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:48:43,612 - sqlalchemy.engine.Engine - INFO - [cached since 2.527s ago] ('active',)
2025-12-16 20:48:43,614 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:43,806 - aiogram.event - INFO - Update id=188256883 is handled. Duration 202 ms by bot id=8561542425
2025-12-16 20:48:45,699 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:45,699 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:45,700 - sqlalchemy.engine.Engine - INFO - [cached since 20.3s ago] (8148367074,)
2025-12-16 20:48:45,701 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:45,803 - aiogram.event - INFO - Update id=188256884 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 20:48:46,721 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:46,722 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:46,722 - sqlalchemy.engine.Engine - INFO - [cached since 21.33s ago] (8148367074,)
2025-12-16 20:48:46,724 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:46,827 - aiogram.event - INFO - Update id=188256885 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 20:48:47,849 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:47,850 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:47,850 - sqlalchemy.engine.Engine - INFO - [cached since 22.45s ago] (8148367074,)
2025-12-16 20:48:47,851 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:47,953 - aiogram.event - INFO - Update id=188256886 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 20:48:49,679 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:49,680 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:49,680 - sqlalchemy.engine.Engine - INFO - [cached since 24.28s ago] (8148367074,)
2025-12-16 20:48:49,681 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:49,804 - aiogram.event - INFO - Update id=188256887 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 20:48:50,568 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:50,569 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:50,569 - sqlalchemy.engine.Engine - INFO - [cached since 25.17s ago] (8148367074,)
2025-12-16 20:48:50,570 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:50,688 - aiogram.event - INFO - Update id=188256888 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 20:48:51,727 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:51,727 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:51,728 - sqlalchemy.engine.Engine - INFO - [cached since 26.33s ago] (8148367074,)
2025-12-16 20:48:51,729 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:51,822 - aiogram.event - INFO - Update id=188256889 is handled. Duration 92 ms by bot id=8561542425
2025-12-16 20:48:53,508 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:53,508 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:53,509 - sqlalchemy.engine.Engine - INFO - [cached since 28.11s ago] (8148367074,)
2025-12-16 20:48:53,510 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:53,512 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:53,513 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at, ended_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-16 20:48:53,514 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] ('asdasdas', 'asfbasfbasfb', '[]', 21214.0, 12412.0, 21214.0, 'active', None, None, '2025-12-16 17:48:53.513819', '2025-12-16 17:48:53.513819', '2025-12-16 21:48:53.511818', None)
2025-12-16 20:48:53,515 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:48:53,522 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:53,523 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 20:48:53,523 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] ('asdasdas', 1, 0)
2025-12-16 20:48:53,525 - handlers.admin - INFO - Аукцион создан с ID: 2
2025-12-16 20:48:53,525 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:53,525 - utils.timer - INFO - Таймер запущен для аукциона #2
2025-12-16 20:48:53,526 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:53,527 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:48:53,527 - sqlalchemy.engine.Engine - INFO - [cached since 30.94s ago] (2, 'active')
2025-12-16 20:48:53,529 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:53,691 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:53,691 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:48:53,692 - sqlalchemy.engine.Engine - INFO - [cached since 28.29s ago] (2,)
2025-12-16 20:48:53,694 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-16 20:48:53,694 - sqlalchemy.engine.Engine - INFO - [generated in 0.00048s] (34, 2)
2025-12-16 20:48:53,696 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:48:53,879 - aiogram.event - INFO - Update id=188256890 is handled. Duration 358 ms by bot id=8561542425
2025-12-16 20:48:56,498 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:56,498 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:56,499 - sqlalchemy.engine.Engine - INFO - [cached since 31.1s ago] (8148367074,)
2025-12-16 20:48:56,500 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:56,501 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:56,502 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 20:48:56,503 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] (2, 'active')
2025-12-16 20:48:56,504 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:48:56,505 - sqlalchemy.engine.Engine - INFO - [cached since 31.11s ago] (8148367074,)
2025-12-16 20:48:56,506 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 20:48:56,507 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (2,)
2025-12-16 20:48:56,509 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 20:48:56,509 - sqlalchemy.engine.Engine - INFO - [generated in 0.00039s] (33626.0, '2025-12-16 17:48:56.508406', '2025-12-16 21:48:56.508406', 2)
2025-12-16 20:48:56,511 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 20:48:56,512 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (2, 1, 33626.0, '2025-12-16 17:48:56.511406')
2025-12-16 20:48:56,513 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:48:56,521 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:56,521 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:48:56,522 - sqlalchemy.engine.Engine - INFO - [cached since 31.09s ago] (2, 3, 0)
2025-12-16 20:48:56,523 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 20:48:56,524 - sqlalchemy.engine.Engine - INFO - [cached since 31.09s ago] (1,)
2025-12-16 20:48:56,525 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:48:56,526 - sqlalchemy.engine.Engine - INFO - [cached since 33.93s ago] (2,)
2025-12-16 20:48:56,527 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:48:56,527 - sqlalchemy.engine.Engine - INFO - [cached since 31.13s ago] (2,)
2025-12-16 20:48:56,776 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:56,777 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 20:48:56,778 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] (2, 1)
2025-12-16 20:48:56,779 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:48:56,780 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 20:48:56,792 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:48:56,797 - utils.timer - INFO - Таймер для аукциона #2 отменен
2025-12-16 20:48:56,902 - utils.timer - INFO - Таймер запущен для аукциона #2
2025-12-16 20:48:56,904 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:56,904 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:48:56,905 - sqlalchemy.engine.Engine - INFO - [cached since 34.32s ago] (2, 'active')
2025-12-16 20:48:56,906 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:48:56,906 - sqlalchemy.engine.Engine - INFO - [cached since 34.31s ago] (2, 3, 0)
2025-12-16 20:48:56,908 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:48:56,908 - sqlalchemy.engine.Engine - INFO - [cached since 34.31s ago] (2,)
2025-12-16 20:48:56,909 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id = ?
2025-12-16 20:48:56,910 - sqlalchemy.engine.Engine - INFO - [cached since 34.31s ago] (1,)
2025-12-16 20:48:56,910 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #2: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 20:48:56,911 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:56,912 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #2: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 20:48:56,995 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:48:56,996 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 20:48:56,996 - sqlalchemy.engine.Engine - INFO - [cached since 34.41s ago] (2, 'active')
2025-12-16 20:48:56,997 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:48:56,998 - sqlalchemy.engine.Engine - INFO - [cached since 34.4s ago] (2, 3, 0)
2025-12-16 20:48:56,999 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:48:57,000 - sqlalchemy.engine.Engine - INFO - [cached since 34.4s ago] (2,)
2025-12-16 20:48:57,001 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id = ?
2025-12-16 20:48:57,001 - sqlalchemy.engine.Engine - INFO - [cached since 34.4s ago] (1,)
2025-12-16 20:48:57,002 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #2: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 20:48:57,002 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:48:57,003 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #2: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 20:48:57,003 - aiogram.event - INFO - Update id=188256891 is handled. Duration 500 ms by bot id=8561542425
2025-12-16 20:49:00,143 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:49:00,143 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:49:00,144 - sqlalchemy.engine.Engine - INFO - [cached since 34.75s ago] (8148367074,)
2025-12-16 20:49:00,145 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:49:00,147 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:49:00,147 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 20:49:00,147 - sqlalchemy.engine.Engine - INFO - [cached since 19.06s ago] ('active',)
2025-12-16 20:49:00,148 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:49:00,347 - aiogram.event - INFO - Update id=188256892 is handled. Duration 202 ms by bot id=8561542425
2025-12-16 20:49:01,071 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:49:01,071 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:49:01,072 - sqlalchemy.engine.Engine - INFO - [cached since 35.67s ago] (8148367074,)
2025-12-16 20:49:01,073 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:49:01,075 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:49:01,075 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 20:49:01,076 - sqlalchemy.engine.Engine - INFO - [cached since 18.68s ago] ('active',)
2025-12-16 20:49:01,077 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:49:01,077 - sqlalchemy.engine.Engine - INFO - [cached since 38.48s ago] (2,)
2025-12-16 20:49:01,479 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:49:01,480 - aiogram.event - INFO - Update id=188256893 is handled. Duration 422 ms by bot id=8561542425
2025-12-16 20:49:02,168 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:49:02,169 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:49:02,169 - sqlalchemy.engine.Engine - INFO - [cached since 36.77s ago] (8148367074,)
2025-12-16 20:49:02,170 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:49:02,172 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:49:02,173 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:49:02,173 - sqlalchemy.engine.Engine - INFO - [cached since 36.77s ago] (2,)
2025-12-16 20:49:02,175 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 20:49:02,175 - sqlalchemy.engine.Engine - INFO - [cached since 36.77s ago] ('ended', '2025-12-16 17:49:02.174992', 2)
2025-12-16 20:49:02,176 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:49:02,177 - sqlalchemy.engine.Engine - INFO - [cached since 36.77s ago] (2, 1, 0)
2025-12-16 20:49:02,178 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET winner_id=? WHERE auctions.id = ?
2025-12-16 20:49:02,178 - sqlalchemy.engine.Engine - INFO - [cached since 36.77s ago] (1, 2)
2025-12-16 20:49:02,179 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:49:02,186 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:49:02,186 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:49:02,187 - sqlalchemy.engine.Engine - INFO - [cached since 36.76s ago] (2,)
2025-12-16 20:49:02,189 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 20:49:02,189 - sqlalchemy.engine.Engine - INFO - [cached since 36.76s ago] (1,)
2025-12-16 20:49:02,191 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 20:49:02,191 - sqlalchemy.engine.Engine - INFO - [cached since 36.76s ago] (2, 3, 0)
2025-12-16 20:49:02,193 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 20:49:02,193 - sqlalchemy.engine.Engine - INFO - [cached since 36.76s ago] (1,)
2025-12-16 20:49:02,195 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 20:49:02,195 - sqlalchemy.engine.Engine - INFO - [cached since 39.6s ago] (2,)
2025-12-16 20:49:02,417 - handlers.admin - INFO - Сообщение в канале для аукциона #2 обновлено (админское завершение)
2025-12-16 20:49:02,418 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:49:02,419 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.id = ?
2025-12-16 20:49:02,419 - sqlalchemy.engine.Engine - INFO - [cached since 36.62s ago] (1,)
2025-12-16 20:49:02,420 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:49:02,421 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:49:02,422 - aiogram.event - INFO - Update id=188256894 is not handled. Duration 250 ms by bot id=8561542425
2025-12-16 20:49:02,422 - aiogram.event - ERROR - Cause exception while process update id=188256894 by bot id=8561542425
AttributeError: 'User' object has no attribute 'limit'
Traceback (most recent call last):
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\rate_limit.py", line 23, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "O:\CODE\TG BOTS\PIT AUC v0.3\middlewares\user_check.py", line 34, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\nekit\AppData\Roaming\Python\Python311\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "C:\Program Files\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "O:\CODE\TG BOTS\PIT AUC v0.3\database\database.py", line 29, in get_db
    yield session
  File "O:\CODE\TG BOTS\PIT AUC v0.3\handlers\admin.py", line 499, in admin_end_auction
    winner = result_winner.scalar_one_or_none().limit(1)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'User' object has no attribute 'limit'
2025-12-16 20:49:21,347 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:49:21,348 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 20:49:21,348 - sqlalchemy.engine.Engine - INFO - [cached since 55.95s ago] (8148367074,)
2025-12-16 20:49:21,349 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 20:49:21,351 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 20:49:21,351 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 20:49:21,352 - sqlalchemy.engine.Engine - INFO - [cached since 55.95s ago] (2,)
2025-12-16 20:49:21,586 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 20:49:21,587 - aiogram.event - INFO - Update id=188256895 is handled. Duration 250 ms by bot id=8561542425
2025-12-16 20:49:25,670 - aiogram.event - INFO - Update id=188256896 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 20:56:33,109 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 20:56:33,372 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_205633.db
2025-12-16 20:56:33,373 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 20:56:33,373 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 20:56:33,373 - utils.timer - INFO - Таймер для аукциона #1 отменен
2025-12-16 20:56:34,003 - utils.timer - INFO - Таймер для аукциона #2 отменен
2025-12-16 20:56:34,003 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 21:01:42,780 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:42,781 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 21:01:42,781 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:01:42,782 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 21:01:42,783 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:01:42,784 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 21:01:42,784 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:01:42,785 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 21:01:42,785 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:01:42,786 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 21:01:42,786 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:01:42,787 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:01:42,787 - __main__ - INFO - База данных инициализирована
2025-12-16 21:01:42,788 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 21:01:42,789 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_210142.db
2025-12-16 21:01:42,790 - __main__ - INFO - Резервная копия создана
2025-12-16 21:01:42,818 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:42,832 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 21:01:42,833 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] ('active', '2025-12-16 18:01:42.817981')
2025-12-16 21:01:42,835 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 21:01:42,836 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ('active', '2025-12-16 18:01:42.834985')
2025-12-16 21:01:42,837 - utils.timer - INFO - Восстановлено 0 таймеров, завершено 0 аукционов
2025-12-16 21:01:42,837 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:42,838 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 21:01:42,838 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 21:01:42,838 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 21:01:42,838 - __main__ - INFO - Бот запущен
2025-12-16 21:01:42,839 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 21:01:42,839 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 21:01:42,839 - __main__ - INFO - Бот установлен: True
2025-12-16 21:01:42,839 - aiogram.dispatcher - INFO - Start polling
2025-12-16 21:01:42,843 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:42,845 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 21:01:42,846 - sqlalchemy.engine.Engine - INFO - [generated in 0.00096s] ('active',)
2025-12-16 21:01:42,847 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:43,089 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 21:01:47,251 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:47,252 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:01:47,253 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] (8148367074,)
2025-12-16 21:01:47,254 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:47,256 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:47,257 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 21:01:47,258 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] ('active',)
2025-12-16 21:01:47,259 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:47,562 - aiogram.event - INFO - Update id=188256897 is handled. Duration 313 ms by bot id=8561542425
2025-12-16 21:01:48,269 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:48,270 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:01:48,270 - sqlalchemy.engine.Engine - INFO - [cached since 1.018s ago] (8148367074,)
2025-12-16 21:01:48,271 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:48,273 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:48,274 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 21:01:48,274 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] ('active',)
2025-12-16 21:01:48,550 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:48,551 - aiogram.event - INFO - Update id=188256898 is handled. Duration 280 ms by bot id=8561542425
2025-12-16 21:01:49,486 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:49,486 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:01:49,487 - sqlalchemy.engine.Engine - INFO - [cached since 2.234s ago] (8148367074,)
2025-12-16 21:01:49,488 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:49,490 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:49,490 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 21:01:49,490 - sqlalchemy.engine.Engine - INFO - [cached since 2.233s ago] ('active',)
2025-12-16 21:01:49,491 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:49,684 - aiogram.event - INFO - Update id=188256899 is handled. Duration 202 ms by bot id=8561542425
2025-12-16 21:01:52,095 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:52,096 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:01:52,096 - sqlalchemy.engine.Engine - INFO - [cached since 4.844s ago] (8148367074,)
2025-12-16 21:01:52,098 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:52,202 - aiogram.event - INFO - Update id=188256900 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 21:01:53,532 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:53,533 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:01:53,533 - sqlalchemy.engine.Engine - INFO - [cached since 6.281s ago] (8148367074,)
2025-12-16 21:01:53,534 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:53,653 - aiogram.event - INFO - Update id=188256901 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 21:01:54,941 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:54,942 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:01:54,942 - sqlalchemy.engine.Engine - INFO - [cached since 7.69s ago] (8148367074,)
2025-12-16 21:01:54,943 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:55,056 - aiogram.event - INFO - Update id=188256902 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 21:01:57,455 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:57,456 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:01:57,456 - sqlalchemy.engine.Engine - INFO - [cached since 10.2s ago] (8148367074,)
2025-12-16 21:01:57,457 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:57,566 - aiogram.event - INFO - Update id=188256903 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 21:01:59,375 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:59,376 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:01:59,376 - sqlalchemy.engine.Engine - INFO - [cached since 12.12s ago] (8148367074,)
2025-12-16 21:01:59,377 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:59,379 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:59,380 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at, ended_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-16 21:01:59,381 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] ('asfasf', 'asfbasfb', '[]', 1000.0, 100.0, 1000.0, 'active', None, None, '2025-12-16 18:01:59.380203', '2025-12-16 18:01:59.380203', '2025-12-16 22:01:59.378202', None)
2025-12-16 21:01:59,383 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:01:59,389 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:59,391 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 21:01:59,391 - sqlalchemy.engine.Engine - INFO - [generated in 0.00071s] ('asfasf', 1, 0)
2025-12-16 21:01:59,393 - handlers.admin - INFO - Аукцион создан с ID: 3
2025-12-16 21:01:59,393 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:59,394 - utils.timer - INFO - Таймер запущен для аукциона #3
2025-12-16 21:01:59,395 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:59,396 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 21:01:59,397 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] (3, 'active')
2025-12-16 21:01:59,399 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:01:59,668 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:01:59,669 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 21:01:59,670 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] (3,)
2025-12-16 21:01:59,673 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-16 21:01:59,673 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] (35, 3)
2025-12-16 21:01:59,674 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:01:59,856 - aiogram.event - INFO - Update id=188256904 is handled. Duration 485 ms by bot id=8561542425
2025-12-16 21:02:03,044 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:03,044 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:02:03,045 - sqlalchemy.engine.Engine - INFO - [cached since 15.79s ago] (8148367074,)
2025-12-16 21:02:03,046 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:03,047 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:03,048 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 21:02:03,049 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] (3, 'active')
2025-12-16 21:02:03,050 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:02:03,050 - sqlalchemy.engine.Engine - INFO - [cached since 15.8s ago] (8148367074,)
2025-12-16 21:02:03,052 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 21:02:03,053 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] (3,)
2025-12-16 21:02:03,055 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 21:02:03,055 - sqlalchemy.engine.Engine - INFO - [generated in 0.00046s] (1100.0, '2025-12-16 18:02:03.054033', '2025-12-16 22:02:03.054033', 3)
2025-12-16 21:02:03,057 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 21:02:03,058 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] (3, 1, 1100.0, '2025-12-16 18:02:03.057033')
2025-12-16 21:02:03,059 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:02:03,066 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:03,068 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 21:02:03,069 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (3, 3, 0)
2025-12-16 21:02:03,071 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 21:02:03,072 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] (1,)
2025-12-16 21:02:03,074 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:02:03,074 - sqlalchemy.engine.Engine - INFO - [generated in 0.00045s] (3,)
2025-12-16 21:02:03,075 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 21:02:03,076 - sqlalchemy.engine.Engine - INFO - [cached since 3.406s ago] (3,)
2025-12-16 21:02:03,378 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:03,379 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 21:02:03,379 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (3, 1)
2025-12-16 21:02:03,380 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:02:03,382 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 21:02:03,392 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:02:03,398 - utils.timer - INFO - Таймер для аукциона #3 отменен
2025-12-16 21:02:03,501 - utils.timer - INFO - Таймер запущен для аукциона #3
2025-12-16 21:02:03,503 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:03,503 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 21:02:03,504 - sqlalchemy.engine.Engine - INFO - [cached since 4.108s ago] (3, 'active')
2025-12-16 21:02:03,506 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 21:02:03,507 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (3, 3, 0)
2025-12-16 21:02:03,508 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:02:03,508 - sqlalchemy.engine.Engine - INFO - [cached since 0.4347s ago] (3,)
2025-12-16 21:02:03,510 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id = ?
2025-12-16 21:02:03,511 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] (1,)
2025-12-16 21:02:03,511 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #3: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 21:02:03,511 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:03,512 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #3: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 21:02:03,625 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:03,626 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 21:02:03,626 - sqlalchemy.engine.Engine - INFO - [cached since 4.23s ago] (3, 'active')
2025-12-16 21:02:03,628 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 21:02:03,628 - sqlalchemy.engine.Engine - INFO - [cached since 0.1224s ago] (3, 3, 0)
2025-12-16 21:02:03,629 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:02:03,630 - sqlalchemy.engine.Engine - INFO - [cached since 0.5563s ago] (3,)
2025-12-16 21:02:03,631 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id = ?
2025-12-16 21:02:03,631 - sqlalchemy.engine.Engine - INFO - [cached since 0.1213s ago] (1,)
2025-12-16 21:02:03,632 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #3: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 21:02:03,632 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:03,633 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #3: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 21:02:03,633 - aiogram.event - INFO - Update id=188256905 is handled. Duration 594 ms by bot id=8561542425
2025-12-16 21:02:27,029 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:27,029 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:02:27,030 - sqlalchemy.engine.Engine - INFO - [cached since 39.78s ago] (8148367074,)
2025-12-16 21:02:27,031 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:27,032 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:27,032 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 21:02:27,033 - sqlalchemy.engine.Engine - INFO - [cached since 23.99s ago] (3, 'active')
2025-12-16 21:02:27,034 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:02:27,035 - sqlalchemy.engine.Engine - INFO - [cached since 39.78s ago] (8148367074,)
2025-12-16 21:02:27,036 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 21:02:27,036 - sqlalchemy.engine.Engine - INFO - [cached since 23.98s ago] (3,)
2025-12-16 21:02:27,290 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:02:27,291 - aiogram.event - INFO - Update id=188256906 is handled. Duration 265 ms by bot id=8561542425
2025-12-16 21:02:30,850 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:30,851 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:02:30,851 - sqlalchemy.engine.Engine - INFO - [cached since 43.6s ago] (8148367074,)
2025-12-16 21:02:30,852 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:30,854 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:30,854 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:02:30,854 - sqlalchemy.engine.Engine - INFO - [cached since 43.6s ago] (8148367074,)
2025-12-16 21:02:30,856 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id = ?
2025-12-16 21:02:30,857 - sqlalchemy.engine.Engine - INFO - [generated in 0.00052s] (3, 1)
2025-12-16 21:02:30,858 - sqlalchemy.engine.Engine - INFO - INSERT INTO auction_subscriptions (auction_id, user_id, created_at) VALUES (?, ?, ?)
2025-12-16 21:02:30,859 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] (3, 1, '2025-12-16 18:02:30.858790')
2025-12-16 21:02:30,860 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:02:30,950 - aiogram.event - INFO - Update id=188256907 is handled. Duration 109 ms by bot id=8561542425
2025-12-16 21:02:40,581 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:40,582 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:02:40,582 - sqlalchemy.engine.Engine - INFO - [cached since 53.33s ago] (8148367074,)
2025-12-16 21:02:40,583 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:40,585 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:40,585 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:02:40,586 - sqlalchemy.engine.Engine - INFO - [cached since 53.33s ago] (8148367074,)
2025-12-16 21:02:40,712 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:40,713 - aiogram.event - INFO - Update id=188256908 is handled. Duration 140 ms by bot id=8561542425
2025-12-16 21:02:42,577 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:42,577 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:02:42,578 - sqlalchemy.engine.Engine - INFO - [cached since 55.33s ago] (8148367074,)
2025-12-16 21:02:42,579 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:42,581 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:42,582 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids JOIN auctions ON auctions.id = bids.auction_id JOIN users ON users.id = auctions.winner_id 
WHERE users.telegram_id = ? ORDER BY bids.created_at DESC
2025-12-16 21:02:42,583 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (8561542425,)
2025-12-16 21:02:42,700 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:42,803 - aiogram.event - INFO - Update id=188256909 is handled. Duration 234 ms by bot id=8561542425
2025-12-16 21:02:48,282 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:48,283 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:02:48,283 - sqlalchemy.engine.Engine - INFO - [cached since 61.03s ago] (8148367074,)
2025-12-16 21:02:48,285 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:48,286 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:48,287 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions JOIN users ON users.id = auctions.winner_id 
WHERE users.telegram_id = ? AND auctions.status = ? AND auctions.winner_id = users.id ORDER BY auctions.ended_at DESC
2025-12-16 21:02:48,288 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] (8561542425, 'ended')
2025-12-16 21:02:48,403 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:48,505 - aiogram.event - INFO - Update id=188256910 is handled. Duration 217 ms by bot id=8561542425
2025-12-16 21:02:49,361 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:49,361 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:02:49,362 - sqlalchemy.engine.Engine - INFO - [cached since 62.11s ago] (8148367074,)
2025-12-16 21:02:49,363 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:49,365 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:02:49,365 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids JOIN auctions ON auctions.id = bids.auction_id JOIN users ON users.id = auctions.winner_id 
WHERE users.telegram_id = ? ORDER BY bids.created_at DESC
2025-12-16 21:02:49,365 - sqlalchemy.engine.Engine - INFO - [cached since 6.783s ago] (8561542425,)
2025-12-16 21:02:49,486 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:02:49,571 - aiogram.event - INFO - Update id=188256911 is handled. Duration 217 ms by bot id=8561542425
2025-12-16 21:03:31,276 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:03:31,276 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:03:31,277 - sqlalchemy.engine.Engine - INFO - [cached since 104s ago] (8148367074,)
2025-12-16 21:03:31,278 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:03:31,280 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:03:31,281 - sqlalchemy.engine.Engine - INFO - SELECT notifications.id, notifications.user_id, notifications.auction_id, notifications.message, notifications.is_read, notifications.created_at 
FROM notifications JOIN users ON users.id = notifications.user_id 
WHERE users.telegram_id = ? ORDER BY notifications.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 21:03:31,281 - sqlalchemy.engine.Engine - INFO - [generated in 0.00053s] (8561542425, 20, 0)
2025-12-16 21:03:31,530 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:03:31,613 - aiogram.event - INFO - Update id=188256912 is handled. Duration 328 ms by bot id=8561542425
2025-12-16 21:03:33,798 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:03:33,799 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:03:33,799 - sqlalchemy.engine.Engine - INFO - [cached since 106.5s ago] (8148367074,)
2025-12-16 21:03:33,802 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:03:34,017 - aiogram.event - INFO - Update id=188256913 is handled. Duration 219 ms by bot id=8561542425
2025-12-16 21:04:47,567 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:04:47,568 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:04:47,568 - sqlalchemy.engine.Engine - INFO - [cached since 180.3s ago] (8148367074,)
2025-12-16 21:04:47,569 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:04:47,571 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:04:47,571 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 21:04:47,572 - sqlalchemy.engine.Engine - INFO - [cached since 180.3s ago] ('active',)
2025-12-16 21:04:47,573 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:04:47,831 - aiogram.event - INFO - Update id=188256914 is handled. Duration 265 ms by bot id=8561542425
2025-12-16 21:04:49,868 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:04:49,869 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:04:49,869 - sqlalchemy.engine.Engine - INFO - [cached since 182.6s ago] (8148367074,)
2025-12-16 21:04:49,870 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:04:49,872 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:04:49,872 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 21:04:49,873 - sqlalchemy.engine.Engine - INFO - [cached since 181.6s ago] ('active',)
2025-12-16 21:04:49,874 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:04:49,875 - sqlalchemy.engine.Engine - INFO - [cached since 166.8s ago] (3,)
2025-12-16 21:04:50,054 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:04:50,055 - aiogram.event - INFO - Update id=188256915 is handled. Duration 188 ms by bot id=8561542425
2025-12-16 21:04:55,861 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:04:55,861 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:04:55,862 - sqlalchemy.engine.Engine - INFO - [cached since 188.6s ago] (8148367074,)
2025-12-16 21:04:55,863 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:04:55,864 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:04:55,865 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 21:04:55,865 - sqlalchemy.engine.Engine - INFO - [cached since 187.6s ago] ('active',)
2025-12-16 21:04:55,866 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:04:55,867 - sqlalchemy.engine.Engine - INFO - [cached since 172.8s ago] (3,)
2025-12-16 21:04:56,073 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:04:56,074 - aiogram.event - INFO - Update id=188256916 is handled. Duration 217 ms by bot id=8561542425
2025-12-16 21:05:31,506 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:05:31,506 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:05:31,507 - sqlalchemy.engine.Engine - INFO - [cached since 224.3s ago] (8148367074,)
2025-12-16 21:05:31,508 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:05:31,510 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:05:31,510 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 21:05:31,510 - sqlalchemy.engine.Engine - INFO - [cached since 224.3s ago] ('active',)
2025-12-16 21:05:31,511 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:05:31,827 - aiogram.event - INFO - Update id=188256917 is handled. Duration 328 ms by bot id=8561542425
2025-12-16 21:05:34,065 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:05:34,065 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:05:34,066 - sqlalchemy.engine.Engine - INFO - [cached since 226.8s ago] (8148367074,)
2025-12-16 21:05:34,067 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:05:34,068 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:05:34,069 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 21:05:34,069 - sqlalchemy.engine.Engine - INFO - [cached since 226.8s ago] ('active',)
2025-12-16 21:05:34,070 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:05:34,183 - aiogram.event - INFO - Update id=188256918 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 21:07:35,018 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 21:07:35,281 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_210735.db
2025-12-16 21:07:35,283 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 21:07:35,283 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 21:07:35,283 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 21:07:35,284 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 21:07:35,284 - utils.timer - INFO - Таймер для аукциона #3 отменен
2025-12-16 21:07:51,413 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:07:51,414 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 21:07:51,414 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:07:51,415 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 21:07:51,416 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:07:51,416 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 21:07:51,417 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:07:51,417 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 21:07:51,418 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:07:51,418 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 21:07:51,418 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:07:51,419 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:07:51,420 - __main__ - INFO - База данных инициализирована
2025-12-16 21:07:51,420 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 21:07:51,421 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_210751.db
2025-12-16 21:07:51,423 - __main__ - INFO - Резервная копия создана
2025-12-16 21:07:51,462 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:07:51,475 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 21:07:51,476 - sqlalchemy.engine.Engine - INFO - [generated in 0.00095s] ('active', '2025-12-16 18:07:51.461714')
2025-12-16 21:07:51,477 - utils.timer - INFO - Таймер запущен для аукциона #3
2025-12-16 21:07:51,478 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:07:51,479 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 21:07:51,480 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] (3, 'active')
2025-12-16 21:07:51,483 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 21:07:51,484 - sqlalchemy.engine.Engine - INFO - [generated in 0.00076s] (3, 3, 0)
2025-12-16 21:07:51,486 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:07:51,486 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (3,)
2025-12-16 21:07:51,489 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id = ?
2025-12-16 21:07:51,490 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] (1,)
2025-12-16 21:07:51,490 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #3: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 21:07:51,491 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:07:51,491 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #3: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 21:07:51,493 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 21:07:51,493 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ('active', '2025-12-16 18:07:51.492721')
2025-12-16 21:07:51,494 - utils.timer - INFO - Восстановлено 1 таймеров, завершено 0 аукционов
2025-12-16 21:07:51,495 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:07:51,495 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 21:07:51,496 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 21:07:51,496 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 21:07:51,496 - __main__ - INFO - Бот запущен
2025-12-16 21:07:51,496 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 21:07:51,496 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 21:07:51,496 - __main__ - INFO - Бот установлен: True
2025-12-16 21:07:51,497 - aiogram.dispatcher - INFO - Start polling
2025-12-16 21:07:51,501 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:07:51,502 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 21:07:51,503 - sqlalchemy.engine.Engine - INFO - [generated in 0.00079s] ('active',)
2025-12-16 21:07:51,504 - utils.periodic_updater - INFO - Периодическое обновление: найдено 1 активных аукционов
2025-12-16 21:07:51,505 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 21:07:51,506 - sqlalchemy.engine.Engine - INFO - [cached since 0.0228s ago] (3, 3, 0)
2025-12-16 21:07:51,507 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:07:51,507 - sqlalchemy.engine.Engine - INFO - [cached since 0.02163s ago] (3,)
2025-12-16 21:07:51,509 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id = ?
2025-12-16 21:07:51,510 - sqlalchemy.engine.Engine - INFO - [cached since 0.02066s ago] (1,)
2025-12-16 21:07:51,510 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #3: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 21:07:51,511 - utils.periodic_updater - ERROR - Ошибка при обновлении аукциона #3: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 21:07:51,511 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:07:51,732 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 21:07:55,727 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:07:55,728 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:07:55,729 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (8148367074,)
2025-12-16 21:07:55,730 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:07:55,731 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:07:55,733 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 21:07:55,733 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] ('active',)
2025-12-16 21:07:55,735 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:07:55,735 - sqlalchemy.engine.Engine - INFO - [cached since 4.249s ago] (3,)
2025-12-16 21:07:56,073 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:07:56,074 - aiogram.event - INFO - Update id=188256919 is handled. Duration 359 ms by bot id=8561542425
2025-12-16 21:08:00,011 - aiogram.event - INFO - Update id=188256920 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 21:08:01,360 - aiogram.event - INFO - Update id=188256921 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 21:08:02,615 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:08:02,616 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:08:02,616 - sqlalchemy.engine.Engine - INFO - [cached since 6.888s ago] (8148367074,)
2025-12-16 21:08:02,617 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:08:02,619 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:08:02,620 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 21:08:02,620 - sqlalchemy.engine.Engine - INFO - [generated in 0.00067s] (3,)
2025-12-16 21:08:02,623 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 21:08:02,624 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] ('ended', '2025-12-16 18:08:02.622230', 3)
2025-12-16 21:08:02,627 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 21:08:02,627 - sqlalchemy.engine.Engine - INFO - [generated in 0.00070s] (3, 1, 0)
2025-12-16 21:08:02,629 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET winner_id=? WHERE auctions.id = ?
2025-12-16 21:08:02,629 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] (1, 3)
2025-12-16 21:08:02,630 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:08:02,636 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:08:02,640 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 21:08:02,641 - sqlalchemy.engine.Engine - INFO - [generated in 0.00082s] (3,)
2025-12-16 21:08:02,643 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 21:08:02,644 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] (1,)
2025-12-16 21:08:02,646 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 21:08:02,647 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] (3, 3, 0)
2025-12-16 21:08:02,648 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 21:08:02,649 - sqlalchemy.engine.Engine - INFO - [generated in 0.00061s] (1,)
2025-12-16 21:08:02,650 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:08:02,651 - sqlalchemy.engine.Engine - INFO - [cached since 11.16s ago] (3,)
2025-12-16 21:08:02,846 - handlers.admin - INFO - Сообщение в канале для аукциона #3 обновлено (админское завершение)
2025-12-16 21:08:02,848 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:08:02,849 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.id = ?
2025-12-16 21:08:02,849 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] (1,)
2025-12-16 21:08:02,953 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:08:02,954 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 21:08:02,965 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:08:02,971 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 21:08:02,976 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:08:02,981 - utils.timer - INFO - Таймер для аукциона #3 отменен
2025-12-16 21:08:03,159 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:08:03,160 - aiogram.event - INFO - Update id=188256922 is handled. Duration 546 ms by bot id=8561542425
2025-12-16 21:13:43,046 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 21:13:43,304 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_211343.db
2025-12-16 21:13:43,306 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 21:13:43,306 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 21:13:43,306 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 21:13:43,306 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 21:13:54,560 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:13:54,561 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 21:13:54,561 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:13:54,562 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 21:13:54,562 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:13:54,563 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 21:13:54,563 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:13:54,564 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 21:13:54,564 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:13:54,565 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 21:13:54,565 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:13:54,566 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:13:54,567 - __main__ - INFO - База данных инициализирована
2025-12-16 21:13:54,567 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 21:13:54,568 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_211354.db
2025-12-16 21:13:54,570 - __main__ - INFO - Резервная копия создана
2025-12-16 21:13:54,621 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:13:54,634 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 21:13:54,635 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] ('active', '2025-12-16 18:13:54.621460')
2025-12-16 21:13:54,637 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 21:13:54,638 - sqlalchemy.engine.Engine - INFO - [generated in 0.00073s] ('active', '2025-12-16 18:13:54.636463')
2025-12-16 21:13:54,639 - utils.timer - INFO - Восстановлено 0 таймеров, завершено 0 аукционов
2025-12-16 21:13:54,639 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:13:54,640 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 21:13:54,640 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 21:13:54,640 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 21:13:54,640 - __main__ - INFO - Бот запущен
2025-12-16 21:13:54,640 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 21:13:54,641 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 21:13:54,641 - __main__ - INFO - Бот установлен: True
2025-12-16 21:13:54,641 - aiogram.dispatcher - INFO - Start polling
2025-12-16 21:13:54,645 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:13:54,647 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 21:13:54,648 - sqlalchemy.engine.Engine - INFO - [generated in 0.00091s] ('active',)
2025-12-16 21:13:54,649 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:13:54,901 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 21:13:59,379 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:13:59,380 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:13:59,381 - sqlalchemy.engine.Engine - INFO - [generated in 0.00051s] (8148367074,)
2025-12-16 21:13:59,382 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:13:59,384 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:13:59,385 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 21:13:59,386 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] ('active',)
2025-12-16 21:13:59,387 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:13:59,654 - aiogram.event - INFO - Update id=188256923 is handled. Duration 282 ms by bot id=8561542425
2025-12-16 21:14:01,172 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:01,172 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:01,173 - sqlalchemy.engine.Engine - INFO - [cached since 1.793s ago] (8148367074,)
2025-12-16 21:14:01,174 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:01,176 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:01,177 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 21:14:01,177 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] ('active',)
2025-12-16 21:14:01,368 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:01,369 - aiogram.event - INFO - Update id=188256924 is handled. Duration 202 ms by bot id=8561542425
2025-12-16 21:14:02,218 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:02,219 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:02,219 - sqlalchemy.engine.Engine - INFO - [cached since 2.839s ago] (8148367074,)
2025-12-16 21:14:02,220 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:02,222 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:02,222 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 21:14:02,222 - sqlalchemy.engine.Engine - INFO - [cached since 2.837s ago] ('active',)
2025-12-16 21:14:02,223 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:02,414 - aiogram.event - INFO - Update id=188256925 is handled. Duration 203 ms by bot id=8561542425
2025-12-16 21:14:07,447 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:07,448 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:07,448 - sqlalchemy.engine.Engine - INFO - [cached since 8.068s ago] (8148367074,)
2025-12-16 21:14:07,449 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:07,571 - aiogram.event - INFO - Update id=188256926 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 21:14:08,881 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:08,881 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:08,882 - sqlalchemy.engine.Engine - INFO - [cached since 9.502s ago] (8148367074,)
2025-12-16 21:14:08,883 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:09,025 - aiogram.event - INFO - Update id=188256927 is handled. Duration 157 ms by bot id=8561542425
2025-12-16 21:14:09,733 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:09,733 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:09,734 - sqlalchemy.engine.Engine - INFO - [cached since 10.35s ago] (8148367074,)
2025-12-16 21:14:09,735 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:09,848 - aiogram.event - INFO - Update id=188256928 is handled. Duration 108 ms by bot id=8561542425
2025-12-16 21:14:11,072 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:11,073 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:11,073 - sqlalchemy.engine.Engine - INFO - [cached since 11.69s ago] (8148367074,)
2025-12-16 21:14:11,074 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:11,215 - aiogram.event - INFO - Update id=188256929 is handled. Duration 140 ms by bot id=8561542425
2025-12-16 21:14:12,448 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:12,448 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:12,449 - sqlalchemy.engine.Engine - INFO - [cached since 13.07s ago] (8148367074,)
2025-12-16 21:14:12,450 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:12,451 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:12,453 - sqlalchemy.engine.Engine - INFO - INSERT INTO auctions (title, description, photos, start_price, step_price, current_price, status, winner_id, channel_message_id, last_bid_time, created_at, ends_at, ended_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
2025-12-16 21:14:12,453 - sqlalchemy.engine.Engine - INFO - [generated in 0.00050s] ('asfbasfbsa', 'asfbasfbabfs', '[]', 10000.0, 1000.0, 10000.0, 'active', None, None, '2025-12-16 18:14:12.453769', '2025-12-16 18:14:12.453769', '2025-12-16 22:14:12.450768', None)
2025-12-16 21:14:12,455 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:14:12,462 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:12,463 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.title = ? ORDER BY auctions.created_at DESC
 LIMIT ? OFFSET ?
2025-12-16 21:14:12,464 - sqlalchemy.engine.Engine - INFO - [generated in 0.00083s] ('asfbasfbsa', 1, 0)
2025-12-16 21:14:12,465 - handlers.admin - INFO - Аукцион создан с ID: 4
2025-12-16 21:14:12,465 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:12,466 - utils.timer - INFO - Таймер запущен для аукциона #4
2025-12-16 21:14:12,467 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:12,468 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 21:14:12,468 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] (4, 'active')
2025-12-16 21:14:12,471 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:12,667 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:12,668 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 21:14:12,669 - sqlalchemy.engine.Engine - INFO - [generated in 0.00058s] (4,)
2025-12-16 21:14:12,672 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET channel_message_id=? WHERE auctions.id = ?
2025-12-16 21:14:12,672 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] (36, 4)
2025-12-16 21:14:12,673 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:14:12,813 - aiogram.event - INFO - Update id=188256930 is handled. Duration 359 ms by bot id=8561542425
2025-12-16 21:14:15,974 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:15,974 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:15,975 - sqlalchemy.engine.Engine - INFO - [cached since 16.59s ago] (8148367074,)
2025-12-16 21:14:15,976 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:15,977 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:15,978 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ?
2025-12-16 21:14:15,979 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (4, 'active')
2025-12-16 21:14:15,980 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:15,980 - sqlalchemy.engine.Engine - INFO - [cached since 16.6s ago] (8148367074,)
2025-12-16 21:14:15,982 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.id DESC
2025-12-16 21:14:15,983 - sqlalchemy.engine.Engine - INFO - [generated in 0.00059s] (4,)
2025-12-16 21:14:15,985 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET current_price=?, last_bid_time=?, ends_at=? WHERE auctions.id = ?
2025-12-16 21:14:15,985 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] (11000.0, '2025-12-16 18:14:15.984300', '2025-12-16 22:14:15.984300', 4)
2025-12-16 21:14:15,987 - sqlalchemy.engine.Engine - INFO - INSERT INTO bids (auction_id, user_id, amount, created_at) VALUES (?, ?, ?, ?)
2025-12-16 21:14:15,988 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] (4, 1, 11000.0, '2025-12-16 18:14:15.987301')
2025-12-16 21:14:15,989 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:14:15,997 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:15,999 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 21:14:16,000 - sqlalchemy.engine.Engine - INFO - [generated in 0.00066s] (4, 3, 0)
2025-12-16 21:14:16,002 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 21:14:16,003 - sqlalchemy.engine.Engine - INFO - [generated in 0.00077s] (1,)
2025-12-16 21:14:16,005 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:14:16,005 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] (4,)
2025-12-16 21:14:16,007 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 21:14:16,007 - sqlalchemy.engine.Engine - INFO - [cached since 3.339s ago] (4,)
2025-12-16 21:14:16,216 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:16,217 - sqlalchemy.engine.Engine - INFO - SELECT auction_subscriptions.id, auction_subscriptions.auction_id, auction_subscriptions.user_id, auction_subscriptions.created_at 
FROM auction_subscriptions 
WHERE auction_subscriptions.auction_id = ? AND auction_subscriptions.user_id != ?
2025-12-16 21:14:16,217 - sqlalchemy.engine.Engine - INFO - [generated in 0.00049s] (4, 1)
2025-12-16 21:14:16,218 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:14:16,220 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 21:14:16,231 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:14:16,236 - utils.timer - INFO - Таймер для аукциона #4 отменен
2025-12-16 21:14:16,346 - utils.timer - INFO - Таймер запущен для аукциона #4
2025-12-16 21:14:16,348 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:16,348 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 21:14:16,349 - sqlalchemy.engine.Engine - INFO - [cached since 3.88s ago] (4, 'active')
2025-12-16 21:14:16,351 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 21:14:16,352 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] (4, 3, 0)
2025-12-16 21:14:16,353 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:14:16,353 - sqlalchemy.engine.Engine - INFO - [cached since 0.3483s ago] (4,)
2025-12-16 21:14:16,355 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id = ?
2025-12-16 21:14:16,359 - sqlalchemy.engine.Engine - INFO - [generated in 0.00401s] (1,)
2025-12-16 21:14:16,360 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #4: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 21:14:16,360 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:16,361 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #4: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 21:14:16,460 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:16,461 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ? AND auctions.status = ? AND auctions.channel_message_id IS NOT NULL
2025-12-16 21:14:16,461 - sqlalchemy.engine.Engine - INFO - [cached since 3.993s ago] (4, 'active')
2025-12-16 21:14:16,463 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 21:14:16,463 - sqlalchemy.engine.Engine - INFO - [cached since 0.1121s ago] (4, 3, 0)
2025-12-16 21:14:16,464 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:14:16,465 - sqlalchemy.engine.Engine - INFO - [cached since 0.4596s ago] (4,)
2025-12-16 21:14:16,466 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id = ?
2025-12-16 21:14:16,466 - sqlalchemy.engine.Engine - INFO - [cached since 0.1111s ago] (1,)
2025-12-16 21:14:16,466 - utils.periodic_updater - ERROR - Ошибка при подготовке данных аукциона #4: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 21:14:16,467 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:16,467 - utils.periodic_updater - ERROR - Ошибка при принудительном обновлении аукциона #4: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-12-16 21:14:16,468 - aiogram.event - INFO - Update id=188256931 is handled. Duration 500 ms by bot id=8561542425
2025-12-16 21:14:23,350 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:23,350 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:23,351 - sqlalchemy.engine.Engine - INFO - [cached since 23.97s ago] (8148367074,)
2025-12-16 21:14:23,352 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:23,354 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:23,354 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 21:14:23,354 - sqlalchemy.engine.Engine - INFO - [cached since 23.97s ago] ('active',)
2025-12-16 21:14:23,355 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:23,472 - aiogram.event - INFO - Update id=188256932 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 21:14:25,919 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:25,920 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:25,920 - sqlalchemy.engine.Engine - INFO - [cached since 26.54s ago] (8148367074,)
2025-12-16 21:14:25,922 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:25,923 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:25,924 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions
2025-12-16 21:14:25,924 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] ()
2025-12-16 21:14:25,925 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 21:14:25,926 - sqlalchemy.engine.Engine - INFO - [cached since 26.54s ago] ('active',)
2025-12-16 21:14:25,927 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 21:14:25,927 - sqlalchemy.engine.Engine - INFO - [cached since 26.54s ago] ('ended',)
2025-12-16 21:14:25,929 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users
2025-12-16 21:14:25,929 - sqlalchemy.engine.Engine - INFO - [generated in 0.00038s] ()
2025-12-16 21:14:25,931 - sqlalchemy.engine.Engine - INFO - SELECT count(users.id) AS count_1 
FROM users 
WHERE users.is_confirmed = 1
2025-12-16 21:14:25,931 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] ()
2025-12-16 21:14:25,933 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids
2025-12-16 21:14:25,933 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ()
2025-12-16 21:14:25,935 - sqlalchemy.engine.Engine - INFO - SELECT sum(auctions.current_price) AS sum_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 21:14:25,935 - sqlalchemy.engine.Engine - INFO - [generated in 0.00040s] ('ended',)
2025-12-16 21:14:26,137 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:26,138 - aiogram.event - INFO - Update id=188256933 is handled. Duration 219 ms by bot id=8561542425
2025-12-16 21:14:29,664 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:29,665 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:29,665 - sqlalchemy.engine.Engine - INFO - [cached since 30.28s ago] (8148367074,)
2025-12-16 21:14:29,666 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:29,668 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:29,668 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? ORDER BY auctions.created_at DESC
2025-12-16 21:14:29,669 - sqlalchemy.engine.Engine - INFO - [cached since 28.49s ago] ('active',)
2025-12-16 21:14:29,670 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:14:29,671 - sqlalchemy.engine.Engine - INFO - [cached since 13.67s ago] (4,)
2025-12-16 21:14:29,877 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:29,877 - aiogram.event - INFO - Update id=188256934 is handled. Duration 202 ms by bot id=8561542425
2025-12-16 21:14:31,744 - aiogram.event - INFO - Update id=188256935 is not handled. Duration 0 ms by bot id=8561542425
2025-12-16 21:14:35,439 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:35,440 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:14:35,440 - sqlalchemy.engine.Engine - INFO - [cached since 36.06s ago] (8148367074,)
2025-12-16 21:14:35,442 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:35,443 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:35,443 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 21:14:35,444 - sqlalchemy.engine.Engine - INFO - [cached since 22.78s ago] (4,)
2025-12-16 21:14:35,446 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET status=?, ended_at=? WHERE auctions.id = ?
2025-12-16 21:14:35,446 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] ('ended', '2025-12-16 18:14:35.445671', 4)
2025-12-16 21:14:35,448 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 21:14:35,449 - sqlalchemy.engine.Engine - INFO - [generated in 0.00068s] (4, 1, 0)
2025-12-16 21:14:35,450 - sqlalchemy.engine.Engine - INFO - UPDATE auctions SET winner_id=? WHERE auctions.id = ?
2025-12-16 21:14:35,451 - sqlalchemy.engine.Engine - INFO - [generated in 0.00033s] (1, 4)
2025-12-16 21:14:35,452 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:14:35,458 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:35,460 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.id = ?
2025-12-16 21:14:35,460 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] (4,)
2025-12-16 21:14:35,463 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 21:14:35,463 - sqlalchemy.engine.Engine - INFO - [generated in 0.00065s] (1,)
2025-12-16 21:14:35,465 - sqlalchemy.engine.Engine - INFO - SELECT bids.id, bids.auction_id, bids.user_id, bids.amount, bids.created_at 
FROM bids 
WHERE bids.auction_id = ? ORDER BY bids.amount DESC
 LIMIT ? OFFSET ?
2025-12-16 21:14:35,465 - sqlalchemy.engine.Engine - INFO - [cached since 19.47s ago] (4, 3, 0)
2025-12-16 21:14:35,467 - sqlalchemy.engine.Engine - INFO - SELECT users.id AS users_id, users.telegram_id AS users_telegram_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.phone AS users_phone, users.is_confirmed AS users_is_confirmed, users.created_at AS users_created_at 
FROM users 
WHERE users.id IN (?)
2025-12-16 21:14:35,467 - sqlalchemy.engine.Engine - INFO - [cached since 19.47s ago] (1,)
2025-12-16 21:14:35,469 - sqlalchemy.engine.Engine - INFO - SELECT count(bids.id) AS count_1 
FROM bids 
WHERE bids.auction_id = ?
2025-12-16 21:14:35,469 - sqlalchemy.engine.Engine - INFO - [cached since 19.46s ago] (4,)
2025-12-16 21:14:35,711 - handlers.admin - INFO - Сообщение в канале для аукциона #4 обновлено (админское завершение)
2025-12-16 21:14:35,712 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:35,713 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.id = ?
2025-12-16 21:14:35,714 - sqlalchemy.engine.Engine - INFO - [generated in 0.00062s] (1,)
2025-12-16 21:14:35,936 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:14:35,936 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 21:14:35,942 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:14:35,948 - sqlalchemy.engine.Engine - INFO - INSERT INTO notifications (user_id, auction_id, message, is_read, created_at) VALUES (?, ?, ?, ?, ?)
2025-12-16 21:14:35,954 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:14:36,217 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:14:36,218 - aiogram.event - INFO - Update id=188256936 is handled. Duration 780 ms by bot id=8561542425
2025-12-16 21:16:34,230 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:34,230 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:34,230 - sqlalchemy.engine.Engine - INFO - [cached since 154.9s ago] (8148367074,)
2025-12-16 21:16:34,232 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:34,233 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:34,234 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:34,234 - sqlalchemy.engine.Engine - INFO - [cached since 154.9s ago] (8148367074,)
2025-12-16 21:16:34,487 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:34,488 - aiogram.event - INFO - Update id=188256937 is handled. Duration 250 ms by bot id=8561542425
2025-12-16 21:16:35,927 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:35,928 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:35,928 - sqlalchemy.engine.Engine - INFO - [cached since 156.5s ago] (8148367074,)
2025-12-16 21:16:35,929 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:35,931 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:35,931 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:35,932 - sqlalchemy.engine.Engine - INFO - [cached since 156.6s ago] (8561542425,)
2025-12-16 21:16:36,043 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:36,166 - aiogram.event - INFO - Update id=188256938 is handled. Duration 250 ms by bot id=8561542425
2025-12-16 21:16:37,781 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:37,782 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:37,782 - sqlalchemy.engine.Engine - INFO - [cached since 158.4s ago] (8148367074,)
2025-12-16 21:16:37,784 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:37,785 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:37,785 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:37,786 - sqlalchemy.engine.Engine - INFO - [cached since 158.4s ago] (8561542425,)
2025-12-16 21:16:37,953 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:38,057 - aiogram.event - INFO - Update id=188256939 is handled. Duration 280 ms by bot id=8561542425
2025-12-16 21:16:40,995 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:40,995 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:40,995 - sqlalchemy.engine.Engine - INFO - [cached since 161.6s ago] (8148367074,)
2025-12-16 21:16:40,997 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:40,998 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:40,998 - sqlalchemy.engine.Engine - INFO - SELECT count(auctions.id) AS count_1 
FROM auctions 
WHERE auctions.status = ?
2025-12-16 21:16:40,999 - sqlalchemy.engine.Engine - INFO - [cached since 161.6s ago] ('active',)
2025-12-16 21:16:41,000 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:41,115 - aiogram.event - INFO - Update id=188256940 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 21:16:43,185 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:43,185 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:43,186 - sqlalchemy.engine.Engine - INFO - [cached since 163.8s ago] (8148367074,)
2025-12-16 21:16:43,187 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:43,188 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:43,188 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:43,189 - sqlalchemy.engine.Engine - INFO - [cached since 163.8s ago] (8148367074,)
2025-12-16 21:16:43,302 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:43,303 - aiogram.event - INFO - Update id=188256941 is handled. Duration 125 ms by bot id=8561542425
2025-12-16 21:16:46,571 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:46,572 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:46,572 - sqlalchemy.engine.Engine - INFO - [cached since 167.2s ago] (8148367074,)
2025-12-16 21:16:46,573 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:46,575 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:46,575 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:46,575 - sqlalchemy.engine.Engine - INFO - [cached since 167.2s ago] (8561542425,)
2025-12-16 21:16:46,746 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:46,850 - aiogram.event - INFO - Update id=188256942 is handled. Duration 282 ms by bot id=8561542425
2025-12-16 21:16:49,597 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:49,597 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:49,598 - sqlalchemy.engine.Engine - INFO - [cached since 170.2s ago] (8148367074,)
2025-12-16 21:16:49,599 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:49,600 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:16:49,601 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:16:49,601 - sqlalchemy.engine.Engine - INFO - [cached since 170.2s ago] (8561542425,)
2025-12-16 21:16:49,709 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:16:49,812 - aiogram.event - INFO - Update id=188256943 is handled. Duration 219 ms by bot id=8561542425
2025-12-16 21:18:43,446 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 21:18:43,707 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_211843.db
2025-12-16 21:18:43,708 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 21:18:43,708 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 21:18:43,708 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 21:18:43,709 - utils.timer - INFO - Таймер для аукциона #4 отменен
2025-12-16 21:18:43,709 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 21:18:52,439 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:18:52,440 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 21:18:52,440 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:18:52,441 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 21:18:52,441 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:18:52,442 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 21:18:52,443 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:18:52,443 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 21:18:52,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:18:52,444 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 21:18:52,444 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:18:52,445 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:18:52,446 - __main__ - INFO - База данных инициализирована
2025-12-16 21:18:52,446 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 21:18:52,447 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_211852.db
2025-12-16 21:18:52,449 - __main__ - INFO - Резервная копия создана
2025-12-16 21:18:52,488 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:18:52,503 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 21:18:52,504 - sqlalchemy.engine.Engine - INFO - [generated in 0.00082s] ('active', '2025-12-16 18:18:52.487234')
2025-12-16 21:18:52,506 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 21:18:52,506 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] ('active', '2025-12-16 18:18:52.505238')
2025-12-16 21:18:52,507 - utils.timer - INFO - Восстановлено 0 таймеров, завершено 0 аукционов
2025-12-16 21:18:52,508 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:18:52,509 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 21:18:52,509 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 21:18:52,509 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 21:18:52,509 - __main__ - INFO - Бот запущен
2025-12-16 21:18:52,509 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 21:18:52,509 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 21:18:52,510 - __main__ - INFO - Бот установлен: True
2025-12-16 21:18:52,510 - aiogram.dispatcher - INFO - Start polling
2025-12-16 21:18:52,514 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:18:52,516 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 21:18:52,517 - sqlalchemy.engine.Engine - INFO - [generated in 0.00093s] ('active',)
2025-12-16 21:18:52,518 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:18:52,750 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 21:18:55,867 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:18:55,869 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:18:55,869 - sqlalchemy.engine.Engine - INFO - [generated in 0.00060s] (8148367074,)
2025-12-16 21:18:55,871 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:18:55,874 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:18:55,874 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:18:55,875 - sqlalchemy.engine.Engine - INFO - [cached since 0.006544s ago] (8561542425,)
2025-12-16 21:18:56,165 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:18:56,270 - aiogram.event - INFO - Update id=188256944 is handled. Duration 405 ms by bot id=8561542425
2025-12-16 21:18:57,203 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:18:57,203 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:18:57,204 - sqlalchemy.engine.Engine - INFO - [cached since 1.335s ago] (8148367074,)
2025-12-16 21:18:57,205 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:18:57,207 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:18:57,208 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:18:57,208 - sqlalchemy.engine.Engine - INFO - [cached since 1.34s ago] (8561542425,)
2025-12-16 21:18:57,369 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:18:57,464 - aiogram.event - INFO - Update id=188256945 is handled. Duration 265 ms by bot id=8561542425
2025-12-16 21:19:00,950 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 21:19:01,199 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_211901.db
2025-12-16 21:19:01,200 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 21:19:01,200 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 21:19:01,200 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 21:19:01,201 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 21:19:13,040 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:19:13,041 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("users")
2025-12-16 21:19:13,041 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:19:13,042 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("users")
2025-12-16 21:19:13,043 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:19:13,043 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auctions")
2025-12-16 21:19:13,044 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:19:13,045 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auctions")
2025-12-16 21:19:13,045 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:19:13,046 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("bids")
2025-12-16 21:19:13,046 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:19:13,047 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("bids")
2025-12-16 21:19:13,047 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:19:13,048 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("auction_subscriptions")
2025-12-16 21:19:13,048 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:19:13,049 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("auction_subscriptions")
2025-12-16 21:19:13,049 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:19:13,050 - sqlalchemy.engine.Engine - INFO - PRAGMA main.table_info("notifications")
2025-12-16 21:19:13,050 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:19:13,051 - sqlalchemy.engine.Engine - INFO - PRAGMA temp.table_info("notifications")
2025-12-16 21:19:13,051 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-12-16 21:19:13,052 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE users (
	id INTEGER NOT NULL, 
	telegram_id INTEGER NOT NULL, 
	username VARCHAR(100), 
	first_name VARCHAR(100), 
	last_name VARCHAR(100), 
	phone VARCHAR(20), 
	is_confirmed BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	UNIQUE (telegram_id)
)


2025-12-16 21:19:13,054 - sqlalchemy.engine.Engine - INFO - [no key 0.00125s] ()
2025-12-16 21:19:13,060 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_users_is_confirmed ON users (is_confirmed)
2025-12-16 21:19:13,060 - sqlalchemy.engine.Engine - INFO - [no key 0.00036s] ()
2025-12-16 21:19:13,066 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auctions (
	id INTEGER NOT NULL, 
	title VARCHAR(255) NOT NULL, 
	description TEXT, 
	photos TEXT, 
	start_price FLOAT NOT NULL, 
	step_price FLOAT NOT NULL, 
	current_price FLOAT NOT NULL, 
	status VARCHAR(20), 
	winner_id INTEGER, 
	channel_message_id INTEGER, 
	last_bid_time DATETIME, 
	created_at DATETIME, 
	ends_at DATETIME, 
	ended_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(winner_id) REFERENCES users (id)
)


2025-12-16 21:19:13,067 - sqlalchemy.engine.Engine - INFO - [no key 0.00157s] ()
2025-12-16 21:19:13,072 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_created_at ON auctions (created_at)
2025-12-16 21:19:13,073 - sqlalchemy.engine.Engine - INFO - [no key 0.00051s] ()
2025-12-16 21:19:13,078 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_title ON auctions (title)
2025-12-16 21:19:13,079 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-12-16 21:19:13,083 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_status ON auctions (status)
2025-12-16 21:19:13,083 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-12-16 21:19:13,089 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_ends_at ON auctions (ends_at)
2025-12-16 21:19:13,089 - sqlalchemy.engine.Engine - INFO - [no key 0.00054s] ()
2025-12-16 21:19:13,093 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_auctions_last_bid_time ON auctions (last_bid_time)
2025-12-16 21:19:13,094 - sqlalchemy.engine.Engine - INFO - [no key 0.00043s] ()
2025-12-16 21:19:13,099 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE bids (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	amount FLOAT NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-16 21:19:13,101 - sqlalchemy.engine.Engine - INFO - [no key 0.00128s] ()
2025-12-16 21:19:13,105 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_created_at ON bids (created_at)
2025-12-16 21:19:13,105 - sqlalchemy.engine.Engine - INFO - [no key 0.00035s] ()
2025-12-16 21:19:13,111 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_auction_user ON bids (auction_id, user_id)
2025-12-16 21:19:13,111 - sqlalchemy.engine.Engine - INFO - [no key 0.00040s] ()
2025-12-16 21:19:13,115 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_bids_amount ON bids (amount)
2025-12-16 21:19:13,116 - sqlalchemy.engine.Engine - INFO - [no key 0.00045s] ()
2025-12-16 21:19:13,122 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE auction_subscriptions (
	id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)


2025-12-16 21:19:13,123 - sqlalchemy.engine.Engine - INFO - [no key 0.00110s] ()
2025-12-16 21:19:13,127 - sqlalchemy.engine.Engine - INFO - CREATE UNIQUE INDEX ix_subscriptions_auction_user ON auction_subscriptions (auction_id, user_id)
2025-12-16 21:19:13,128 - sqlalchemy.engine.Engine - INFO - [no key 0.00044s] ()
2025-12-16 21:19:13,133 - sqlalchemy.engine.Engine - INFO - 
CREATE TABLE notifications (
	id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	auction_id INTEGER NOT NULL, 
	message TEXT NOT NULL, 
	is_read BOOLEAN, 
	created_at DATETIME, 
	PRIMARY KEY (id), 
	FOREIGN KEY(user_id) REFERENCES users (id), 
	FOREIGN KEY(auction_id) REFERENCES auctions (id)
)


2025-12-16 21:19:13,134 - sqlalchemy.engine.Engine - INFO - [no key 0.00112s] ()
2025-12-16 21:19:13,139 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_user_read ON notifications (user_id, is_read)
2025-12-16 21:19:13,139 - sqlalchemy.engine.Engine - INFO - [no key 0.00042s] ()
2025-12-16 21:19:13,144 - sqlalchemy.engine.Engine - INFO - CREATE INDEX ix_notifications_created_at ON notifications (created_at)
2025-12-16 21:19:13,145 - sqlalchemy.engine.Engine - INFO - [no key 0.00052s] ()
2025-12-16 21:19:13,149 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:19:13,150 - __main__ - INFO - База данных инициализирована
2025-12-16 21:19:13,150 - __main__ - INFO - Создание резервной копии базы данных...
2025-12-16 21:19:13,152 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_211913.db
2025-12-16 21:19:13,154 - __main__ - INFO - Резервная копия создана
2025-12-16 21:19:13,176 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:19:13,193 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at > ?
2025-12-16 21:19:13,193 - sqlalchemy.engine.Engine - INFO - [generated in 0.00072s] ('active', '2025-12-16 18:19:13.175999')
2025-12-16 21:19:13,196 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.ends_at IS NOT NULL AND auctions.ends_at <= ?
2025-12-16 21:19:13,196 - sqlalchemy.engine.Engine - INFO - [generated in 0.00075s] ('active', '2025-12-16 18:19:13.195004')
2025-12-16 21:19:13,198 - utils.timer - INFO - Восстановлено 0 таймеров, завершено 0 аукционов
2025-12-16 21:19:13,198 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:19:13,199 - __main__ - INFO - Планировщик таймеров запущен
2025-12-16 21:19:13,199 - utils.periodic_updater - INFO - Запущено периодическое обновление таймеров (интервал: 600 сек)
2025-12-16 21:19:13,199 - __main__ - INFO - Периодическое обновление таймеров запущено
2025-12-16 21:19:13,199 - __main__ - INFO - Бот запущен
2025-12-16 21:19:13,200 - __main__ - INFO - Периодическое обновление запущено: True
2025-12-16 21:19:13,200 - __main__ - INFO - Интервал обновления: 600 сек
2025-12-16 21:19:13,200 - __main__ - INFO - Бот установлен: True
2025-12-16 21:19:13,200 - aiogram.dispatcher - INFO - Start polling
2025-12-16 21:19:13,204 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:19:13,206 - sqlalchemy.engine.Engine - INFO - SELECT auctions.id, auctions.title, auctions.description, auctions.photos, auctions.start_price, auctions.step_price, auctions.current_price, auctions.status, auctions.winner_id, auctions.channel_message_id, auctions.last_bid_time, auctions.created_at, auctions.ends_at, auctions.ended_at 
FROM auctions 
WHERE auctions.status = ? AND auctions.channel_message_id IS NOT NULL ORDER BY auctions.ends_at ASC
2025-12-16 21:19:13,207 - sqlalchemy.engine.Engine - INFO - [generated in 0.00096s] ('active',)
2025-12-16 21:19:13,208 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:19:13,441 - aiogram.dispatcher - INFO - Run polling for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
2025-12-16 21:19:17,133 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:19:17,134 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:19:17,135 - sqlalchemy.engine.Engine - INFO - [generated in 0.00057s] (8148367074,)
2025-12-16 21:19:17,138 - sqlalchemy.engine.Engine - INFO - INSERT INTO users (telegram_id, username, first_name, last_name, phone, is_confirmed, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)
2025-12-16 21:19:17,138 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] (8148367074, 'ammuniti0n', 'dark triad', None, None, 0, '2025-12-16 18:19:17.138542')
2025-12-16 21:19:17,141 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:19:17,149 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:19:17,149 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:19:17,150 - sqlalchemy.engine.Engine - INFO - [cached since 0.01573s ago] (8148367074,)
2025-12-16 21:19:17,409 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:19:17,410 - aiogram.event - INFO - Update id=188256946 is handled. Duration 265 ms by bot id=8561542425
2025-12-16 21:19:18,383 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:19:18,383 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:19:18,384 - sqlalchemy.engine.Engine - INFO - [cached since 1.249s ago] (8148367074,)
2025-12-16 21:19:18,385 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:19:18,386 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:19:18,387 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:19:18,387 - sqlalchemy.engine.Engine - INFO - [cached since 1.253s ago] (8148367074,)
2025-12-16 21:19:18,390 - sqlalchemy.engine.Engine - INFO - UPDATE users SET is_confirmed=? WHERE users.id = ?
2025-12-16 21:19:18,391 - sqlalchemy.engine.Engine - INFO - [generated in 0.00054s] (1, 1)
2025-12-16 21:19:18,393 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-12-16 21:19:18,595 - aiogram.event - INFO - Update id=188256947 is handled. Duration 202 ms by bot id=8561542425
2025-12-16 21:19:19,535 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:19:19,535 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:19:19,536 - sqlalchemy.engine.Engine - INFO - [cached since 2.402s ago] (8148367074,)
2025-12-16 21:19:19,537 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:19:19,539 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-12-16 21:19:19,539 - sqlalchemy.engine.Engine - INFO - SELECT users.id, users.telegram_id, users.username, users.first_name, users.last_name, users.phone, users.is_confirmed, users.created_at 
FROM users 
WHERE users.telegram_id = ?
2025-12-16 21:19:19,539 - sqlalchemy.engine.Engine - INFO - [cached since 2.405s ago] (8561542425,)
2025-12-16 21:19:19,640 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-12-16 21:19:19,723 - aiogram.event - INFO - Update id=188256948 is handled. Duration 186 ms by bot id=8561542425
2025-12-16 21:20:15,068 - aiogram.dispatcher - INFO - Polling stopped
2025-12-16 21:20:15,322 - utils.backup - INFO - Создана резервная копия: backups\auctions_20251216_212015.db
2025-12-16 21:20:15,324 - utils.periodic_updater - INFO - Задача периодического обновления отменена
2025-12-16 21:20:15,324 - utils.periodic_updater - INFO - Периодическое обновление таймеров остановлено
2025-12-16 21:20:15,324 - utils.timer - INFO - Все таймеры остановлены
2025-12-16 21:20:15,325 - aiogram.dispatcher - INFO - Polling stopped for bot @pitauc_bot id=8561542425 - 'P.I.T Store Аукционы'
